// <auto-generated/>
// Contents of: hl7.fhir.r2.core version: 1.0.2
// Minimum TypeScript Version: 3.7
// FHIR ComplexType: CodeableConcept
import * as fhir from '../fhir.js';
/**
 * A concept that may be defined by a formal reference to a terminology or ontology or may be provided by text.
 */
export class CodeableConcept extends fhir.FhirElement {
    /**
     * Default constructor for CodeableConcept - initializes any required elements to null if a value is not provided.
     */
    constructor(source = {}, options = {}) {
        super(source, options);
        if (source['coding']) {
            this.coding = source.coding.map((x) => new fhir.Coding(x));
        }
        else {
            this.coding = [];
        }
        if (source['text']) {
            this.text = new fhir.FhirString({ value: source.text });
        }
        if (source['_text']) {
            if (this.text) {
                this.text.addExtendedProperties(source._text);
            }
            else {
                this.text = new fhir.FhirString(source._text);
            }
        }
    }
    /**
     * Function to perform basic model validation (e.g., check if required elements are present).
     */
    doModelValidation(exp = '') {
        let iss = super.doModelValidation(exp);
        if (exp === '') {
            exp = 'CodeableConcept';
        }
        iss.push(...this.vOA('coding', exp));
        iss.push(...this.vOS('text', exp));
        return iss;
    }
    /**
     * Fluent-style function to add codings
     * @param coding
     * @returns this CodeableConcept, with the additional coding
     */
    addCoding(coding) {
        this.coding.push(new fhir.Coding(coding));
        return this;
    }
    /**
     * Fluent-style function to remove ALL instances of codings with a system and/or code
     * @param system
     * @param code
     * @returns this CodeableConcept, updated without the requesting coding
     */
    removeCoding(system, code) {
        if (this.coding.length === 0) {
            return this;
        }
        const s = (typeof system === 'string') ? system : system.value ?? '';
        const c = (typeof code === 'string') ? code : code.value ?? '';
        let clean = this.coding.filter((coding) => (((s === '') || (coding.system?.value === s)) && ((c === '') || (coding.code?.value === c)))) ?? [];
        this.coding = clean;
        return this;
    }
    /**
     * Find the first coding with a matching system and/or code
     * @param system
     * @param code
     * @returns A matching Coding or undefined.
     */
    findCoding(system, code) {
        if (this.coding.length === 0) {
            return undefined;
        }
        const s = (typeof system === 'string') ? system : system.value ?? '';
        const c = (typeof code === 'string') ? code : code.value ?? '';
        return this.coding.find((coding) => (((s === '') || (coding.system?.value === s)) && ((c === '') || (coding.code?.value === c))));
    }
    /**
     * Find all instances of an extension with a matching URL, optionally recurse into extension.extension.
     * @param url URL to search for
     * @param searchNested If the search should nest into extensions
     * @returns A new array of FHIR Extensions, with just the desired extensions
     */
    filterCodings(system, code) {
        if (this.coding.length === 0) {
            return [];
        }
        const s = (typeof system === 'string') ? system : system.value ?? '';
        const c = (typeof code === 'string') ? code : code.value ?? '';
        return this.coding.filter((coding) => (((s === '') || (coding.system?.value === s)) && ((c === '') || (coding.code?.value === c))));
    }
    /**
     * Test whether this CodeableConcept contains a specific coding.
     * @param system System to search for, empty string will match any system.
     * @param code Code to search for, empty string will match any code.
     * @returns True if this concept contains the specified coding, false if it does not.
     */
    hasCoding(system, code) {
        if (this.coding.length === 0) {
            return false;
        }
        const s = (typeof system === 'string') ? system : system.value ?? '';
        const c = (typeof code === 'string') ? code : code.value ?? '';
        if ((s) && (c)) {
            return (this.coding.find((coding) => (coding.system?.value === s) && (coding.code?.value === c)) !== undefined);
        }
        if (s) {
            return (this.coding.find((coding) => (coding.system?.value === s)) !== undefined);
        }
        if (c) {
            return (this.coding.find((coding) => coding.code?.value === c) !== undefined);
        }
        return false;
    }
    /**
     * Test whether this CodeableConcept contains a specific coding.
     * @param system System to search for, empty string will match any system.
     * @param code Code to search for, empty string will match any code.
     * @returns True if this concept contains the specified coding, false if it does not.
     */
    hasCodingFromObject(codings) {
        if (this.coding.length === 0) {
            return false;
        }
        for (const obj of Object.values(codings)) {
            if (!obj) {
                continue;
            }
            const system = obj['system'] ?? '';
            const code = obj['code'] ?? '';
            if (this.hasCoding(system, code)) {
                return true;
            }
        }
        return false;
    }
    /**
     * Test whether this CodeableConcept contains a specific coding.
     * @param system System to search for, empty string will match any system.
     * @param code Code to search for, empty string will match any code.
     * @returns True if this concept contains the specified coding, false if it does not.
     */
    hasCodingFromValidationObj(vsValidation) {
        if (this.coding.length === 0) {
            return false;
        }
        for (const coding of this.coding) {
            const sc = (coding.system?.value ?? '') + '|' + (coding.code?.value ?? '');
            const c = coding.code?.value ?? '';
            if (vsValidation.find((v) => (v === sc) || (v === c))) {
                return true;
            }
        }
        return false;
    }
    /**
     * Test whether this CodeableConcept contains a specific coding.
     * @param system System to search for, empty string will match any system.
     * @param code Code to search for, empty string will match any code.
     * @returns True if this concept contains the specified coding, false if it does not.
     */
    hasCodingFromValidationHash(vsValidation) {
        if (this.coding.length === 0) {
            return false;
        }
        for (const coding of this.coding) {
            const sc = fhir.FhirBase._hash52_1a_fast((coding.system?.value ?? '') + '|' + (coding.code?.value ?? ''));
            const c = fhir.FhirBase._hash52_1a_fast(coding.code?.value ?? '');
            if (vsValidation.find((v) => (v === sc) || (v === c))) {
                return true;
            }
        }
        return false;
    }
}
/**
 * Mapping of this datatype to a FHIR equivalent
 */
CodeableConcept._fts_dataType = 'CodeableConcept';
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ29kZWFibGVDb25jZXB0LmpzIiwic291cmNlUm9vdCI6Ii4vc3JjLyIsInNvdXJjZXMiOlsiZmhpci9Db2RlYWJsZUNvbmNlcHQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsb0JBQW9CO0FBQ3BCLCtDQUErQztBQUMvQyxrQ0FBa0M7QUFDbEMsb0NBQW9DO0FBRXBDLE9BQU8sS0FBSyxJQUFJLE1BQU0sWUFBWSxDQUFDO0FBb0JuQzs7R0FFRztBQUNILE1BQU0sT0FBTyxlQUFnQixTQUFRLElBQUksQ0FBQyxXQUFXO0lBYW5EOztPQUVHO0lBQ0gsWUFBWSxTQUFzQyxFQUFFLEVBQUUsVUFBc0MsRUFBRTtRQUM1RixLQUFLLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBQ3ZCLElBQUksTUFBTSxDQUFDLFFBQVEsQ0FBQyxFQUFFO1lBQUUsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FBRTthQUNoRjtZQUFFLElBQUksQ0FBQyxNQUFNLEdBQUcsRUFBRSxDQUFDO1NBQUU7UUFDMUIsSUFBSSxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUU7WUFBRSxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQyxFQUFDLEtBQUssRUFBRSxNQUFNLENBQUMsSUFBSSxFQUFDLENBQUMsQ0FBQztTQUFFO1FBQzlFLElBQUksTUFBTSxDQUFDLE9BQU8sQ0FBQyxFQUFFO1lBQ25CLElBQUksSUFBSSxDQUFDLElBQUksRUFBRTtnQkFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLHFCQUFxQixDQUFDLE1BQU0sQ0FBQyxLQUFNLENBQUMsQ0FBQzthQUFFO2lCQUM3RDtnQkFBRSxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFN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LENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtZQUM1QixPQUFPLEtBQUssQ0FBQztTQUNkO1FBRUQsS0FBSyxNQUFNLE1BQU0sSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFO1lBQ2hDLE1BQU0sRUFBRSxHQUFVLElBQUksQ0FBQyxRQUFRLENBQUMsZUFBZSxDQUFDLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxLQUFLLElBQUksRUFBRSxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxLQUFLLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQztZQUNqSCxNQUFNLENBQUMsR0FBVSxJQUFJLENBQUMsUUFBUSxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLEtBQUssSUFBSSxFQUFFLENBQUMsQ0FBQztZQUV6RSxJQUFJLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUU7Z0JBQ3JELE9BQU8sSUFBSSxDQUFDO2FBQ2I7U0FDRjtRQUVELE9BQU8sS0FBSyxDQUFDO0lBQ2YsQ0FBQzs7QUE3TEQ7O0dBRUc7QUFDNkIsNkJBQWEsR0FBVSxpQkFBaUIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIDxhdXRvLWdlbmVyYXRlZC8+XHJcbi8vIENvbnRlbnRzIG9mOiBobDcuZmhpci5yMi5jb3JlIHZlcnNpb246IDEuMC4yXHJcbi8vIE1pbmltdW0gVHlwZVNjcmlwdCBWZXJzaW9uOiAzLjdcclxuLy8gRkhJUiBDb21wbGV4VHlwZTogQ29kZWFibGVDb25jZXB0XHJcblxyXG5pbXBvcnQgKiBhcyBmaGlyIGZyb20gJy4uL2ZoaXIuanMnO1xyXG5cclxuLyoqXHJcbiAqIFZhbGlkIGFyZ3VtZW50cyBmb3IgdGhlIENvZGVhYmxlQ29uY2VwdCB0eXBlLlxyXG4gKi9cclxuZXhwb3J0IGludGVyZmFjZSBDb2RlYWJsZUNvbmNlcHRBcmdzIGV4dGVuZHMgZmhpci5GaGlyRWxlbWVudEFyZ3Mge1xyXG4gIC8qKlxyXG4gICAqIEFsbG93cyBmb3IgdHJhbnNsYXRpb25zIGFuZCBhbHRlcm5hdGUgZW5jb2RpbmdzIHdpdGhpbiBhIGNvZGUgc3lzdGVtLiAgQWxzbyBzdXBwb3J0cyBjb21tdW5pY2F0aW9uIG9mIHRoZSBzYW1lIGluc3RhbmNlIHRvIHN5c3RlbXMgcmVxdWlyaW5nIGRpZmZlcmVudCBlbmNvZGluZ3MuXHJcbiAgICovXHJcbiAgY29kaW5nPzogZmhpci5Db2RpbmdBcmdzW118dW5kZWZpbmVkO1xyXG4gIC8qKlxyXG4gICAqIFRoZSBjb2RlcyBmcm9tIHRoZSB0ZXJtaW5vbG9naWVzIGRvIG5vdCBhbHdheXMgY2FwdHVyZSB0aGUgY29ycmVjdCBtZWFuaW5nIHdpdGggYWxsIHRoZSBudWFuY2VzIG9mIHRoZSBodW1hbiB1c2luZyB0aGVtLCBvciBzb21ldGltZXMgdGhlcmUgaXMgbm8gYXBwcm9wcmlhdGUgY29kZSBhdCBhbGwuIEluIHRoZXNlIGNhc2VzLCB0aGUgdGV4dCBpcyB1c2VkIHRvIGNhcHR1cmUgdGhlIGZ1bGwgbWVhbmluZyBvZiB0aGUgc291cmNlLlxyXG4gICAqL1xyXG4gIHRleHQ/OiBmaGlyLkZoaXJTdHJpbmd8c3RyaW5nfHVuZGVmaW5lZDtcclxuICAvKipcclxuICAgKiBFeHRlbmRlZCBwcm9wZXJ0aWVzIGZvciBwcmltaXRpdmUgZWxlbWVudDogQ29kZWFibGVDb25jZXB0LnRleHRcclxuICAgKi9cclxuICBfdGV4dD86Zmhpci5GaGlyRWxlbWVudEFyZ3M7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBBIGNvbmNlcHQgdGhhdCBtYXkgYmUgZGVmaW5lZCBieSBhIGZvcm1hbCByZWZlcmVuY2UgdG8gYSB0ZXJtaW5vbG9neSBvciBvbnRvbG9neSBvciBtYXkgYmUgcHJvdmlkZWQgYnkgdGV4dC5cclxuICovXHJcbmV4cG9ydCBjbGFzcyBDb2RlYWJsZUNvbmNlcHQgZXh0ZW5kcyBmaGlyLkZoaXJFbGVtZW50IHtcclxuICAvKipcclxuICAgKiBNYXBwaW5nIG9mIHRoaXMgZGF0YXR5cGUgdG8gYSBGSElSIGVxdWl2YWxlbnRcclxuICAgKi9cclxuICBwdWJsaWMgc3RhdGljIG92ZXJyaWRlIHJlYWRvbmx5IF9mdHNfZGF0YVR5cGU6c3RyaW5nID0gJ0NvZGVhYmxlQ29uY2VwdCc7XHJcbiAgLyoqXHJcbiAgICogQWxsb3dzIGZvciB0cmFuc2xhdGlvbnMgYW5kIGFsdGVybmF0ZSBlbmNvZGluZ3Mgd2l0aGluIGEgY29kZSBzeXN0ZW0uICBBbHNvIHN1cHBvcnRzIGNvbW11bmljYXRpb24gb2YgdGhlIHNhbWUgaW5zdGFuY2UgdG8gc3lzdGVtcyByZXF1aXJpbmcgZGlmZmVyZW50IGVuY29kaW5ncy5cclxuICAgKi9cclxuICBwdWJsaWMgY29kaW5nOiBmaGlyLkNvZGluZ1tdO1xyXG4gIC8qKlxyXG4gICAqIFRoZSBjb2RlcyBmcm9tIHRoZSB0ZXJtaW5vbG9naWVzIGRvIG5vdCBhbHdheXMgY2FwdHVyZSB0aGUgY29ycmVjdCBtZWFuaW5nIHdpdGggYWxsIHRoZSBudWFuY2VzIG9mIHRoZSBodW1hbiB1c2luZyB0aGVtLCBvciBzb21ldGltZXMgdGhlcmUgaXMgbm8gYXBwcm9wcmlhdGUgY29kZSBhdCBhbGwuIEluIHRoZXNlIGNhc2VzLCB0aGUgdGV4dCBpcyB1c2VkIHRvIGNhcHR1cmUgdGhlIGZ1bGwgbWVhbmluZyBvZiB0aGUgc291cmNlLlxyXG4gICAqL1xyXG4gIHB1YmxpYyB0ZXh0PzogZmhpci5GaGlyU3RyaW5nfHVuZGVmaW5lZDtcclxuICAvKipcclxuICAgKiBEZWZhdWx0IGNvbnN0cnVjdG9yIGZvciBDb2RlYWJsZUNvbmNlcHQgLSBpbml0aWFsaXplcyBhbnkgcmVxdWlyZWQgZWxlbWVudHMgdG8gbnVsbCBpZiBhIHZhbHVlIGlzIG5vdCBwcm92aWRlZC5cclxuICAgKi9cclxuICBjb25zdHJ1Y3Rvcihzb3VyY2U6UGFydGlhbDxDb2RlYWJsZUNvbmNlcHRBcmdzPiA9IHt9LCBvcHRpb25zOmZoaXIuRmhpckNvbnN0cnVjdG9yT3B0aW9ucyA9IHt9KSB7XHJcbiAgICBzdXBlcihzb3VyY2UsIG9wdGlvbnMpO1xyXG4gICAgaWYgKHNvdXJjZVsnY29kaW5nJ10pIHsgdGhpcy5jb2RpbmcgPSBzb3VyY2UuY29kaW5nLm1hcCgoeCkgPT4gbmV3IGZoaXIuQ29kaW5nKHgpKTsgfVxyXG4gICAgZWxzZSB7IHRoaXMuY29kaW5nID0gW107IH1cclxuICAgIGlmIChzb3VyY2VbJ3RleHQnXSkgeyB0aGlzLnRleHQgPSBuZXcgZmhpci5GaGlyU3RyaW5nKHt2YWx1ZTogc291cmNlLnRleHR9KTsgfVxyXG4gICAgaWYgKHNvdXJjZVsnX3RleHQnXSkge1xyXG4gICAgICBpZiAodGhpcy50ZXh0KSB7IHRoaXMudGV4dC5hZGRFeHRlbmRlZFByb3BlcnRpZXMoc291cmNlLl90ZXh0ISk7IH1cclxuICAgICAgZWxzZSB7IHRoaXMudGV4dCA9IG5ldyBmaGlyLkZoaXJTdHJpbmcoc291cmNlLl90ZXh0IGFzIFBhcnRpYWw8Zmhpci5GaGlyU3RyaW5nQXJncz4pOyB9XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIEZ1bmN0aW9uIHRvIHBlcmZvcm0gYmFzaWMgbW9kZWwgdmFsaWRhdGlvbiAoZS5nLiwgY2hlY2sgaWYgcmVxdWlyZWQgZWxlbWVudHMgYXJlIHByZXNlbnQpLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBvdmVycmlkZSBkb01vZGVsVmFsaWRhdGlvbihleHA6c3RyaW5nID0gJycpOmZoaXIuRnRzSXNzdWVbXSB7XHJcbiAgICBsZXQgaXNzOmZoaXIuRnRzSXNzdWVbXSA9IHN1cGVyLmRvTW9kZWxWYWxpZGF0aW9uKGV4cCk7XHJcbiAgICBpZiAoZXhwID09PSAnJykgeyBleHAgPSAnQ29kZWFibGVDb25jZXB0JyB9XHJcbiAgICBpc3MucHVzaCguLi50aGlzLnZPQSgnY29kaW5nJyxleHApKTtcclxuICAgIGlzcy5wdXNoKC4uLnRoaXMudk9TKCd0ZXh0JyxleHApKTtcclxuICAgIHJldHVybiBpc3M7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIEZsdWVudC1zdHlsZSBmdW5jdGlvbiB0byBhZGQgY29kaW5nc1xyXG4gICAqIEBwYXJhbSBjb2RpbmcgXHJcbiAgICogQHJldHVybnMgdGhpcyBDb2RlYWJsZUNvbmNlcHQsIHdpdGggdGhlIGFkZGl0aW9uYWwgY29kaW5nXHJcbiAgICovXHJcbiAgIHB1YmxpYyBhZGRDb2RpbmcoY29kaW5nOmZoaXIuQ29kaW5nQXJncyk6Q29kZWFibGVDb25jZXB0IHtcclxuICAgIHRoaXMuY29kaW5nLnB1c2gobmV3IGZoaXIuQ29kaW5nKGNvZGluZykpO1xyXG4gICAgcmV0dXJuIHRoaXM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGbHVlbnQtc3R5bGUgZnVuY3Rpb24gdG8gcmVtb3ZlIEFMTCBpbnN0YW5jZXMgb2YgY29kaW5ncyB3aXRoIGEgc3lzdGVtIGFuZC9vciBjb2RlXHJcbiAgICogQHBhcmFtIHN5c3RlbSBcclxuICAgKiBAcGFyYW0gY29kZSBcclxuICAgKiBAcmV0dXJucyB0aGlzIENvZGVhYmxlQ29uY2VwdCwgdXBkYXRlZCB3aXRob3V0IHRoZSByZXF1ZXN0aW5nIGNvZGluZ1xyXG4gICAqL1xyXG4gIHB1YmxpYyByZW1vdmVDb2Rpbmcoc3lzdGVtOmZoaXIuRmhpclN0cmluZ3xzdHJpbmcsIGNvZGU6Zmhpci5GaGlyU3RyaW5nfHN0cmluZyk6Q29kZWFibGVDb25jZXB0IHtcclxuICAgIGlmICh0aGlzLmNvZGluZy5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcbiAgICBjb25zdCBzOnN0cmluZyA9ICh0eXBlb2Ygc3lzdGVtID09PSAnc3RyaW5nJykgPyBzeXN0ZW0gOiAoc3lzdGVtIGFzIGZoaXIuRmhpclN0cmluZykudmFsdWUgPz8gJyc7XHJcbiAgICBjb25zdCBjOnN0cmluZyA9ICh0eXBlb2YgY29kZSA9PT0gJ3N0cmluZycpID8gY29kZSA6IChjb2RlIGFzIGZoaXIuRmhpclN0cmluZykudmFsdWUgPz8gJyc7XHJcbiAgICBsZXQgY2xlYW46Zmhpci5Db2RpbmdbXSA9IHRoaXMuY29kaW5nLmZpbHRlcigoY29kaW5nKSA9PiAoKChzID09PSAnJykgfHwgKGNvZGluZy5zeXN0ZW0/LnZhbHVlID09PSBzKSkgJiYgKChjID09PSAnJykgfHwgKGNvZGluZy5jb2RlPy52YWx1ZSA9PT0gYykpKSkgPz8gW107XHJcbiAgICB0aGlzLmNvZGluZyA9IGNsZWFuO1xyXG4gICAgcmV0dXJuIHRoaXM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGaW5kIHRoZSBmaXJzdCBjb2Rpbmcgd2l0aCBhIG1hdGNoaW5nIHN5c3RlbSBhbmQvb3IgY29kZVxyXG4gICAqIEBwYXJhbSBzeXN0ZW0gXHJcbiAgICogQHBhcmFtIGNvZGUgXHJcbiAgICogQHJldHVybnMgQSBtYXRjaGluZyBDb2Rpbmcgb3IgdW5kZWZpbmVkLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBmaW5kQ29kaW5nKHN5c3RlbTpmaGlyLkZoaXJTdHJpbmd8c3RyaW5nLCBjb2RlOmZoaXIuRmhpclN0cmluZ3xzdHJpbmcpOmZoaXIuQ29kaW5nfHVuZGVmaW5lZCB7XHJcbiAgICBpZiAodGhpcy5jb2RpbmcubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICB9XHJcbiAgICBjb25zdCBzOnN0cmluZyA9ICh0eXBlb2Ygc3lzdGVtID09PSAnc3RyaW5nJykgPyBzeXN0ZW0gOiAoc3lzdGVtIGFzIGZoaXIuRmhpclN0cmluZykudmFsdWUgPz8gJyc7XHJcbiAgICBjb25zdCBjOnN0cmluZyA9ICh0eXBlb2YgY29kZSA9PT0gJ3N0cmluZycpID8gY29kZSA6IChjb2RlIGFzIGZoaXIuRmhpclN0cmluZykudmFsdWUgPz8gJyc7XHJcbiAgICByZXR1cm4gdGhpcy5jb2RpbmcuZmluZCgoY29kaW5nKSA9PiAoKChzID09PSAnJykgfHwgKGNvZGluZy5zeXN0ZW0/LnZhbHVlID09PSBzKSkgJiYgKChjID09PSAnJykgfHwgKGNvZGluZy5jb2RlPy52YWx1ZSA9PT0gYykpKSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGaW5kIGFsbCBpbnN0YW5jZXMgb2YgYW4gZXh0ZW5zaW9uIHdpdGggYSBtYXRjaGluZyBVUkwsIG9wdGlvbmFsbHkgcmVjdXJzZSBpbnRvIGV4dGVuc2lvbi5leHRlbnNpb24uXHJcbiAgICogQHBhcmFtIHVybCBVUkwgdG8gc2VhcmNoIGZvclxyXG4gICAqIEBwYXJhbSBzZWFyY2hOZXN0ZWQgSWYgdGhlIHNlYXJjaCBzaG91bGQgbmVzdCBpbnRvIGV4dGVuc2lvbnNcclxuICAgKiBAcmV0dXJucyBBIG5ldyBhcnJheSBvZiBGSElSIEV4dGVuc2lvbnMsIHdpdGgganVzdCB0aGUgZGVzaXJlZCBleHRlbnNpb25zXHJcbiAgICovXHJcbiAgcHVibGljIGZpbHRlckNvZGluZ3Moc3lzdGVtOmZoaXIuRmhpclN0cmluZ3xzdHJpbmcsIGNvZGU6Zmhpci5GaGlyU3RyaW5nfHN0cmluZyk6Zmhpci5Db2RpbmdbXSB7XHJcbiAgICBpZiAodGhpcy5jb2RpbmcubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIHJldHVybiBbXTtcclxuICAgIH1cclxuICAgIGNvbnN0IHM6c3RyaW5nID0gKHR5cGVvZiBzeXN0ZW0gPT09ICdzdHJpbmcnKSA/IHN5c3RlbSA6IChzeXN0ZW0gYXMgZmhpci5GaGlyU3RyaW5nKS52YWx1ZSA/PyAnJztcclxuICAgIGNvbnN0IGM6c3RyaW5nID0gKHR5cGVvZiBjb2RlID09PSAnc3RyaW5nJykgPyBjb2RlIDogKGNvZGUgYXMgZmhpci5GaGlyU3RyaW5nKS52YWx1ZSA/PyAnJztcclxuICAgIHJldHVybiB0aGlzLmNvZGluZy5maWx0ZXIoKGNvZGluZykgPT4gKCgocyA9PT0gJycpIHx8IChjb2Rpbmcuc3lzdGVtPy52YWx1ZSA9PT0gcykpICYmICgoYyA9PT0gJycpIHx8IChjb2RpbmcuY29kZT8udmFsdWUgPT09IGMpKSkpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVGVzdCB3aGV0aGVyIHRoaXMgQ29kZWFibGVDb25jZXB0IGNvbnRhaW5zIGEgc3BlY2lmaWMgY29kaW5nLlxyXG4gICAqIEBwYXJhbSBzeXN0ZW0gU3lzdGVtIHRvIHNlYXJjaCBmb3IsIGVtcHR5IHN0cmluZyB3aWxsIG1hdGNoIGFueSBzeXN0ZW0uXHJcbiAgICogQHBhcmFtIGNvZGUgQ29kZSB0byBzZWFyY2ggZm9yLCBlbXB0eSBzdHJpbmcgd2lsbCBtYXRjaCBhbnkgY29kZS5cclxuICAgKiBAcmV0dXJucyBUcnVlIGlmIHRoaXMgY29uY2VwdCBjb250YWlucyB0aGUgc3BlY2lmaWVkIGNvZGluZywgZmFsc2UgaWYgaXQgZG9lcyBub3QuXHJcbiAgICovXHJcbiAgcHVibGljIGhhc0NvZGluZyhzeXN0ZW06Zmhpci5GaGlyU3RyaW5nfHN0cmluZywgY29kZTpmaGlyLkZoaXJTdHJpbmd8c3RyaW5nKTpib29sZWFuIHtcclxuICAgIGlmICh0aGlzLmNvZGluZy5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBjb25zdCBzOnN0cmluZyA9ICh0eXBlb2Ygc3lzdGVtID09PSAnc3RyaW5nJykgPyBzeXN0ZW0gOiAoc3lzdGVtIGFzIGZoaXIuRmhpclN0cmluZykudmFsdWUgPz8gJyc7XHJcbiAgICBjb25zdCBjOnN0cmluZyA9ICh0eXBlb2YgY29kZSA9PT0gJ3N0cmluZycpID8gY29kZSA6IChjb2RlIGFzIGZoaXIuRmhpclN0cmluZykudmFsdWUgPz8gJyc7XHJcblxyXG4gICAgaWYgKChzKSAmJiAoYykpIHtcclxuICAgICAgcmV0dXJuICh0aGlzLmNvZGluZy5maW5kKChjb2RpbmcpID0+IChjb2Rpbmcuc3lzdGVtPy52YWx1ZSA9PT0gcykgJiYgKGNvZGluZy5jb2RlPy52YWx1ZSA9PT0gYykpICE9PSB1bmRlZmluZWQpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChzKSB7XHJcbiAgICAgIHJldHVybiAodGhpcy5jb2RpbmcuZmluZCgoY29kaW5nKSA9PiAoY29kaW5nLnN5c3RlbT8udmFsdWUgPT09IHMpKSAhPT0gdW5kZWZpbmVkKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoYykge1xyXG4gICAgICByZXR1cm4gKHRoaXMuY29kaW5nLmZpbmQoKGNvZGluZykgPT4gY29kaW5nLmNvZGU/LnZhbHVlID09PSBjKSAhPT0gdW5kZWZpbmVkKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBUZXN0IHdoZXRoZXIgdGhpcyBDb2RlYWJsZUNvbmNlcHQgY29udGFpbnMgYSBzcGVjaWZpYyBjb2RpbmcuXHJcbiAgICogQHBhcmFtIHN5c3RlbSBTeXN0ZW0gdG8gc2VhcmNoIGZvciwgZW1wdHkgc3RyaW5nIHdpbGwgbWF0Y2ggYW55IHN5c3RlbS5cclxuICAgKiBAcGFyYW0gY29kZSBDb2RlIHRvIHNlYXJjaCBmb3IsIGVtcHR5IHN0cmluZyB3aWxsIG1hdGNoIGFueSBjb2RlLlxyXG4gICAqIEByZXR1cm5zIFRydWUgaWYgdGhpcyBjb25jZXB0IGNvbnRhaW5zIHRoZSBzcGVjaWZpZWQgY29kaW5nLCBmYWxzZSBpZiBpdCBkb2VzIG5vdC5cclxuICAgKi9cclxuICBwdWJsaWMgaGFzQ29kaW5nRnJvbU9iamVjdChjb2RpbmdzOmFueSk6Ym9vbGVhbiB7XHJcbiAgICBpZiAodGhpcy5jb2RpbmcubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBmb3IgKGNvbnN0IG9iaiBvZiBPYmplY3QudmFsdWVzKGNvZGluZ3MpKSB7XHJcbiAgICAgIGlmICghb2JqKSB7IGNvbnRpbnVlOyB9XHJcbiAgICAgIGNvbnN0IHN5c3RlbTpzdHJpbmcgPSAob2JqIGFzIGFueSlbJ3N5c3RlbSddID8/ICcnO1xyXG4gICAgICBjb25zdCBjb2RlOnN0cmluZyA9IChvYmogYXMgYW55KVsnY29kZSddID8/ICcnO1xyXG5cclxuICAgICAgaWYgKHRoaXMuaGFzQ29kaW5nKHN5c3RlbSwgY29kZSkpIHtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFRlc3Qgd2hldGhlciB0aGlzIENvZGVhYmxlQ29uY2VwdCBjb250YWlucyBhIHNwZWNpZmljIGNvZGluZy5cclxuICAgKiBAcGFyYW0gc3lzdGVtIFN5c3RlbSB0byBzZWFyY2ggZm9yLCBlbXB0eSBzdHJpbmcgd2lsbCBtYXRjaCBhbnkgc3lzdGVtLlxyXG4gICAqIEBwYXJhbSBjb2RlIENvZGUgdG8gc2VhcmNoIGZvciwgZW1wdHkgc3RyaW5nIHdpbGwgbWF0Y2ggYW55IGNvZGUuXHJcbiAgICogQHJldHVybnMgVHJ1ZSBpZiB0aGlzIGNvbmNlcHQgY29udGFpbnMgdGhlIHNwZWNpZmllZCBjb2RpbmcsIGZhbHNlIGlmIGl0IGRvZXMgbm90LlxyXG4gICAqL1xyXG4gIHB1YmxpYyBoYXNDb2RpbmdGcm9tVmFsaWRhdGlvbk9iaih2c1ZhbGlkYXRpb246UmVhZG9ubHk8c3RyaW5nW10+KTpib29sZWFuIHtcclxuICAgIGlmICh0aGlzLmNvZGluZy5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIGZvciAoY29uc3QgY29kaW5nIG9mIHRoaXMuY29kaW5nKSB7XHJcbiAgICAgIGNvbnN0IHNjOnN0cmluZyA9IChjb2Rpbmcuc3lzdGVtPy52YWx1ZSA/PyAnJykgKyAnfCcgKyAoY29kaW5nLmNvZGU/LnZhbHVlID8/ICcnKTtcclxuICAgICAgY29uc3QgYzpzdHJpbmcgPSBjb2RpbmcuY29kZT8udmFsdWUgPz8gJyc7XHJcblxyXG4gICAgICBpZiAodnNWYWxpZGF0aW9uLmZpbmQoKHYpID0+ICh2ID09PSBzYykgfHwgKHYgPT09IGMpKSkge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVGVzdCB3aGV0aGVyIHRoaXMgQ29kZWFibGVDb25jZXB0IGNvbnRhaW5zIGEgc3BlY2lmaWMgY29kaW5nLlxyXG4gICAqIEBwYXJhbSBzeXN0ZW0gU3lzdGVtIHRvIHNlYXJjaCBmb3IsIGVtcHR5IHN0cmluZyB3aWxsIG1hdGNoIGFueSBzeXN0ZW0uXHJcbiAgICogQHBhcmFtIGNvZGUgQ29kZSB0byBzZWFyY2ggZm9yLCBlbXB0eSBzdHJpbmcgd2lsbCBtYXRjaCBhbnkgY29kZS5cclxuICAgKiBAcmV0dXJucyBUcnVlIGlmIHRoaXMgY29uY2VwdCBjb250YWlucyB0aGUgc3BlY2lmaWVkIGNvZGluZywgZmFsc2UgaWYgaXQgZG9lcyBub3QuXHJcbiAgICovXHJcbiAgcHVibGljIGhhc0NvZGluZ0Zyb21WYWxpZGF0aW9uSGFzaCh2c1ZhbGlkYXRpb246UmVhZG9ubHk8bnVtYmVyW10+KTpib29sZWFuIHtcclxuICAgIGlmICh0aGlzLmNvZGluZy5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIGZvciAoY29uc3QgY29kaW5nIG9mIHRoaXMuY29kaW5nKSB7XHJcbiAgICAgIGNvbnN0IHNjOm51bWJlciA9IGZoaXIuRmhpckJhc2UuX2hhc2g1Ml8xYV9mYXN0KChjb2Rpbmcuc3lzdGVtPy52YWx1ZSA/PyAnJykgKyAnfCcgKyAoY29kaW5nLmNvZGU/LnZhbHVlID8/ICcnKSk7XHJcbiAgICAgIGNvbnN0IGM6bnVtYmVyID0gZmhpci5GaGlyQmFzZS5faGFzaDUyXzFhX2Zhc3QoY29kaW5nLmNvZGU/LnZhbHVlID8/ICcnKTtcclxuXHJcbiAgICAgIGlmICh2c1ZhbGlkYXRpb24uZmluZCgodikgPT4gKHYgPT09IHNjKSB8fCAodiA9PT0gYykpKSB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG4gIH1cclxuIl19