// <auto-generated/>
// Contents of: hl7.fhir.r4b.core version: 4.3.0
// Minimum TypeScript Version: 3.7
// FHIR Resource: DomainResource
import * as fhir from '../fhir.js';
/**
 * A resource that includes narrative, extensions, and contained resources.
 */
export class DomainResource extends fhir.Resource {
    /**
     * Default constructor for DomainResource - initializes any required elements to null if a value is not provided.
     */
    constructor(source = {}, options = {}) {
        super(source, options);
        if (source['text']) {
            this.text = new fhir.Narrative(source.text, options);
        }
        if (source['contained']) {
            this.contained = [];
            source.contained.forEach((x) => {
                var r = fhir.resourceFactory(x, options);
                if (r) {
                    this.contained.push(r);
                }
            });
        }
        else {
            this.contained = [];
        }
        if (source['extension']) {
            this.extension = source.extension.map((x) => new fhir.Extension(x, options));
        }
        else {
            this.extension = [];
        }
        if (source['modifierExtension']) {
            this.modifierExtension = source.modifierExtension.map((x) => new fhir.Extension(x, options));
        }
        else {
            this.modifierExtension = [];
        }
    }
    /**
     * Function to perform basic model validation (e.g., check if required elements are present).
     */
    doModelValidation(exp = '') {
        let iss = super.doModelValidation(exp);
        if (exp === '') {
            exp = 'DomainResource';
        }
        iss.push(...this.vOS('text', exp));
        iss.push(...this.vOA('contained', exp));
        iss.push(...this.vOA('extension', exp));
        iss.push(...this.vOA('modifierExtension', exp));
        return iss;
    }
    /**
     * Fluent-style function to add extensions
     * @param ext
     * @returns
     */
    addExtension(ext) {
        this.extension.push(new fhir.Extension(ext));
        return this;
    }
    /**
     * Remove ALL instances of extensions with a matching URL, optionally recurse into extension.extension.
     * @param url URL of extensions to remove
     * @param searchNested If the removal should search for nested extensions
     */
    removeExtensions(url, searchNested = false) {
        if (this.extension.length === 0) {
            return this;
        }
        const matchUrl = (typeof url === 'string') ? url : url.value ?? '';
        let clean = this.extension.filter((ext) => (ext?.url?.value ?? '') !== matchUrl) ?? [];
        if (searchNested) {
            for (let i = 0; i < clean.length; i++) {
                clean[i] = clean[i].removeExtensions(matchUrl, searchNested);
            }
        }
        this.extension = clean;
        return this;
    }
    /**
     * Find the first instance of an extension with a matching URL, optionally recurse into extension.extension.
     * @param url URL to search for
     * @param searchNested If the search should nest into extensions
     * @returns The FHIR Extension if found, or undefined.
     */
    findExtension(url, searchNested = false) {
        if (this.extension.length === 0) {
            return undefined;
        }
        const matchUrl = (typeof url === 'string') ? url : url.value ?? '';
        if (searchNested) {
            const flat = DomainResource.recurseForExtension(matchUrl, this.extension);
            if (flat.length === 0) {
                return undefined;
            }
            return flat[0];
        }
        return this.extension.find((ext) => (ext?.url?.value === matchUrl));
    }
    /**
     * Find all instances of an extension with a matching URL, optionally recurse into extension.extension.
     * @param url URL to search for
     * @param searchNested If the search should nest into extensions
     * @returns A new array of FHIR Extensions, with just the desired extensions
     */
    filterExtensions(url, searchNested = false) {
        if (this.extension.length === 0) {
            return [];
        }
        const matchUrl = (typeof url === 'string') ? url : url.value ?? '';
        if (searchNested) {
            return DomainResource.recurseForExtension(matchUrl, this.extension);
        }
        return this.extension.filter((ext) => (ext?.url?.value === matchUrl));
    }
    /**
     * Internal recursive search function
     * @param url
     * @param exts
     * @returns A new array (flat) of matching extensions
     */
    static recurseForExtension(url, exts) {
        if ((!exts) || (exts.length === 0)) {
            return [];
        }
        let val = [];
        exts.forEach((ext) => {
            if (ext && ext.url && (ext.url.value === url)) {
                val.push(ext);
                return;
            }
            if (ext && ext.extension && (ext.extension.length > 0)) {
                val.push(...this.recurseForExtension(url, ext.extension));
                return;
            }
            return;
        }, []);
        return val;
    }
}
/**
 * Mapping of this datatype to a FHIR equivalent
 */
DomainResource._fts_dataType = 'DomainResource';
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRG9tYWluUmVzb3VyY2UuanMiLCJzb3VyY2VSb290IjoiLi9zcmMvIiwic291cmNlcyI6WyJmaGlyL0RvbWFpblJlc291cmNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLG9CQUFvQjtBQUNwQixnREFBZ0Q7QUFDaEQsa0NBQWtDO0FBQ2xDLGdDQUFnQztBQUVoQyxPQUFPLEtBQUssSUFBSSxNQUFNLFlBQVksQ0FBQztBQXdCbkM7O0dBRUc7QUFDSCxNQUFNLE9BQU8sY0FBZSxTQUFRLElBQUksQ0FBQyxRQUFRO0lBcUIvQzs7T0FFRztJQUNILFlBQVksU0FBcUMsRUFBRSxFQUFFLFVBQXNDLEVBQUU7UUFDM0YsS0FBSyxDQUFDLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQztRQUN2QixJQUFJLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRTtZQUFFLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUM7U0FBRTtRQUM3RSxJQUFJLE1BQU0sQ0FBQyxXQUFXLENBQUMsRUFBRTtZQUN2QixJQUFJLENBQUMsU0FBUyxHQUFHLEVBQUUsQ0FBQztZQUNwQixNQUFNLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFO2dCQUM3QixJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUMsRUFBRSxPQUFPLENBQUMsQ0FBQztnQkFDekMsSUFBSSxDQUFDLEVBQUU7b0JBQUUsSUFBSSxDQUFDLFNBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7aUJBQUU7WUFDckMsQ0FBQyxDQUFDLENBQUM7U0FDSjthQUNJO1lBQUUsSUFBSSxDQUFDLFNBQVMsR0FBRyxFQUFFLENBQUM7U0FBRTtRQUM3QixJQUFJLE1BQU0sQ0FBQyxXQUFXLENBQUMsRUFBRTtZQUFFLElBQUksQ0FBQyxTQUFTLEdBQUcsTUFBTSxDQUFDLFNBQVMs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QUUsRUFBRSxDQUFDLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxLQUFLLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQTtJQUN2RSxDQUFDO0lBRUQ7Ozs7O09BS0c7SUFDSyxNQUFNLENBQUMsbUJBQW1CLENBQUMsR0FBVSxFQUFFLElBQXFCO1FBQ2xFLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUMsRUFBRTtZQUNsQyxPQUFPLEVBQUUsQ0FBQztTQUNYO1FBQ0QsSUFBSSxHQUFHLEdBQW9CLEVBQUUsQ0FBQztRQUM5QixJQUFJLENBQUMsT0FBTyxDQUNWLENBQUMsR0FBRyxFQUFFLEVBQUU7WUFDTixJQUFJLEdBQUcsSUFBSSxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxLQUFLLEtBQUssR0FBRyxDQUFDLEVBQUU7Z0JBQzdDLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQ2QsT0FBTzthQUNSO1lBQ0QsSUFBSSxHQUFHLElBQUksR0FBRyxDQUFDLFNBQVMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxFQUFFO2dCQUN0RCxHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDLG1CQUFtQixDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztnQkFDMUQsT0FBTzthQUNSO1lBQ0QsT0FBTztRQUNULENBQUMsRUFDRCxFQUFFLENBQUMsQ0FBQztRQUNOLE9BQU8sR0FBRyxDQUFDO0lBQ2IsQ0FBQzs7QUFoSkQ7O0dBRUc7QUFDNkIsNEJBQWEsR0FBVSxnQkFBZ0IsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIDxhdXRvLWdlbmVyYXRlZC8+XHJcbi8vIENvbnRlbnRzIG9mOiBobDcuZmhpci5yNGIuY29yZSB2ZXJzaW9uOiA0LjMuMFxyXG4vLyBNaW5pbXVtIFR5cGVTY3JpcHQgVmVyc2lvbjogMy43XHJcbi8vIEZISVIgUmVzb3VyY2U6IERvbWFpblJlc291cmNlXHJcblxyXG5pbXBvcnQgKiBhcyBmaGlyIGZyb20gJy4uL2ZoaXIuanMnO1xyXG5cclxuLyoqXHJcbiAqIFZhbGlkIGFyZ3VtZW50cyBmb3IgdGhlIERvbWFpblJlc291cmNlIHR5cGUuXHJcbiAqL1xyXG5leHBvcnQgaW50ZXJmYWNlIERvbWFpblJlc291cmNlQXJncyBleHRlbmRzIGZoaXIuUmVzb3VyY2VBcmdzIHtcclxuICAvKipcclxuICAgKiBDb250YWluZWQgcmVzb3VyY2VzIGRvIG5vdCBoYXZlIG5hcnJhdGl2ZS4gUmVzb3VyY2VzIHRoYXQgYXJlIG5vdCBjb250YWluZWQgU0hPVUxEIGhhdmUgYSBuYXJyYXRpdmUuIEluIHNvbWUgY2FzZXMsIGEgcmVzb3VyY2UgbWF5IG9ubHkgaGF2ZSB0ZXh0IHdpdGggbGl0dGxlIG9yIG5vIGFkZGl0aW9uYWwgZGlzY3JldGUgZGF0YSAoYXMgbG9uZyBhcyBhbGwgbWluT2NjdXJzPTEgZWxlbWVudHMgYXJlIHNhdGlzZmllZCkuICBUaGlzIG1heSBiZSBuZWNlc3NhcnkgZm9yIGRhdGEgZnJvbSBsZWdhY3kgc3lzdGVtcyB3aGVyZSBpbmZvcm1hdGlvbiBpcyBjYXB0dXJlZCBhcyBhIFwidGV4dCBibG9iXCIgb3Igd2hlcmUgdGV4dCBpcyBhZGRpdGlvbmFsbHkgZW50ZXJlZCByYXcgb3IgbmFycmF0ZWQgYW5kIGVuY29kZWQgaW5mb3JtYXRpb24gaXMgYWRkZWQgbGF0ZXIuXHJcbiAgICovXHJcbiAgdGV4dD86IGZoaXIuTmFycmF0aXZlQXJnc3x1bmRlZmluZWQ7XHJcbiAgLyoqXHJcbiAgICogVGhpcyBzaG91bGQgbmV2ZXIgYmUgZG9uZSB3aGVuIHRoZSBjb250ZW50IGNhbiBiZSBpZGVudGlmaWVkIHByb3Blcmx5LCBhcyBvbmNlIGlkZW50aWZpY2F0aW9uIGlzIGxvc3QsIGl0IGlzIGV4dHJlbWVseSBkaWZmaWN1bHQgKGFuZCBjb250ZXh0IGRlcGVuZGVudCkgdG8gcmVzdG9yZSBpdCBhZ2Fpbi4gQ29udGFpbmVkIHJlc291cmNlcyBtYXkgaGF2ZSBwcm9maWxlcyBhbmQgdGFncyBJbiB0aGVpciBtZXRhIGVsZW1lbnRzLCBidXQgU0hBTEwgTk9UIGhhdmUgc2VjdXJpdHkgbGFiZWxzLlxyXG4gICAqL1xyXG4gIGNvbnRhaW5lZD86IGZoaXIuUmVzb3VyY2VBcmdzW118YW55W118dW5kZWZpbmVkO1xyXG4gIC8qKlxyXG4gICAqIFRoZXJlIGNhbiBiZSBubyBzdGlnbWEgYXNzb2NpYXRlZCB3aXRoIHRoZSB1c2Ugb2YgZXh0ZW5zaW9ucyBieSBhbnkgYXBwbGljYXRpb24sIHByb2plY3QsIG9yIHN0YW5kYXJkIC0gcmVnYXJkbGVzcyBvZiB0aGUgaW5zdGl0dXRpb24gb3IganVyaXNkaWN0aW9uIHRoYXQgdXNlcyBvciBkZWZpbmVzIHRoZSBleHRlbnNpb25zLiAgVGhlIHVzZSBvZiBleHRlbnNpb25zIGlzIHdoYXQgYWxsb3dzIHRoZSBGSElSIHNwZWNpZmljYXRpb24gdG8gcmV0YWluIGEgY29yZSBsZXZlbCBvZiBzaW1wbGljaXR5IGZvciBldmVyeW9uZS5cclxuICAgKi9cclxuICBleHRlbnNpb24/OiBmaGlyLkV4dGVuc2lvbkFyZ3NbXXx1bmRlZmluZWQ7XHJcbiAgLyoqXHJcbiAgICogVGhlcmUgY2FuIGJlIG5vIHN0aWdtYSBhc3NvY2lhdGVkIHdpdGggdGhlIHVzZSBvZiBleHRlbnNpb25zIGJ5IGFueSBhcHBsaWNhdGlvbiwgcHJvamVjdCwgb3Igc3RhbmRhcmQgLSByZWdhcmRsZXNzIG9mIHRoZSBpbnN0aXR1dGlvbiBvciBqdXJpc2RpY3Rpb24gdGhhdCB1c2VzIG9yIGRlZmluZXMgdGhlIGV4dGVuc2lvbnMuICBUaGUgdXNlIG9mIGV4dGVuc2lvbnMgaXMgd2hhdCBhbGxvd3MgdGhlIEZISVIgc3BlY2lmaWNhdGlvbiB0byByZXRhaW4gYSBjb3JlIGxldmVsIG9mIHNpbXBsaWNpdHkgZm9yIGV2ZXJ5b25lLlxyXG4gICAqL1xyXG4gIG1vZGlmaWVyRXh0ZW5zaW9uPzogZmhpci5FeHRlbnNpb25BcmdzW118dW5kZWZpbmVkO1xyXG59XHJcblxyXG4vKipcclxuICogQSByZXNvdXJjZSB0aGF0IGluY2x1ZGVzIG5hcnJhdGl2ZSwgZXh0ZW5zaW9ucywgYW5kIGNvbnRhaW5lZCByZXNvdXJjZXMuXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgRG9tYWluUmVzb3VyY2UgZXh0ZW5kcyBmaGlyLlJlc291cmNlIHtcclxuICAvKipcclxuICAgKiBNYXBwaW5nIG9mIHRoaXMgZGF0YXR5cGUgdG8gYSBGSElSIGVxdWl2YWxlbnRcclxuICAgKi9cclxuICBwdWJsaWMgc3RhdGljIG92ZXJyaWRlIHJlYWRvbmx5IF9mdHNfZGF0YVR5cGU6c3RyaW5nID0gJ0RvbWFpblJlc291cmNlJztcclxuICAvKipcclxuICAgKiBDb250YWluZWQgcmVzb3VyY2VzIGRvIG5vdCBoYXZlIG5hcnJhdGl2ZS4gUmVzb3VyY2VzIHRoYXQgYXJlIG5vdCBjb250YWluZWQgU0hPVUxEIGhhdmUgYSBuYXJyYXRpdmUuIEluIHNvbWUgY2FzZXMsIGEgcmVzb3VyY2UgbWF5IG9ubHkgaGF2ZSB0ZXh0IHdpdGggbGl0dGxlIG9yIG5vIGFkZGl0aW9uYWwgZGlzY3JldGUgZGF0YSAoYXMgbG9uZyBhcyBhbGwgbWluT2NjdXJzPTEgZWxlbWVudHMgYXJlIHNhdGlzZmllZCkuICBUaGlzIG1heSBiZSBuZWNlc3NhcnkgZm9yIGRhdGEgZnJvbSBsZWdhY3kgc3lzdGVtcyB3aGVyZSBpbmZvcm1hdGlvbiBpcyBjYXB0dXJlZCBhcyBhIFwidGV4dCBibG9iXCIgb3Igd2hlcmUgdGV4dCBpcyBhZGRpdGlvbmFsbHkgZW50ZXJlZCByYXcgb3IgbmFycmF0ZWQgYW5kIGVuY29kZWQgaW5mb3JtYXRpb24gaXMgYWRkZWQgbGF0ZXIuXHJcbiAgICovXHJcbiAgcHVibGljIHRleHQ/OiBmaGlyLk5hcnJhdGl2ZXx1bmRlZmluZWQ7XHJcbiAgLyoqXHJcbiAgICogVGhpcyBzaG91bGQgbmV2ZXIgYmUgZG9uZSB3aGVuIHRoZSBjb250ZW50IGNhbiBiZSBpZGVudGlmaWVkIHByb3Blcmx5LCBhcyBvbmNlIGlkZW50aWZpY2F0aW9uIGlzIGxvc3QsIGl0IGlzIGV4dHJlbWVseSBkaWZmaWN1bHQgKGFuZCBjb250ZXh0IGRlcGVuZGVudCkgdG8gcmVzdG9yZSBpdCBhZ2Fpbi4gQ29udGFpbmVkIHJlc291cmNlcyBtYXkgaGF2ZSBwcm9maWxlcyBhbmQgdGFncyBJbiB0aGVpciBtZXRhIGVsZW1lbnRzLCBidXQgU0hBTEwgTk9UIGhhdmUgc2VjdXJpdHkgbGFiZWxzLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBjb250YWluZWQ6IGZoaXIuRmhpclJlc291cmNlW107XHJcbiAgLyoqXHJcbiAgICogVGhlcmUgY2FuIGJlIG5vIHN0aWdtYSBhc3NvY2lhdGVkIHdpdGggdGhlIHVzZSBvZiBleHRlbnNpb25zIGJ5IGFueSBhcHBsaWNhdGlvbiwgcHJvamVjdCwgb3Igc3RhbmRhcmQgLSByZWdhcmRsZXNzIG9mIHRoZSBpbnN0aXR1dGlvbiBvciBqdXJpc2RpY3Rpb24gdGhhdCB1c2VzIG9yIGRlZmluZXMgdGhlIGV4dGVuc2lvbnMuICBUaGUgdXNlIG9mIGV4dGVuc2lvbnMgaXMgd2hhdCBhbGxvd3MgdGhlIEZISVIgc3BlY2lmaWNhdGlvbiB0byByZXRhaW4gYSBjb3JlIGxldmVsIG9mIHNpbXBsaWNpdHkgZm9yIGV2ZXJ5b25lLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBleHRlbnNpb246IGZoaXIuRXh0ZW5zaW9uW107XHJcbiAgLyoqXHJcbiAgICogVGhlcmUgY2FuIGJlIG5vIHN0aWdtYSBhc3NvY2lhdGVkIHdpdGggdGhlIHVzZSBvZiBleHRlbnNpb25zIGJ5IGFueSBhcHBsaWNhdGlvbiwgcHJvamVjdCwgb3Igc3RhbmRhcmQgLSByZWdhcmRsZXNzIG9mIHRoZSBpbnN0aXR1dGlvbiBvciBqdXJpc2RpY3Rpb24gdGhhdCB1c2VzIG9yIGRlZmluZXMgdGhlIGV4dGVuc2lvbnMuICBUaGUgdXNlIG9mIGV4dGVuc2lvbnMgaXMgd2hhdCBhbGxvd3MgdGhlIEZISVIgc3BlY2lmaWNhdGlvbiB0byByZXRhaW4gYSBjb3JlIGxldmVsIG9mIHNpbXBsaWNpdHkgZm9yIGV2ZXJ5b25lLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBtb2RpZmllckV4dGVuc2lvbjogZmhpci5FeHRlbnNpb25bXTtcclxuICAvKipcclxuICAgKiBEZWZhdWx0IGNvbnN0cnVjdG9yIGZvciBEb21haW5SZXNvdXJjZSAtIGluaXRpYWxpemVzIGFueSByZXF1aXJlZCBlbGVtZW50cyB0byBudWxsIGlmIGEgdmFsdWUgaXMgbm90IHByb3ZpZGVkLlxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKHNvdXJjZTpQYXJ0aWFsPERvbWFpblJlc291cmNlQXJncz4gPSB7fSwgb3B0aW9uczpmaGlyLkZoaXJDb25zdHJ1Y3Rvck9wdGlvbnMgPSB7fSkge1xyXG4gICAgc3VwZXIoc291cmNlLCBvcHRpb25zKTtcclxuICAgIGlmIChzb3VyY2VbJ3RleHQnXSkgeyB0aGlzLnRleHQgPSBuZXcgZmhpci5OYXJyYXRpdmUoc291cmNlLnRleHQsIG9wdGlvbnMpOyB9XHJcbiAgICBpZiAoc291cmNlWydjb250YWluZWQnXSkge1xyXG4gICAgICB0aGlzLmNvbnRhaW5lZCA9IFtdO1xyXG4gICAgICBzb3VyY2UuY29udGFpbmVkLmZvckVhY2goKHgpID0+IHtcclxuICAgICAgICB2YXIgciA9IGZoaXIucmVzb3VyY2VGYWN0b3J5KHgsIG9wdGlvbnMpO1xyXG4gICAgICAgIGlmIChyKSB7IHRoaXMuY29udGFpbmVkIS5wdXNoKHIpOyB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7IHRoaXMuY29udGFpbmVkID0gW107IH1cclxuICAgIGlmIChzb3VyY2VbJ2V4dGVuc2lvbiddKSB7IHRoaXMuZXh0ZW5zaW9uID0gc291cmNlLmV4dGVuc2lvbi5tYXAoKHgpID0+IG5ldyBmaGlyLkV4dGVuc2lvbih4LCBvcHRpb25zKSk7IH1cclxuICAgIGVsc2UgeyB0aGlzLmV4dGVuc2lvbiA9IFtdOyB9XHJcbiAgICBpZiAoc291cmNlWydtb2RpZmllckV4dGVuc2lvbiddKSB7IHRoaXMubW9kaWZpZXJFeHRlbnNpb24gPSBzb3VyY2UubW9kaWZpZXJFeHRlbnNpb24ubWFwKCh4KSA9PiBuZXcgZmhpci5FeHRlbnNpb24oeCwgb3B0aW9ucykpOyB9XHJcbiAgICBlbHNlIHsgdGhpcy5tb2RpZmllckV4dGVuc2lvbiA9IFtdOyB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIEZ1bmN0aW9uIHRvIHBlcmZvcm0gYmFzaWMgbW9kZWwgdmFsaWRhdGlvbiAoZS5nLiwgY2hlY2sgaWYgcmVxdWlyZWQgZWxlbWVudHMgYXJlIHByZXNlbnQpLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBvdmVycmlkZSBkb01vZGVsVmFsaWRhdGlvbihleHA6c3RyaW5nID0gJycpOmZoaXIuRnRzSXNzdWVbXSB7XHJcbiAgICBsZXQgaXNzOmZoaXIuRnRzSXNzdWVbXSA9IHN1cGVyLmRvTW9kZWxWYWxpZGF0aW9uKGV4cCk7XHJcbiAgICBpZiAoZXhwID09PSAnJykgeyBleHAgPSAnRG9tYWluUmVzb3VyY2UnIH1cclxuICAgIGlzcy5wdXNoKC4uLnRoaXMudk9TKCd0ZXh0JyxleHApKTtcclxuICAgIGlzcy5wdXNoKC4uLnRoaXMudk9BKCdjb250YWluZWQnLGV4cCkpO1xyXG4gICAgaXNzLnB1c2goLi4udGhpcy52T0EoJ2V4dGVuc2lvbicsZXhwKSk7XHJcbiAgICBpc3MucHVzaCguLi50aGlzLnZPQSgnbW9kaWZpZXJFeHRlbnNpb24nLGV4cCkpO1xyXG4gICAgcmV0dXJuIGlzcztcclxuICB9XHJcbiAgLyoqXHJcbiAgICogRmx1ZW50LXN0eWxlIGZ1bmN0aW9uIHRvIGFkZCBleHRlbnNpb25zXHJcbiAgICogQHBhcmFtIGV4dFxyXG4gICAqIEByZXR1cm5zIFxyXG4gICAqL1xyXG4gIHB1YmxpYyBhZGRFeHRlbnNpb24oZXh0OmZoaXIuRXh0ZW5zaW9uQXJncyk6RG9tYWluUmVzb3VyY2Uge1xyXG4gICAgdGhpcy5leHRlbnNpb24ucHVzaChuZXcgZmhpci5FeHRlbnNpb24oZXh0KSk7XHJcbiAgICByZXR1cm4gdGhpcztcclxuICB9XHJcbiAgXHJcbiAgLyoqXHJcbiAgICogUmVtb3ZlIEFMTCBpbnN0YW5jZXMgb2YgZXh0ZW5zaW9ucyB3aXRoIGEgbWF0Y2hpbmcgVVJMLCBvcHRpb25hbGx5IHJlY3Vyc2UgaW50byBleHRlbnNpb24uZXh0ZW5zaW9uLlxyXG4gICAqIEBwYXJhbSB1cmwgVVJMIG9mIGV4dGVuc2lvbnMgdG8gcmVtb3ZlXHJcbiAgICogQHBhcmFtIHNlYXJjaE5lc3RlZCBJZiB0aGUgcmVtb3ZhbCBzaG91bGQgc2VhcmNoIGZvciBuZXN0ZWQgZXh0ZW5zaW9uc1xyXG4gICAqL1xyXG4gIHB1YmxpYyByZW1vdmVFeHRlbnNpb25zKHVybDpmaGlyLkZoaXJTdHJpbmd8c3RyaW5nLCBzZWFyY2hOZXN0ZWQ6Ym9vbGVhbiA9IGZhbHNlKTpEb21haW5SZXNvdXJjZSB7XHJcbiAgICBpZiAodGhpcy5leHRlbnNpb24ubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG4gICAgY29uc3QgbWF0Y2hVcmw6c3RyaW5nID0gKHR5cGVvZiB1cmwgPT09ICdzdHJpbmcnKSA/IHVybCA6ICh1cmwgYXMgZmhpci5GaGlyU3RyaW5nKS52YWx1ZSA/PyAnJztcclxuICAgIGxldCBjbGVhbjpmaGlyLkV4dGVuc2lvbltdID0gdGhpcy5leHRlbnNpb24uZmlsdGVyKChleHQpID0+IChleHQ/LnVybD8udmFsdWUgPz8gJycpICE9PSBtYXRjaFVybCkgPz8gW107XHJcbiAgICBpZiAoc2VhcmNoTmVzdGVkKSB7XHJcbiAgICAgIGZvciAobGV0IGk6bnVtYmVyID0gMDsgaSA8IGNsZWFuLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgY2xlYW5baV0gPSBjbGVhbltpXS5yZW1vdmVFeHRlbnNpb25zKG1hdGNoVXJsLCBzZWFyY2hOZXN0ZWQpIGFzIGZoaXIuRXh0ZW5zaW9uO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICB0aGlzLmV4dGVuc2lvbiA9IGNsZWFuO1xyXG4gICAgcmV0dXJuIHRoaXM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGaW5kIHRoZSBmaXJzdCBpbnN0YW5jZSBvZiBhbiBleHRlbnNpb24gd2l0aCBhIG1hdGNoaW5nIFVSTCwgb3B0aW9uYWxseSByZWN1cnNlIGludG8gZXh0ZW5zaW9uLmV4dGVuc2lvbi5cclxuICAgKiBAcGFyYW0gdXJsIFVSTCB0byBzZWFyY2ggZm9yXHJcbiAgICogQHBhcmFtIHNlYXJjaE5lc3RlZCBJZiB0aGUgc2VhcmNoIHNob3VsZCBuZXN0IGludG8gZXh0ZW5zaW9uc1xyXG4gICAqIEByZXR1cm5zIFRoZSBGSElSIEV4dGVuc2lvbiBpZiBmb3VuZCwgb3IgdW5kZWZpbmVkLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBmaW5kRXh0ZW5zaW9uKHVybDpmaGlyLkZoaXJTdHJpbmd8c3RyaW5nLCBzZWFyY2hOZXN0ZWQ6Ym9vbGVhbiA9IGZhbHNlKTpmaGlyLkV4dGVuc2lvbnx1bmRlZmluZWQge1xyXG4gICAgaWYgKHRoaXMuZXh0ZW5zaW9uLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgfVxyXG4gICAgY29uc3QgbWF0Y2hVcmw6c3RyaW5nID0gKHR5cGVvZiB1cmwgPT09ICdzdHJpbmcnKSA/IHVybCA6ICh1cmwgYXMgZmhpci5GaGlyU3RyaW5nKS52YWx1ZSA/PyAnJztcclxuICAgIGlmIChzZWFyY2hOZXN0ZWQpIHtcclxuICAgICAgY29uc3QgZmxhdDpmaGlyLkV4dGVuc2lvbltdID0gRG9tYWluUmVzb3VyY2UucmVjdXJzZUZvckV4dGVuc2lvbihtYXRjaFVybCwgdGhpcy5leHRlbnNpb24pO1xyXG4gICAgICBpZiAoZmxhdC5sZW5ndGggPT09IDApIHtcclxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBmbGF0WzBdO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRoaXMuZXh0ZW5zaW9uLmZpbmQoKGV4dCkgPT4gKGV4dD8udXJsPy52YWx1ZSA9PT0gbWF0Y2hVcmwpKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZpbmQgYWxsIGluc3RhbmNlcyBvZiBhbiBleHRlbnNpb24gd2l0aCBhIG1hdGNoaW5nIFVSTCwgb3B0aW9uYWxseSByZWN1cnNlIGludG8gZXh0ZW5zaW9uLmV4dGVuc2lvbi5cclxuICAgKiBAcGFyYW0gdXJsIFVSTCB0byBzZWFyY2ggZm9yXHJcbiAgICogQHBhcmFtIHNlYXJjaE5lc3RlZCBJZiB0aGUgc2VhcmNoIHNob3VsZCBuZXN0IGludG8gZXh0ZW5zaW9uc1xyXG4gICAqIEByZXR1cm5zIEEgbmV3IGFycmF5IG9mIEZISVIgRXh0ZW5zaW9ucywgd2l0aCBqdXN0IHRoZSBkZXNpcmVkIGV4dGVuc2lvbnNcclxuICAgKi9cclxuICBwdWJsaWMgZmlsdGVyRXh0ZW5zaW9ucyh1cmw6Zmhpci5GaGlyU3RyaW5nfHN0cmluZywgc2VhcmNoTmVzdGVkOmJvb2xlYW4gPSBmYWxzZSk6Zmhpci5FeHRlbnNpb25bXSB7XHJcbiAgICBpZiAodGhpcy5leHRlbnNpb24ubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIHJldHVybiBbXTtcclxuICAgIH1cclxuICAgIGNvbnN0IG1hdGNoVXJsOnN0cmluZyA9ICh0eXBlb2YgdXJsID09PSAnc3RyaW5nJykgPyB1cmwgOiAodXJsIGFzIGZoaXIuRmhpclN0cmluZykudmFsdWUgPz8gJyc7XHJcbiAgICBpZiAoc2VhcmNoTmVzdGVkKSB7XHJcbiAgICAgIHJldHVybiBEb21haW5SZXNvdXJjZS5yZWN1cnNlRm9yRXh0ZW5zaW9uKG1hdGNoVXJsLCB0aGlzLmV4dGVuc2lvbik7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcy5leHRlbnNpb24uZmlsdGVyKChleHQpID0+IChleHQ/LnVybD8udmFsdWUgPT09IG1hdGNoVXJsKSlcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEludGVybmFsIHJlY3Vyc2l2ZSBzZWFyY2ggZnVuY3Rpb25cclxuICAgKiBAcGFyYW0gdXJsIFxyXG4gICAqIEBwYXJhbSBleHRzIFxyXG4gICAqIEByZXR1cm5zIEEgbmV3IGFycmF5IChmbGF0KSBvZiBtYXRjaGluZyBleHRlbnNpb25zXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzdGF0aWMgcmVjdXJzZUZvckV4dGVuc2lvbih1cmw6c3RyaW5nLCBleHRzOmZoaXIuRXh0ZW5zaW9uW10pOmZoaXIuRXh0ZW5zaW9uW10ge1xyXG4gICAgaWYgKCghZXh0cykgfHwgKGV4dHMubGVuZ3RoID09PSAwKSkge1xyXG4gICAgICByZXR1cm4gW107XHJcbiAgICB9XHJcbiAgICBsZXQgdmFsOmZoaXIuRXh0ZW5zaW9uW10gPSBbXTtcclxuICAgIGV4dHMuZm9yRWFjaChcclxuICAgICAgKGV4dCkgPT4ge1xyXG4gICAgICAgIGlmIChleHQgJiYgZXh0LnVybCAmJiAoZXh0LnVybC52YWx1ZSA9PT0gdXJsKSkge1xyXG4gICAgICAgICAgdmFsLnB1c2goZXh0KTtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGV4dCAmJiBleHQuZXh0ZW5zaW9uICYmIChleHQuZXh0ZW5zaW9uLmxlbmd0aCA+IDApKSB7XHJcbiAgICAgICAgICB2YWwucHVzaCguLi50aGlzLnJlY3Vyc2VGb3JFeHRlbnNpb24odXJsLCBleHQuZXh0ZW5zaW9uKSk7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfSxcclxuICAgICAgW10pO1xyXG4gICAgcmV0dXJuIHZhbDtcclxuICB9XHJcblxyXG59XHJcbiJdfQ==