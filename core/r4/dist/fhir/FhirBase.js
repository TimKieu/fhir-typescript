// Minimum TypeScript Version: 3.7
export class FhirBase {
    /** Default constructor */
    constructor(source = {}, options = {}) {
        if (options.allowUnknownElements === true) {
            Object.assign(this, source);
        }
    }
    /**
     * Function to perform basic model validation (e.g., check if required elements are present).
     */
    doModelValidation(_expression = '') {
        let issues = [];
        return issues;
    }
    /**
     * Function to strip invalid element values for serialization.
     */
    toJSON() {
        let c = {};
        for (const key in this) {
            if ((this[key] === undefined) ||
                (this[key] === null) ||
                (this[key] === '') ||
                (Number.isNaN(this[key]))) {
                continue;
            }
            let isArray = Array.isArray(this[key]);
            if (isArray && this[key].length === 0) {
                continue;
            }
            let ftsDt = (isArray ? this[key][0].constructor._fts_dataType : this[key].constructor._fts_dataType) ?? '';
            let isChoice = this.constructor['_fts_' + key + 'IsChoice'] ?? false;
            let isPrimitive = (isArray ? this[key][0].constructor['_fts_isPrimitive'] : this[key].constructor['_fts_isPrimitive']) ?? false;
            let dKey = key + (isChoice ? ftsDt : '');
            if (isArray) {
                if (isPrimitive) {
                    const eName = '_' + dKey;
                    let foundAnyVal = false;
                    let foundAnyExt = false;
                    c[dKey] = [];
                    c[eName] = [];
                    this[key].forEach((av) => {
                        let addElement = false;
                        if (av.value) {
                            c[dKey].push(av.value);
                            foundAnyVal = true;
                            addElement = true;
                        }
                        else {
                            c[dKey].push(null);
                        }
                        let ao = {};
                        if (av.id) {
                            ao['id'] = av.id;
                            foundAnyExt = true;
                        }
                        if ((av.extension) && (av.extension.length !== 0)) {
                            ao['extension'] = [];
                            av.extension.forEach((e) => {
                                ao['extension'].push(e);
                            });
                            foundAnyExt = true;
                        }
                        if (foundAnyExt) {
                            c[eName].push(ao);
                            addElement = true;
                        }
                        else {
                            c[eName].push(null);
                        }
                        if (!addElement) {
                            c[dKey].pop();
                            c[eName].pop();
                        }
                    });
                    if (!foundAnyVal) {
                        delete c[dKey];
                    }
                    if (!foundAnyExt) {
                        delete c[eName];
                    }
                }
                else if (ftsDt) {
                    c[dKey] = [];
                    this[key].forEach((v) => {
                        // c[dKey].push(v.toJSON());
                        c[dKey].push(v);
                    });
                }
                else {
                    c[dKey] = this[key];
                }
            }
            else if (isPrimitive) {
                if (this[key].value) {
                    c[dKey] = this[key].value;
                }
                const eName = '_' + dKey;
                c[eName] = {};
                if (this[key]['id']) {
                    c[eName]['id'] = this[key]['id'];
                }
                if ((this[key]['extension']) && (this[key]['extension'].length !== 0)) {
                    c[eName]['extension'] = [];
                    this[key]['extension'].forEach((e) => {
                        c[eName]['extension'].push(e);
                    });
                }
                if (Object.keys(c[eName]).length === 0) {
                    delete c[eName];
                }
            }
            else if (ftsDt) {
                c[dKey] = this[key];
            }
            else {
                c[dKey] = this[key];
            }
        }
        return c;
    }
}
/**
 * Mapping of this datatype to a FHIR equivalent
 */
FhirBase._fts_dataType = 'Base';
FhirBase._fts_regex = /.?/;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRmhpckJhc2UuanMiLCJzb3VyY2VSb290IjoiLi9zcmMvIiwic291cmNlcyI6WyJmaGlyL0ZoaXJCYXNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLGtDQUFrQztBQXFGbEMsTUFBTSxPQUFPLFFBQVE7SUFPbkIsMEJBQTBCO0lBQzFCLFlBQVksU0FBK0IsRUFBRSxFQUFFLFVBQWlDLEVBQUU7UUFDaEYsSUFBSSxPQUFPLENBQUMsb0JBQW9CLEtBQUssSUFBSSxFQUFFO1lBQUUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUM7U0FBRTtJQUM3RSxDQUFDO0lBRUQ7O09BRUc7SUFDSyxpQkFBaUIsQ0FBQyxjQUFxQixFQUFFO1FBQy9DLElBQUksTUFBTSxHQUFjLEVBQUUsQ0FBQztRQUMzQixPQUFPLE1BQU0sQ0FBQztJQUNoQixDQUFDO0lBRUQ7O09BRUc7SUFDSyxNQUFNO1FBQ1osSUFBSSxDQUFDLEdBQU8sRUFBRSxDQUFDO1FBRWYsS0FBSyxNQUFNLEdBQUcsSUFBSyxJQUFZLEVBQUU7WUFDL0IsSUFBSSxDQUFFLElBQVksQ0FBQyxHQUFHLENBQUMsS0FBSyxTQUFTLENBQUM7Z0JBQ2xDLENBQUUsSUFBWSxDQUFDLEdBQUcsQ0FBQyxLQUFLLElBQUksQ0FBQztnQkFDN0IsQ0FBRSxJQUFZLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxDQUFDO2dCQUMzQixDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUUsSUFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRTtnQkFDdEMsU0FBUzthQUNWO1lBRUQsSUFBSSxPQUFPLEdBQVcsS0FBSyxDQUFDLE9BQU8sQ0FBRSxJQUFZLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztZQUV4RCxJQUFJLE9BQU8sSUFBSyxJQUFZLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtnQkFDOUMsU0FBUzthQUNWO1lBRUQsSUFBSSxLQUFLLEdBQVUsQ0FBQyxP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QUMsQ0FBQyxJQUFJLENBQUUsSUFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUMsRUFBRTtvQkFDdkYsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLFdBQVcsQ0FBQyxHQUFHLEVBQUUsQ0FBQztvQkFDMUIsSUFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUssRUFBRSxFQUFFO3dCQUNoRCxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsV0FBVyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUNoQyxDQUFDLENBQUMsQ0FBQztpQkFDSjtnQkFFRCxJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtvQkFBRSxPQUFPLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQztpQkFBRTthQUM3RDtpQkFBTSxJQUFJLEtBQUssRUFBRTtnQkFDaEIsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFJLElBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQzthQUM5QjtpQkFBTTtnQkFDTCxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUksSUFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2FBQzlCO1NBQ0Y7UUFFRCxPQUFPLENBQUMsQ0FBQztJQUNYLENBQUM7O0FBeEhEOztHQUVHO0FBQ29CLHNCQUFhLEdBQVEsTUFBTSxDQUFDO0FBQzVCLG1CQUFVLEdBQVUsSUFBSSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gTWluaW11bSBUeXBlU2NyaXB0IFZlcnNpb246IDMuN1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBGaGlyQ29uc3RydWN0b3JPcHRpb25zIHtcclxuICAvKiogSWYgaW5zdGFudGlhdGVkIG9iamVjdHMgc2hvdWxkIGFsbG93IG5vbi1GSElSIGRlZmluZWQgcHJvcGVydGllcyAqL1xyXG4gIGFsbG93VW5rbm93bkVsZW1lbnRzPzogYm9vbGVhbnx1bmRlZmluZWQ7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBJbnRlcm5hbCBFbGVtZW50IC0gZXF1aXZhbGVudCB0byBhIEZISVIgSlNPTiBFbGVtZW50IChDb21wbGV4IERhdGFUeXBlKSwgd2l0aG91dCBleHRlbnNpb25zXHJcbiAqL1xyXG5leHBvcnQgaW50ZXJmYWNlIEZ0c0VsZW1lbnQge1xyXG4gIC8qKlxyXG4gICAqIFVuaXF1ZSBpZCBmb3IgdGhlIGVsZW1lbnQgd2l0aGluIGEgcmVzb3VyY2UgKGZvciBpbnRlcm5hbCByZWZlcmVuY2VzKS4gVGhpcyBtYXkgYmUgYW55IHN0cmluZyB2YWx1ZSB0aGF0IGRvZXMgbm90IGNvbnRhaW4gc3BhY2VzLlxyXG4gICAqL1xyXG4gICBpZD86IHN0cmluZ3x1bmRlZmluZWQ7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBJbnRlcm5hbCBjb2RpbmcgLSBlcXVpdmFsZW50IHRvIGEgRkhJUiBKU09OIENvZGluZyAoQ29tcGxleCBEYXRhVHlwZSksIHdpdGhvdXQgZXh0ZW5zaW9uc1xyXG4gKi9cclxuZXhwb3J0IGludGVyZmFjZSBGdHNDb2RpbmcgZXh0ZW5kcyBGdHNFbGVtZW50IHtcclxuICAvKipcclxuICAgKiBUaGUgVVJJIG1heSBiZSBhbiBPSUQgKHVybjpvaWQ6Li4uKSBvciBhIFVVSUQgKHVybjp1dWlkOi4uLikuICBPSURzIGFuZCBVVUlEcyBTSEFMTCBiZSByZWZlcmVuY2VzIHRvIHRoZSBITDcgT0lEIHJlZ2lzdHJ5LiBPdGhlcndpc2UsIHRoZSBVUkkgc2hvdWxkIGNvbWUgZnJvbSBITDcncyBsaXN0IG9mIEZISVIgZGVmaW5lZCBzcGVjaWFsIFVSSXMgb3IgaXQgc2hvdWxkIHJlZmVyZW5jZSB0byBzb21lIGRlZmluaXRpb24gdGhhdCBlc3RhYmxpc2hlcyB0aGUgc3lzdGVtIGNsZWFybHkgYW5kIHVuYW1iaWd1b3VzbHkuXHJcbiAgICovXHJcbiAgIHN5c3RlbT86IHN0cmluZ3x1bmRlZmluZWQ7XHJcbiAgIC8qKlxyXG4gICAgKiBXaGVyZSB0aGUgdGVybWlub2xvZ3kgZG9lcyBub3QgY2xlYXJseSBkZWZpbmUgd2hhdCBzdHJpbmcgc2hvdWxkIGJlIHVzZWQgdG8gaWRlbnRpZnkgY29kZSBzeXN0ZW0gdmVyc2lvbnMsIHRoZSByZWNvbW1lbmRhdGlvbiBpcyB0byB1c2UgdGhlIGRhdGUgKGV4cHJlc3NlZCBpbiBGSElSIGRhdGUgZm9ybWF0KSBvbiB3aGljaCB0aGF0IHZlcnNpb24gd2FzIG9mZmljaWFsbHkgcHVibGlzaGVkIGFzIHRoZSB2ZXJzaW9uIGRhdGUuXHJcbiAgICAqL1xyXG4gICB2ZXJzaW9uPzogc3RyaW5nfHVuZGVmaW5lZDtcclxuICAgLyoqXHJcbiAgICAqIEEgc3ltYm9sIGluIHN5bnRheCBkZWZpbmVkIGJ5IHRoZSBzeXN0ZW0uIFRoZSBzeW1ib2wgbWF5IGJlIGEgcHJlZGVmaW5lZCBjb2RlIG9yIGFuIGV4cHJlc3Npb24gaW4gYSBzeW50YXggZGVmaW5lZCBieSB0aGUgY29kaW5nIHN5c3RlbSAoZS5nLiBwb3N0LWNvb3JkaW5hdGlvbikuXHJcbiAgICAqL1xyXG4gICBjb2RlPzogc3RyaW5nfHVuZGVmaW5lZDtcclxuICAgLyoqXHJcbiAgICAqIEEgcmVwcmVzZW50YXRpb24gb2YgdGhlIG1lYW5pbmcgb2YgdGhlIGNvZGUgaW4gdGhlIHN5c3RlbSwgZm9sbG93aW5nIHRoZSBydWxlcyBvZiB0aGUgc3lzdGVtLlxyXG4gICAgKi9cclxuICAgZGlzcGxheT86IHN0cmluZ3x1bmRlZmluZWQ7XHJcbiAgIC8qKlxyXG4gICAgKiBBbW9uZ3N0IGEgc2V0IG9mIGFsdGVybmF0aXZlcywgYSBkaXJlY3RseSBjaG9zZW4gY29kZSBpcyB0aGUgbW9zdCBhcHByb3ByaWF0ZSBzdGFydGluZyBwb2ludCBmb3IgbmV3IHRyYW5zbGF0aW9ucy4gVGhlcmUgaXMgc29tZSBhbWJpZ3VpdHkgYWJvdXQgd2hhdCBleGFjdGx5ICdkaXJlY3RseSBjaG9zZW4nIGltcGxpZXMsIGFuZCB0cmFkaW5nIHBhcnRuZXIgYWdyZWVtZW50IG1heSBiZSBuZWVkZWQgdG8gY2xhcmlmeSB0aGUgdXNlIG9mIHRoaXMgZWxlbWVudCBhbmQgaXRzIGNvbnNlcXVlbmNlcyBtb3JlIGNvbXBsZXRlbHkuXHJcbiAgICAqL1xyXG4gICB1c2VyU2VsZWN0ZWQ/OiBib29sZWFufHVuZGVmaW5lZDtcclxufVxyXG5cclxuLyoqXHJcbiAqIEludGVybmFsIENvZGVhYmxlQ29uY2VwdCAtIGVxdWl2YWxlbnQgdG8gYSBGSElSIEpTT04gQ29kZWFibGVDb25jZXB0IChDb21wbGV4IERhdGFUeXBlKSwgd2l0aG91dCBleHRlbnNpb25zXHJcbiAqL1xyXG4gZXhwb3J0IGludGVyZmFjZSBGdHNDb2RlYWJsZUNvbmNlcHQgZXh0ZW5kcyBGdHNFbGVtZW50IHsgXHJcbiAgLyoqXHJcbiAgICogQ29kZXMgbWF5IGJlIGRlZmluZWQgdmVyeSBjYXN1YWxseSBpbiBlbnVtZXJhdGlvbnMsIG9yIGNvZGUgbGlzdHMsIHVwIHRvIHZlcnkgZm9ybWFsIGRlZmluaXRpb25zIHN1Y2ggYXMgU05PTUVEIENUIC0gc2VlIHRoZSBITDcgdjMgQ29yZSBQcmluY2lwbGVzIGZvciBtb3JlIGluZm9ybWF0aW9uLiAgT3JkZXJpbmcgb2YgY29kaW5ncyBpcyB1bmRlZmluZWQgYW5kIFNIQUxMIE5PVCBiZSB1c2VkIHRvIGluZmVyIG1lYW5pbmcuIEdlbmVyYWxseSwgYXQgbW9zdCBvbmx5IG9uZSBvZiB0aGUgY29kaW5nIHZhbHVlcyB3aWxsIGJlIGxhYmVsZWQgYXMgVXNlclNlbGVjdGVkID0gdHJ1ZS5cclxuICAgKi9cclxuICBjb2Rpbmc/OiBGdHNDb2RpbmdbXXx1bmRlZmluZWQ7XHJcbiAgLyoqXHJcbiAgICogVmVyeSBvZnRlbiB0aGUgdGV4dCBpcyB0aGUgc2FtZSBhcyBhIGRpc3BsYXlOYW1lIG9mIG9uZSBvZiB0aGUgY29kaW5ncy5cclxuICAgKi9cclxuICB0ZXh0Pzogc3RyaW5nfHVuZGVmaW5lZDtcclxufVxyXG5cclxuLyoqXHJcbiAqIEludGVybmFsIE9wZXJhdGlvbk91dGNvbWVJc3N1ZSAtIGVxdWl2YWxlbnQgdG8gT3BlcmF0aW9uT3V0Y29tZS5pc3N1ZSAoQmFja2JvbmUgRWxlbWVudCksIHdpdGhvdXQgZXh0ZW5zaW9uc1xyXG4gKi9cclxuZXhwb3J0IGludGVyZmFjZSBGdHNJc3N1ZSBleHRlbmRzIEZ0c0VsZW1lbnQge1xyXG4gIC8qKlxyXG4gICAqIFRoaXMgaXMgbGFiZWxlZCBhcyBcIklzIE1vZGlmaWVyXCIgYmVjYXVzZSBhcHBsaWNhdGlvbnMgc2hvdWxkIG5vdCBjb25mdXNlIGhpbnRzIGFuZCB3YXJuaW5ncyB3aXRoIGVycm9ycy5cclxuICAgKi9cclxuICAgc2V2ZXJpdHk6ICdlcnJvcid8J2ZhdGFsJ3wnaW5mb3JtYXRpb24nfCd3YXJuaW5nJ3xudWxsO1xyXG4gICAvKipcclxuICAgICogRGVzY3JpYmVzIHRoZSB0eXBlIG9mIHRoZSBpc3N1ZS4gVGhlIHN5c3RlbSB0aGF0IGNyZWF0ZXMgYW4gT3BlcmF0aW9uT3V0Y29tZSBTSEFMTCBjaG9vc2UgdGhlIG1vc3QgYXBwbGljYWJsZSBjb2RlIGZyb20gdGhlIElzc3VlVHlwZSB2YWx1ZSBzZXQsIGFuZCBtYXkgYWRkaXRpb25hbCBwcm92aWRlIGl0cyBvd24gY29kZSBmb3IgdGhlIGVycm9yIGluIHRoZSBkZXRhaWxzIGVsZW1lbnQuXHJcbiAgICAqL1xyXG4gICBjb2RlOiAnYnVzaW5lc3MtcnVsZSd8J2NvZGUtaW52YWxpZCd8J2NvbmZsaWN0J3wnZGVsZXRlZCd8J2R1cGxpY2F0ZSd8J2V4Y2VwdGlvbid8J2V4cGlyZWQnfCdleHRlbnNpb24nfCdmb3JiaWRkZW4nfCdpbmNvbXBsZXRlJ3wnaW5mb3JtYXRpb25hbCd8J2ludmFsaWQnfCdpbnZhcmlhbnQnfCdsb2NrLWVycm9yJ3wnbG9naW4nfCdtdWx0aXBsZS1tYXRjaGVzJ3wnbm8tc3RvcmUnfCdub3QtZm91bmQnfCdub3Qtc3VwcG9ydGVkJ3wncHJvY2Vzc2luZyd8J3JlcXVpcmVkJ3wnc2VjdXJpdHknfCdzdHJ1Y3R1cmUnfCdzdXBwcmVzc2VkJ3wndGhyb3R0bGVkJ3wndGltZW91dCd8J3Rvby1jb3N0bHknfCd0b28tbG9uZyd8J3RyYW5zaWVudCd8J3Vua25vd24nfCd2YWx1ZSd8bnVsbDtcclxuICAgLyoqXHJcbiAgICAqIEEgaHVtYW4gcmVhZGFibGUgZGVzY3JpcHRpb24gb2YgdGhlIGVycm9yIGlzc3VlIFNIT1VMRCBiZSBwbGFjZWQgaW4gZGV0YWlscy50ZXh0LlxyXG4gICAgKi9cclxuICAgZGV0YWlscz86IEZ0c0NvZGVhYmxlQ29uY2VwdHx1bmRlZmluZWQ7XHJcbiAgIC8qKlxyXG4gICAgKiBUaGlzIG1heSBiZSBhIGRlc2NyaXB0aW9uIG9mIGhvdyBhIHZhbHVlIGlzIGVycm9uZW91cywgYSBzdGFjayBkdW1wIHRvIGhlbHAgdHJhY2UgdGhlIGlzc3VlIG9yIG90aGVyIHRyb3VibGVzaG9vdGluZyBpbmZvcm1hdGlvbi5cclxuICAgICovXHJcbiAgIGRpYWdub3N0aWNzPzogc3RyaW5nfHVuZGVmaW5lZDtcclxuICAgLyoqXHJcbiAgICAqIFRoZSByb290IG9mIHRoZSBGSElSUGF0aCBpcyB0aGUgcmVzb3VyY2Ugb3IgYnVuZGxlIHRoYXQgZ2VuZXJhdGVkIE9wZXJhdGlvbk91dGNvbWUuICBFYWNoIEZISVJQYXRoIFNIQUxMIHJlc29sdmUgdG8gYSBzaW5nbGUgbm9kZS5cclxuICAgICovXHJcbiAgIGV4cHJlc3Npb24/OiBzdHJpbmdbXXx1bmRlZmluZWQ7XHJcbiB9XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIEZoaXJCYXNlQXJncyB7IH1cclxuXHJcbmV4cG9ydCBjbGFzcyBGaGlyQmFzZSB7XHJcbiAgLyoqXHJcbiAgICogTWFwcGluZyBvZiB0aGlzIGRhdGF0eXBlIHRvIGEgRkhJUiBlcXVpdmFsZW50XHJcbiAgICovXHJcbiAgcHVibGljIHN0YXRpYyByZWFkb25seSBfZnRzX2RhdGFUeXBlOnN0cmluZz0nQmFzZSc7XHJcbiAgcHVibGljIHN0YXRpYyByZWFkb25seSBfZnRzX3JlZ2V4OlJlZ0V4cCA9IC8uPy87XHJcblxyXG4gIC8qKiBEZWZhdWx0IGNvbnN0cnVjdG9yICovXHJcbiAgY29uc3RydWN0b3Ioc291cmNlOlBhcnRpYWw8RmhpckJhc2VBcmdzPiA9IHt9LCBvcHRpb25zOkZoaXJDb25zdHJ1Y3Rvck9wdGlvbnMgPSB7fSkge1xyXG4gICAgaWYgKG9wdGlvbnMuYWxsb3dVbmtub3duRWxlbWVudHMgPT09IHRydWUpIHsgT2JqZWN0LmFzc2lnbih0aGlzLCBzb3VyY2UpOyB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGdW5jdGlvbiB0byBwZXJmb3JtIGJhc2ljIG1vZGVsIHZhbGlkYXRpb24gKGUuZy4sIGNoZWNrIGlmIHJlcXVpcmVkIGVsZW1lbnRzIGFyZSBwcmVzZW50KS5cclxuICAgKi9cclxuICAgcHVibGljIGRvTW9kZWxWYWxpZGF0aW9uKF9leHByZXNzaW9uOnN0cmluZyA9ICcnKTpGdHNJc3N1ZVtdIHtcclxuICAgIGxldCBpc3N1ZXM6RnRzSXNzdWVbXSA9IFtdO1xyXG4gICAgcmV0dXJuIGlzc3VlcztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZ1bmN0aW9uIHRvIHN0cmlwIGludmFsaWQgZWxlbWVudCB2YWx1ZXMgZm9yIHNlcmlhbGl6YXRpb24uXHJcbiAgICovXHJcbiAgIHB1YmxpYyB0b0pTT04oKSB7XHJcbiAgICBsZXQgYzphbnkgPSB7fTtcclxuICBcclxuICAgIGZvciAoY29uc3Qga2V5IGluICh0aGlzIGFzIGFueSkpIHtcclxuICAgICAgaWYgKCgodGhpcyBhcyBhbnkpW2tleV0gPT09IHVuZGVmaW5lZCkgfHwgXHJcbiAgICAgICAgICAoKHRoaXMgYXMgYW55KVtrZXldID09PSBudWxsKSB8fFxyXG4gICAgICAgICAgKCh0aGlzIGFzIGFueSlba2V5XSA9PT0gJycpIHx8XHJcbiAgICAgICAgICAoTnVtYmVyLmlzTmFOKCh0aGlzIGFzIGFueSlba2V5XSkpKSB7XHJcbiAgICAgICAgY29udGludWU7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGxldCBpc0FycmF5OmJvb2xlYW4gPSBBcnJheS5pc0FycmF5KCh0aGlzIGFzIGFueSlba2V5XSk7XHJcblxyXG4gICAgICBpZiAoaXNBcnJheSAmJiAodGhpcyBhcyBhbnkpW2tleV0ubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgY29udGludWU7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGxldCBmdHNEdDpzdHJpbmcgPSAoaXNBcnJheSA/ICh0aGlzIGFzIGFueSlba2V5XVswXS5jb25zdHJ1Y3Rvci5fZnRzX2RhdGFUeXBlIDogKHRoaXMgYXMgYW55KVtrZXldLmNvbnN0cnVjdG9yLl9mdHNfZGF0YVR5cGUpID8/ICcnO1xyXG4gICAgICBsZXQgaXNDaG9pY2U6Ym9vbGVhbiA9ICh0aGlzIGFzIGFueSkuY29uc3RydWN0b3JbJ19mdHNfJyArIGtleSArICdJc0Nob2ljZSddID8/IGZhbHNlO1xyXG4gICAgICBsZXQgaXNQcmltaXRpdmUgPSAoaXNBcnJheSA/ICh0aGlzIGFzIGFueSlba2V5XVswXS5jb25zdHJ1Y3RvclsnX2Z0c19pc1ByaW1pdGl2ZSddIDogKHRoaXMgYXMgYW55KVtrZXldLmNvbnN0cnVjdG9yWydfZnRzX2lzUHJpbWl0aXZlJ10pID8/IGZhbHNlO1xyXG4gICAgICBsZXQgZEtleTpzdHJpbmcgPSBrZXkgKyAoaXNDaG9pY2UgPyBmdHNEdCA6ICcnKTtcclxuICBcclxuICAgICAgaWYgKGlzQXJyYXkpIHtcclxuICAgICAgICBpZiAoaXNQcmltaXRpdmUpIHtcclxuICAgICAgICAgIGNvbnN0IGVOYW1lOnN0cmluZyA9ICdfJyArIGRLZXk7XHJcbiAgICAgICAgICBsZXQgZm91bmRBbnlWYWw6Ym9vbGVhbiA9IGZhbHNlO1xyXG4gICAgICAgICAgbGV0IGZvdW5kQW55RXh0OmJvb2xlYW4gPSBmYWxzZTtcclxuICAgICAgICAgIGNbZEtleV0gPSBbXTtcclxuICAgICAgICAgIGNbZU5hbWVdID0gW107XHJcbiAgICAgICAgICAodGhpcyBhcyBhbnkpW2tleV0uZm9yRWFjaCgoYXY6YW55KSA9PiB7XHJcbiAgICAgICAgICAgIGxldCBhZGRFbGVtZW50OmJvb2xlYW4gPSBmYWxzZTtcclxuICAgICAgICAgICAgaWYgKGF2LnZhbHVlKSB7IFxyXG4gICAgICAgICAgICAgIGNbZEtleV0ucHVzaChhdi52YWx1ZSk7IFxyXG4gICAgICAgICAgICAgIGZvdW5kQW55VmFsID0gdHJ1ZTtcclxuICAgICAgICAgICAgICBhZGRFbGVtZW50ID0gdHJ1ZTtcclxuICAgICAgICAgICAgfSBlbHNlIHsgXHJcbiAgICAgICAgICAgICAgY1tkS2V5XS5wdXNoKG51bGwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgXHJcbiAgICAgICAgICAgIGxldCBhbzpvYmplY3QgPSB7fTtcclxuICAgICAgICAgICAgaWYgKGF2LmlkKSB7IFxyXG4gICAgICAgICAgICAgIChhbyBhcyBhbnkpWydpZCddID0gYXYuaWQ7XHJcbiAgICAgICAgICAgICAgZm91bmRBbnlFeHQgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICgoYXYuZXh0ZW5zaW9uKSAmJiAoYXYuZXh0ZW5zaW9uLmxlbmd0aCAhPT0gMCkpIHtcclxuICAgICAgICAgICAgICAoYW8gYXMgYW55KVsnZXh0ZW5zaW9uJ10gPSBbXTtcclxuICAgICAgICAgICAgICBhdi5leHRlbnNpb24uZm9yRWFjaCgoZTphbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIChhbyBhcyBhbnkpWydleHRlbnNpb24nXS5wdXNoKGUpO1xyXG4gICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgIGZvdW5kQW55RXh0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gIFxyXG4gICAgICAgICAgICBpZiAoZm91bmRBbnlFeHQpIHsgXHJcbiAgICAgICAgICAgICAgY1tlTmFtZV0ucHVzaChhbyk7XHJcbiAgICAgICAgICAgICAgYWRkRWxlbWVudCA9IHRydWU7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgY1tlTmFtZV0ucHVzaChudWxsKTtcclxuICAgICAgICAgICAgfVxyXG4gIFxyXG4gICAgICAgICAgICBpZiAoIWFkZEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICBjW2RLZXldLnBvcCgpO1xyXG4gICAgICAgICAgICAgIGNbZU5hbWVdLnBvcCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KTtcclxuICBcclxuICAgICAgICAgIGlmICghZm91bmRBbnlWYWwpIHsgZGVsZXRlIGNbZEtleV07IH1cclxuICAgICAgICAgIGlmICghZm91bmRBbnlFeHQpIHsgZGVsZXRlIGNbZU5hbWVdOyB9XHJcbiAgICAgICAgfSBlbHNlIGlmIChmdHNEdCkge1xyXG4gICAgICAgICAgY1tkS2V5XSA9IFtdO1xyXG4gICAgICAgICAgKHRoaXMgYXMgYW55KVtrZXldLmZvckVhY2goKHY6YW55KSA9PiB7XHJcbiAgICAgICAgICAgIC8vIGNbZEtleV0ucHVzaCh2LnRvSlNPTigpKTtcclxuICAgICAgICAgICAgY1tkS2V5XS5wdXNoKHYpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGNbZEtleV0gPSAodGhpcyBhcyBhbnkpW2tleV07XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2UgaWYgKGlzUHJpbWl0aXZlKSB7XHJcbiAgICAgICAgaWYgKCh0aGlzIGFzIGFueSlba2V5XS52YWx1ZSkgeyBjW2RLZXldID0gKHRoaXMgYXMgYW55KVtrZXldLnZhbHVlOyB9XHJcblxyXG4gICAgICAgIGNvbnN0IGVOYW1lOnN0cmluZyA9ICdfJyArIGRLZXk7XHJcbiAgICAgICAgY1tlTmFtZV0gPSB7fTtcclxuICAgICAgICBpZiAoKHRoaXMgYXMgYW55KVtrZXldWydpZCddKSB7IGNbZU5hbWVdWydpZCddID0gKHRoaXMgYXMgYW55KVtrZXldWydpZCddOyB9XHJcbiAgICAgICAgaWYgKCgodGhpcyBhcyBhbnkpW2tleV1bJ2V4dGVuc2lvbiddKSAmJiAoKHRoaXMgYXMgYW55KVtrZXldWydleHRlbnNpb24nXS5sZW5ndGggIT09IDApKSB7XHJcbiAgICAgICAgICBjW2VOYW1lXVsnZXh0ZW5zaW9uJ10gPSBbXTtcclxuICAgICAgICAgICh0aGlzIGFzIGFueSlba2V5XVsnZXh0ZW5zaW9uJ10uZm9yRWFjaCgoZTphbnkpID0+IHtcclxuICAgICAgICAgICAgY1tlTmFtZV1bJ2V4dGVuc2lvbiddLnB1c2goZSk7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChPYmplY3Qua2V5cyhjW2VOYW1lXSkubGVuZ3RoID09PSAwKSB7IGRlbGV0ZSBjW2VOYW1lXTsgfVxyXG4gICAgICB9IGVsc2UgaWYgKGZ0c0R0KSB7XHJcbiAgICAgICAgY1tkS2V5XSA9ICh0aGlzIGFzIGFueSlba2V5XTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjW2RLZXldID0gKHRoaXMgYXMgYW55KVtrZXldO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgXHJcbiAgICByZXR1cm4gYztcclxuICB9XHJcbn0iXX0=