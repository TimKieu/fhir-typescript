// Minimum TypeScript Version: 3.7
export class FhirBase {
    /** Default constructor */
    constructor(source = {}, options = {}) {
        if (options.allowUnknownElements === true) {
            Object.assign(this, source);
        }
    }
    /**
     * Function to perform basic model validation (e.g., check if required elements are present).
     */
    doModelValidation() {
        let issues = [];
        return issues;
    }
    /**
     * Function to strip invalid element values for serialization.
     */
    toJSON() {
        let c = {};
        for (const key in this) {
            if ((this[key] === undefined) ||
                (this[key] === null) ||
                (this[key] === '') ||
                (this[key] === NaN) ||
                (this[key] === [])) {
                continue;
            }
            let isArray = Array.isArray(this[key]);
            if (isArray && this[key].length === 0) {
                continue;
            }
            let ftsDt = (isArray ? this[key][0].constructor._fts_dataType : this[key].constructor._fts_dataType) ?? '';
            let isChoice = this.constructor['_fts_' + key + 'IsChoice'] ?? false;
            let isPrimitive = (isArray ? this[key][0].constructor['_fts_isPrimitive'] : this[key].constructor['_fts_isPrimitive']) ?? false;
            let dKey = key + (isChoice ? ftsDt : '');
            if (isArray) {
                if (isPrimitive) {
                    const eName = '_' + dKey;
                    let foundAnyVal = false;
                    let foundAnyExt = false;
                    c[dKey] = [];
                    c[eName] = [];
                    this[key].forEach((av) => {
                        let addElement = false;
                        if (av.value) {
                            c[dKey].push(av.value);
                            foundAnyVal = true;
                            addElement = true;
                        }
                        else {
                            c[dKey].push(null);
                        }
                        let ao = {};
                        if (av.id) {
                            ao['id'] = av.id;
                        }
                        if (av.extension) {
                            ao['extension'] = [];
                            av.extension.forEach((e) => {
                                ao['extension'].push(e);
                            });
                        }
                        if (Object.keys(ao).length !== 0) {
                            c[eName].push(ao);
                            foundAnyExt = true;
                            addElement = true;
                        }
                        else {
                            c[eName].push(null);
                        }
                        if (!addElement) {
                            c[dKey].pop();
                            c[eName].pop();
                        }
                    });
                    if (!foundAnyVal) {
                        delete c[dKey];
                    }
                    if (!foundAnyExt) {
                        delete c[eName];
                    }
                }
                else if (ftsDt) {
                    c[dKey] = [];
                    this[key].forEach((v) => {
                        // c[dKey].push(v.toJSON());
                        c[dKey].push(v);
                    });
                }
                else {
                    c[dKey] = this[key];
                }
            }
            else if (isPrimitive) {
                if (this[key].value) {
                    c[dKey] = this[key].value;
                }
                const eName = '_' + dKey;
                c[eName] = {};
                if (this[key]['id']) {
                    c[eName]['id'] = this[key]['id'];
                }
                if (this[key]['extension']) {
                    c[eName]['extension'] = [];
                    this[key]['extension'].forEach((e) => {
                        c[eName]['extension'].push(e);
                    });
                }
                if (Object.keys(c[eName]).length === 0) {
                    delete c[eName];
                }
            }
            else if (ftsDt) {
                c[dKey] = this[key];
            }
            else {
                c[dKey] = this[key];
            }
        }
        return c;
    }
}
/**
 * Mapping of this datatype to a FHIR equivalent
 */
FhirBase._fts_dataType = 'Base';
FhirBase._fts_regex = /.?/;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRmhpckJhc2UuanMiLCJzb3VyY2VSb290IjoiLi9zcmMvIiwic291cmNlcyI6WyJmaGlyL0ZoaXJCYXNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLGtDQUFrQztBQXFGbEMsTUFBTSxPQUFPLFFBQVE7SUFPbkIsMEJBQTBCO0lBQzFCLFlBQVksU0FBK0IsRUFBRSxFQUFFLFVBQWlDLEVBQUU7UUFDaEYsSUFBSSxPQUFPLENBQUMsb0JBQW9CLEtBQUssSUFBSSxFQUFFO1lBQUUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUM7U0FBRTtJQUM3RSxDQUFDO0lBRUQ7O09BRUc7SUFDSyxpQkFBaUI7UUFDdkIsSUFBSSxNQUFNLEdBQWMsRUFBRSxDQUFDO1FBQzNCLE9BQU8sTUFBTSxDQUFDO0lBQ2hCLENBQUM7SUFFRDs7T0FFRztJQUNLLE1BQU07UUFDWixJQUFJLENBQUMsR0FBTyxFQUFFLENBQUM7UUFFZixLQUFLLE1BQU0sR0FBRyxJQUFLLElBQVksRUFBRTtZQUMvQixJQUFJLENBQUUsSUFBWSxDQUFDLEdBQUcsQ0FBQyxLQUFLLFNBQVMsQ0FBQztnQkFDbEMsQ0FBRSxJQUFZLENBQUMsR0FBRyxDQUFDLEtBQUssSUFBSSxDQUFDO2dCQUM3QixDQUFFLElBQVksQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLENBQUM7Z0JBQzNCLENBQUUsSUFBWSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEdBQUcsQ0FBQztnQkFDNUIsQ0FBRSxJQUFZLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxDQUFDLEVBQUU7Z0JBQy9CLFNBQVM7YUFDVjtZQUVELElBQUksT0FBTyxHQUFXLEtBQUssQ0FBQyxPQUFPLENBQUUsSUFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFFeEQsSUFBSSxPQUFPLElBQUssSUFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7Z0JBQzlDLFNBQVM7YUFDVjtZQUVELElBQUks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QUFDLENBQUMsV0FBVyxDQUFDLEdBQUcsRUFBRSxDQUFDO29CQUMxQixJQUFZLENBQUMsR0FBRyxDQUFDLENBQUMsV0FBVyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBSyxFQUFFLEVBQUU7d0JBQ2hELENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBQ2hDLENBQUMsQ0FBQyxDQUFDO2lCQUNKO2dCQUVELElBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO29CQUFFLE9BQU8sQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDO2lCQUFFO2FBQzdEO2lCQUFNLElBQUksS0FBSyxFQUFFO2dCQUNoQixDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUksSUFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2FBQzlCO2lCQUFNO2dCQUNMLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBSSxJQUFZLENBQUMsR0FBRyxDQUFDLENBQUM7YUFDOUI7U0FDRjtRQUVELE9BQU8sQ0FBQyxDQUFDO0lBQ1gsQ0FBQzs7QUF0SEQ7O0dBRUc7QUFDb0Isc0JBQWEsR0FBUSxNQUFNLENBQUM7QUFDNUIsbUJBQVUsR0FBVSxJQUFJLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBNaW5pbXVtIFR5cGVTY3JpcHQgVmVyc2lvbjogMy43XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIEZoaXJDb25zdHJ1Y3Rvck9wdGlvbnMge1xyXG4gIC8qKiBJZiBpbnN0YW50aWF0ZWQgb2JqZWN0cyBzaG91bGQgYWxsb3cgbm9uLUZISVIgZGVmaW5lZCBwcm9wZXJ0aWVzICovXHJcbiAgYWxsb3dVbmtub3duRWxlbWVudHM/OiBib29sZWFufHVuZGVmaW5lZDtcclxufVxyXG5cclxuLyoqXHJcbiAqIEludGVybmFsIEVsZW1lbnQgLSBlcXVpdmFsZW50IHRvIGEgRkhJUiBKU09OIEVsZW1lbnQgKENvbXBsZXggRGF0YVR5cGUpLCB3aXRob3V0IGV4dGVuc2lvbnNcclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgRnRzRWxlbWVudCB7XHJcbiAgLyoqXHJcbiAgICogVW5pcXVlIGlkIGZvciB0aGUgZWxlbWVudCB3aXRoaW4gYSByZXNvdXJjZSAoZm9yIGludGVybmFsIHJlZmVyZW5jZXMpLiBUaGlzIG1heSBiZSBhbnkgc3RyaW5nIHZhbHVlIHRoYXQgZG9lcyBub3QgY29udGFpbiBzcGFjZXMuXHJcbiAgICovXHJcbiAgIGlkPzogc3RyaW5nfHVuZGVmaW5lZDtcclxufVxyXG5cclxuLyoqXHJcbiAqIEludGVybmFsIGNvZGluZyAtIGVxdWl2YWxlbnQgdG8gYSBGSElSIEpTT04gQ29kaW5nIChDb21wbGV4IERhdGFUeXBlKSwgd2l0aG91dCBleHRlbnNpb25zXHJcbiAqL1xyXG5leHBvcnQgaW50ZXJmYWNlIEZ0c0NvZGluZyBleHRlbmRzIEZ0c0VsZW1lbnQge1xyXG4gIC8qKlxyXG4gICAqIFRoZSBVUkkgbWF5IGJlIGFuIE9JRCAodXJuOm9pZDouLi4pIG9yIGEgVVVJRCAodXJuOnV1aWQ6Li4uKS4gIE9JRHMgYW5kIFVVSURzIFNIQUxMIGJlIHJlZmVyZW5jZXMgdG8gdGhlIEhMNyBPSUQgcmVnaXN0cnkuIE90aGVyd2lzZSwgdGhlIFVSSSBzaG91bGQgY29tZSBmcm9tIEhMNydzIGxpc3Qgb2YgRkhJUiBkZWZpbmVkIHNwZWNpYWwgVVJJcyBvciBpdCBzaG91bGQgcmVmZXJlbmNlIHRvIHNvbWUgZGVmaW5pdGlvbiB0aGF0IGVzdGFibGlzaGVzIHRoZSBzeXN0ZW0gY2xlYXJseSBhbmQgdW5hbWJpZ3VvdXNseS5cclxuICAgKi9cclxuICAgc3lzdGVtPzogc3RyaW5nfHVuZGVmaW5lZDtcclxuICAgLyoqXHJcbiAgICAqIFdoZXJlIHRoZSB0ZXJtaW5vbG9neSBkb2VzIG5vdCBjbGVhcmx5IGRlZmluZSB3aGF0IHN0cmluZyBzaG91bGQgYmUgdXNlZCB0byBpZGVudGlmeSBjb2RlIHN5c3RlbSB2ZXJzaW9ucywgdGhlIHJlY29tbWVuZGF0aW9uIGlzIHRvIHVzZSB0aGUgZGF0ZSAoZXhwcmVzc2VkIGluIEZISVIgZGF0ZSBmb3JtYXQpIG9uIHdoaWNoIHRoYXQgdmVyc2lvbiB3YXMgb2ZmaWNpYWxseSBwdWJsaXNoZWQgYXMgdGhlIHZlcnNpb24gZGF0ZS5cclxuICAgICovXHJcbiAgIHZlcnNpb24/OiBzdHJpbmd8dW5kZWZpbmVkO1xyXG4gICAvKipcclxuICAgICogQSBzeW1ib2wgaW4gc3ludGF4IGRlZmluZWQgYnkgdGhlIHN5c3RlbS4gVGhlIHN5bWJvbCBtYXkgYmUgYSBwcmVkZWZpbmVkIGNvZGUgb3IgYW4gZXhwcmVzc2lvbiBpbiBhIHN5bnRheCBkZWZpbmVkIGJ5IHRoZSBjb2Rpbmcgc3lzdGVtIChlLmcuIHBvc3QtY29vcmRpbmF0aW9uKS5cclxuICAgICovXHJcbiAgIGNvZGU/OiBzdHJpbmd8dW5kZWZpbmVkO1xyXG4gICAvKipcclxuICAgICogQSByZXByZXNlbnRhdGlvbiBvZiB0aGUgbWVhbmluZyBvZiB0aGUgY29kZSBpbiB0aGUgc3lzdGVtLCBmb2xsb3dpbmcgdGhlIHJ1bGVzIG9mIHRoZSBzeXN0ZW0uXHJcbiAgICAqL1xyXG4gICBkaXNwbGF5Pzogc3RyaW5nfHVuZGVmaW5lZDtcclxuICAgLyoqXHJcbiAgICAqIEFtb25nc3QgYSBzZXQgb2YgYWx0ZXJuYXRpdmVzLCBhIGRpcmVjdGx5IGNob3NlbiBjb2RlIGlzIHRoZSBtb3N0IGFwcHJvcHJpYXRlIHN0YXJ0aW5nIHBvaW50IGZvciBuZXcgdHJhbnNsYXRpb25zLiBUaGVyZSBpcyBzb21lIGFtYmlndWl0eSBhYm91dCB3aGF0IGV4YWN0bHkgJ2RpcmVjdGx5IGNob3NlbicgaW1wbGllcywgYW5kIHRyYWRpbmcgcGFydG5lciBhZ3JlZW1lbnQgbWF5IGJlIG5lZWRlZCB0byBjbGFyaWZ5IHRoZSB1c2Ugb2YgdGhpcyBlbGVtZW50IGFuZCBpdHMgY29uc2VxdWVuY2VzIG1vcmUgY29tcGxldGVseS5cclxuICAgICovXHJcbiAgIHVzZXJTZWxlY3RlZD86IGJvb2xlYW58dW5kZWZpbmVkO1xyXG59XHJcblxyXG4vKipcclxuICogSW50ZXJuYWwgQ29kZWFibGVDb25jZXB0IC0gZXF1aXZhbGVudCB0byBhIEZISVIgSlNPTiBDb2RlYWJsZUNvbmNlcHQgKENvbXBsZXggRGF0YVR5cGUpLCB3aXRob3V0IGV4dGVuc2lvbnNcclxuICovXHJcbiBleHBvcnQgaW50ZXJmYWNlIEZ0c0NvZGVhYmxlQ29uY2VwdCBleHRlbmRzIEZ0c0VsZW1lbnQgeyBcclxuICAvKipcclxuICAgKiBDb2RlcyBtYXkgYmUgZGVmaW5lZCB2ZXJ5IGNhc3VhbGx5IGluIGVudW1lcmF0aW9ucywgb3IgY29kZSBsaXN0cywgdXAgdG8gdmVyeSBmb3JtYWwgZGVmaW5pdGlvbnMgc3VjaCBhcyBTTk9NRUQgQ1QgLSBzZWUgdGhlIEhMNyB2MyBDb3JlIFByaW5jaXBsZXMgZm9yIG1vcmUgaW5mb3JtYXRpb24uICBPcmRlcmluZyBvZiBjb2RpbmdzIGlzIHVuZGVmaW5lZCBhbmQgU0hBTEwgTk9UIGJlIHVzZWQgdG8gaW5mZXIgbWVhbmluZy4gR2VuZXJhbGx5LCBhdCBtb3N0IG9ubHkgb25lIG9mIHRoZSBjb2RpbmcgdmFsdWVzIHdpbGwgYmUgbGFiZWxlZCBhcyBVc2VyU2VsZWN0ZWQgPSB0cnVlLlxyXG4gICAqL1xyXG4gIGNvZGluZz86IEZ0c0NvZGluZ1tdfHVuZGVmaW5lZDtcclxuICAvKipcclxuICAgKiBWZXJ5IG9mdGVuIHRoZSB0ZXh0IGlzIHRoZSBzYW1lIGFzIGEgZGlzcGxheU5hbWUgb2Ygb25lIG9mIHRoZSBjb2RpbmdzLlxyXG4gICAqL1xyXG4gIHRleHQ/OiBzdHJpbmd8dW5kZWZpbmVkO1xyXG59XHJcblxyXG4vKipcclxuICogSW50ZXJuYWwgT3BlcmF0aW9uT3V0Y29tZUlzc3VlIC0gZXF1aXZhbGVudCB0byBPcGVyYXRpb25PdXRjb21lLmlzc3VlIChCYWNrYm9uZSBFbGVtZW50KSwgd2l0aG91dCBleHRlbnNpb25zXHJcbiAqL1xyXG5leHBvcnQgaW50ZXJmYWNlIEZ0c0lzc3VlIGV4dGVuZHMgRnRzRWxlbWVudCB7XHJcbiAgLyoqXHJcbiAgICogVGhpcyBpcyBsYWJlbGVkIGFzIFwiSXMgTW9kaWZpZXJcIiBiZWNhdXNlIGFwcGxpY2F0aW9ucyBzaG91bGQgbm90IGNvbmZ1c2UgaGludHMgYW5kIHdhcm5pbmdzIHdpdGggZXJyb3JzLlxyXG4gICAqL1xyXG4gICBzZXZlcml0eTogJ2Vycm9yJ3wnZmF0YWwnfCdpbmZvcm1hdGlvbid8J3dhcm5pbmcnfG51bGw7XHJcbiAgIC8qKlxyXG4gICAgKiBEZXNjcmliZXMgdGhlIHR5cGUgb2YgdGhlIGlzc3VlLiBUaGUgc3lzdGVtIHRoYXQgY3JlYXRlcyBhbiBPcGVyYXRpb25PdXRjb21lIFNIQUxMIGNob29zZSB0aGUgbW9zdCBhcHBsaWNhYmxlIGNvZGUgZnJvbSB0aGUgSXNzdWVUeXBlIHZhbHVlIHNldCwgYW5kIG1heSBhZGRpdGlvbmFsIHByb3ZpZGUgaXRzIG93biBjb2RlIGZvciB0aGUgZXJyb3IgaW4gdGhlIGRldGFpbHMgZWxlbWVudC5cclxuICAgICovXHJcbiAgIGNvZGU6ICdidXNpbmVzcy1ydWxlJ3wnY29kZS1pbnZhbGlkJ3wnY29uZmxpY3QnfCdkZWxldGVkJ3wnZHVwbGljYXRlJ3wnZXhjZXB0aW9uJ3wnZXhwaXJlZCd8J2V4dGVuc2lvbid8J2ZvcmJpZGRlbid8J2luY29tcGxldGUnfCdpbmZvcm1hdGlvbmFsJ3wnaW52YWxpZCd8J2ludmFyaWFudCd8J2xvY2stZXJyb3InfCdsb2dpbid8J211bHRpcGxlLW1hdGNoZXMnfCduby1zdG9yZSd8J25vdC1mb3VuZCd8J25vdC1zdXBwb3J0ZWQnfCdwcm9jZXNzaW5nJ3wncmVxdWlyZWQnfCdzZWN1cml0eSd8J3N0cnVjdHVyZSd8J3N1cHByZXNzZWQnfCd0aHJvdHRsZWQnfCd0aW1lb3V0J3wndG9vLWNvc3RseSd8J3Rvby1sb25nJ3wndHJhbnNpZW50J3wndW5rbm93bid8J3ZhbHVlJ3xudWxsO1xyXG4gICAvKipcclxuICAgICogQSBodW1hbiByZWFkYWJsZSBkZXNjcmlwdGlvbiBvZiB0aGUgZXJyb3IgaXNzdWUgU0hPVUxEIGJlIHBsYWNlZCBpbiBkZXRhaWxzLnRleHQuXHJcbiAgICAqL1xyXG4gICBkZXRhaWxzPzogRnRzQ29kZWFibGVDb25jZXB0fHVuZGVmaW5lZDtcclxuICAgLyoqXHJcbiAgICAqIFRoaXMgbWF5IGJlIGEgZGVzY3JpcHRpb24gb2YgaG93IGEgdmFsdWUgaXMgZXJyb25lb3VzLCBhIHN0YWNrIGR1bXAgdG8gaGVscCB0cmFjZSB0aGUgaXNzdWUgb3Igb3RoZXIgdHJvdWJsZXNob290aW5nIGluZm9ybWF0aW9uLlxyXG4gICAgKi9cclxuICAgZGlhZ25vc3RpY3M/OiBzdHJpbmd8dW5kZWZpbmVkO1xyXG4gICAvKipcclxuICAgICogVGhlIHJvb3Qgb2YgdGhlIEZISVJQYXRoIGlzIHRoZSByZXNvdXJjZSBvciBidW5kbGUgdGhhdCBnZW5lcmF0ZWQgT3BlcmF0aW9uT3V0Y29tZS4gIEVhY2ggRkhJUlBhdGggU0hBTEwgcmVzb2x2ZSB0byBhIHNpbmdsZSBub2RlLlxyXG4gICAgKi9cclxuICAgZXhwcmVzc2lvbj86IHN0cmluZ1tdfHVuZGVmaW5lZDtcclxuIH1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgRmhpckJhc2VBcmdzIHsgfVxyXG5cclxuZXhwb3J0IGNsYXNzIEZoaXJCYXNlIHtcclxuICAvKipcclxuICAgKiBNYXBwaW5nIG9mIHRoaXMgZGF0YXR5cGUgdG8gYSBGSElSIGVxdWl2YWxlbnRcclxuICAgKi9cclxuICBwdWJsaWMgc3RhdGljIHJlYWRvbmx5IF9mdHNfZGF0YVR5cGU6c3RyaW5nPSdCYXNlJztcclxuICBwdWJsaWMgc3RhdGljIHJlYWRvbmx5IF9mdHNfcmVnZXg6UmVnRXhwID0gLy4/LztcclxuXHJcbiAgLyoqIERlZmF1bHQgY29uc3RydWN0b3IgKi9cclxuICBjb25zdHJ1Y3Rvcihzb3VyY2U6UGFydGlhbDxGaGlyQmFzZUFyZ3M+ID0ge30sIG9wdGlvbnM6RmhpckNvbnN0cnVjdG9yT3B0aW9ucyA9IHt9KSB7XHJcbiAgICBpZiAob3B0aW9ucy5hbGxvd1Vua25vd25FbGVtZW50cyA9PT0gdHJ1ZSkgeyBPYmplY3QuYXNzaWduKHRoaXMsIHNvdXJjZSk7IH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZ1bmN0aW9uIHRvIHBlcmZvcm0gYmFzaWMgbW9kZWwgdmFsaWRhdGlvbiAoZS5nLiwgY2hlY2sgaWYgcmVxdWlyZWQgZWxlbWVudHMgYXJlIHByZXNlbnQpLlxyXG4gICAqL1xyXG4gICBwdWJsaWMgZG9Nb2RlbFZhbGlkYXRpb24oKTpGdHNJc3N1ZVtdIHtcclxuICAgIGxldCBpc3N1ZXM6RnRzSXNzdWVbXSA9IFtdO1xyXG4gICAgcmV0dXJuIGlzc3VlcztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZ1bmN0aW9uIHRvIHN0cmlwIGludmFsaWQgZWxlbWVudCB2YWx1ZXMgZm9yIHNlcmlhbGl6YXRpb24uXHJcbiAgICovXHJcbiAgIHB1YmxpYyB0b0pTT04oKSB7XHJcbiAgICBsZXQgYzphbnkgPSB7fTtcclxuICBcclxuICAgIGZvciAoY29uc3Qga2V5IGluICh0aGlzIGFzIGFueSkpIHtcclxuICAgICAgaWYgKCgodGhpcyBhcyBhbnkpW2tleV0gPT09IHVuZGVmaW5lZCkgfHwgXHJcbiAgICAgICAgICAoKHRoaXMgYXMgYW55KVtrZXldID09PSBudWxsKSB8fFxyXG4gICAgICAgICAgKCh0aGlzIGFzIGFueSlba2V5XSA9PT0gJycpIHx8XHJcbiAgICAgICAgICAoKHRoaXMgYXMgYW55KVtrZXldID09PSBOYU4pIHx8XHJcbiAgICAgICAgICAoKHRoaXMgYXMgYW55KVtrZXldID09PSBbXSkpIHtcclxuICAgICAgICBjb250aW51ZTtcclxuICAgICAgfVxyXG5cclxuICAgICAgbGV0IGlzQXJyYXk6Ym9vbGVhbiA9IEFycmF5LmlzQXJyYXkoKHRoaXMgYXMgYW55KVtrZXldKTtcclxuXHJcbiAgICAgIGlmIChpc0FycmF5ICYmICh0aGlzIGFzIGFueSlba2V5XS5sZW5ndGggPT09IDApIHtcclxuICAgICAgICBjb250aW51ZTtcclxuICAgICAgfVxyXG5cclxuICAgICAgbGV0IGZ0c0R0OnN0cmluZyA9IChpc0FycmF5ID8gKHRoaXMgYXMgYW55KVtrZXldWzBdLmNvbnN0cnVjdG9yLl9mdHNfZGF0YVR5cGUgOiAodGhpcyBhcyBhbnkpW2tleV0uY29uc3RydWN0b3IuX2Z0c19kYXRhVHlwZSkgPz8gJyc7XHJcbiAgICAgIGxldCBpc0Nob2ljZTpib29sZWFuID0gKHRoaXMgYXMgYW55KS5jb25zdHJ1Y3RvclsnX2Z0c18nICsga2V5ICsgJ0lzQ2hvaWNlJ10gPz8gZmFsc2U7XHJcbiAgICAgIGxldCBpc1ByaW1pdGl2ZSA9IChpc0FycmF5ID8gKHRoaXMgYXMgYW55KVtrZXldWzBdLmNvbnN0cnVjdG9yWydfZnRzX2lzUHJpbWl0aXZlJ10gOiAodGhpcyBhcyBhbnkpW2tleV0uY29uc3RydWN0b3JbJ19mdHNfaXNQcmltaXRpdmUnXSkgPz8gZmFsc2U7XHJcbiAgICAgIGxldCBkS2V5OnN0cmluZyA9IGtleSArIChpc0Nob2ljZSA/IGZ0c0R0IDogJycpO1xyXG4gIFxyXG4gICAgICBpZiAoaXNBcnJheSkge1xyXG4gICAgICAgIGlmIChpc1ByaW1pdGl2ZSkge1xyXG4gICAgICAgICAgY29uc3QgZU5hbWU6c3RyaW5nID0gJ18nICsgZEtleTtcclxuICAgICAgICAgIGxldCBmb3VuZEFueVZhbDpib29sZWFuID0gZmFsc2U7XHJcbiAgICAgICAgICBsZXQgZm91bmRBbnlFeHQ6Ym9vbGVhbiA9IGZhbHNlO1xyXG4gICAgICAgICAgY1tkS2V5XSA9IFtdO1xyXG4gICAgICAgICAgY1tlTmFtZV0gPSBbXTtcclxuICAgICAgICAgICh0aGlzIGFzIGFueSlba2V5XS5mb3JFYWNoKChhdjphbnkpID0+IHtcclxuICAgICAgICAgICAgbGV0IGFkZEVsZW1lbnQ6Ym9vbGVhbiA9IGZhbHNlO1xyXG4gICAgICAgICAgICBpZiAoYXYudmFsdWUpIHsgXHJcbiAgICAgICAgICAgICAgY1tkS2V5XS5wdXNoKGF2LnZhbHVlKTsgXHJcbiAgICAgICAgICAgICAgZm91bmRBbnlWYWwgPSB0cnVlO1xyXG4gICAgICAgICAgICAgIGFkZEVsZW1lbnQgPSB0cnVlO1xyXG4gICAgICAgICAgICB9IGVsc2UgeyBcclxuICAgICAgICAgICAgICBjW2RLZXldLnB1c2gobnVsbCk7XHJcbiAgICAgICAgICAgIH1cclxuICBcclxuICAgICAgICAgICAgbGV0IGFvOm9iamVjdCA9IHt9O1xyXG4gICAgICAgICAgICBpZiAoYXYuaWQpIHsgKGFvIGFzIGFueSlbJ2lkJ10gPSBhdi5pZDsgfVxyXG4gICAgICAgICAgICBpZiAoYXYuZXh0ZW5zaW9uKSB7XHJcbiAgICAgICAgICAgICAgKGFvIGFzIGFueSlbJ2V4dGVuc2lvbiddID0gW107XHJcbiAgICAgICAgICAgICAgYXYuZXh0ZW5zaW9uLmZvckVhY2goKGU6YW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAoYW8gYXMgYW55KVsnZXh0ZW5zaW9uJ10ucHVzaChlKTtcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gIFxyXG4gICAgICAgICAgICBpZiAoT2JqZWN0LmtleXMoYW8pLmxlbmd0aCAhPT0gMCkgeyBcclxuICAgICAgICAgICAgICBjW2VOYW1lXS5wdXNoKGFvKTtcclxuICAgICAgICAgICAgICBmb3VuZEFueUV4dCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgYWRkRWxlbWVudCA9IHRydWU7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgY1tlTmFtZV0ucHVzaChudWxsKTtcclxuICAgICAgICAgICAgfVxyXG4gIFxyXG4gICAgICAgICAgICBpZiAoIWFkZEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICBjW2RLZXldLnBvcCgpO1xyXG4gICAgICAgICAgICAgIGNbZU5hbWVdLnBvcCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KTtcclxuICBcclxuICAgICAgICAgIGlmICghZm91bmRBbnlWYWwpIHsgZGVsZXRlIGNbZEtleV07IH1cclxuICAgICAgICAgIGlmICghZm91bmRBbnlFeHQpIHsgZGVsZXRlIGNbZU5hbWVdOyB9XHJcbiAgICAgICAgfSBlbHNlIGlmIChmdHNEdCkge1xyXG4gICAgICAgICAgY1tkS2V5XSA9IFtdO1xyXG4gICAgICAgICAgKHRoaXMgYXMgYW55KVtrZXldLmZvckVhY2goKHY6YW55KSA9PiB7XHJcbiAgICAgICAgICAgIC8vIGNbZEtleV0ucHVzaCh2LnRvSlNPTigpKTtcclxuICAgICAgICAgICAgY1tkS2V5XS5wdXNoKHYpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGNbZEtleV0gPSAodGhpcyBhcyBhbnkpW2tleV07XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2UgaWYgKGlzUHJpbWl0aXZlKSB7XHJcbiAgICAgICAgaWYgKCh0aGlzIGFzIGFueSlba2V5XS52YWx1ZSkgeyBjW2RLZXldID0gKHRoaXMgYXMgYW55KVtrZXldLnZhbHVlOyB9XHJcblxyXG4gICAgICAgIGNvbnN0IGVOYW1lOnN0cmluZyA9ICdfJyArIGRLZXk7XHJcbiAgICAgICAgY1tlTmFtZV0gPSB7fTtcclxuICAgICAgICBpZiAoKHRoaXMgYXMgYW55KVtrZXldWydpZCddKSB7IGNbZU5hbWVdWydpZCddID0gKHRoaXMgYXMgYW55KVtrZXldWydpZCddOyB9XHJcbiAgICAgICAgaWYgKCh0aGlzIGFzIGFueSlba2V5XVsnZXh0ZW5zaW9uJ10pIHtcclxuICAgICAgICAgIGNbZU5hbWVdWydleHRlbnNpb24nXSA9IFtdO1xyXG4gICAgICAgICAgKHRoaXMgYXMgYW55KVtrZXldWydleHRlbnNpb24nXS5mb3JFYWNoKChlOmFueSkgPT4ge1xyXG4gICAgICAgICAgICBjW2VOYW1lXVsnZXh0ZW5zaW9uJ10ucHVzaChlKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKE9iamVjdC5rZXlzKGNbZU5hbWVdKS5sZW5ndGggPT09IDApIHsgZGVsZXRlIGNbZU5hbWVdOyB9XHJcbiAgICAgIH0gZWxzZSBpZiAoZnRzRHQpIHtcclxuICAgICAgICBjW2RLZXldID0gKHRoaXMgYXMgYW55KVtrZXldO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNbZEtleV0gPSAodGhpcyBhcyBhbnkpW2tleV07XHJcbiAgICAgIH1cclxuICAgIH1cclxuICBcclxuICAgIHJldHVybiBjO1xyXG4gIH1cclxufSJdfQ==