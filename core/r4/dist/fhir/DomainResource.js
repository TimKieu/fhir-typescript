// <auto-generated/>
// Contents of: hl7.fhir.r4.core version: 4.0.1
// Minimum TypeScript Version: 3.7
// FHIR Resource: DomainResource
import * as fhir from '../fhir.js';
/**
 * A resource that includes narrative, extensions, and contained resources.
 */
export class DomainResource extends fhir.Resource {
    /**
     * Default constructor for DomainResource - initializes any required elements to null if a value is not provided.
     */
    constructor(source = {}, options = {}) {
        super(source, options);
        if (source['text']) {
            this.text = new fhir.Narrative(source.text);
        }
        if (source['contained']) {
            this.contained = [];
            source.contained.forEach((x) => {
                var r = fhir.resourceFactory(x);
                if (r) {
                    this.contained.push(r);
                }
            });
        }
        else {
            this.contained = [];
        }
        if (source['extension']) {
            this.extension = source.extension.map((x) => new fhir.Extension(x));
        }
        else {
            this.extension = [];
        }
        if (source['modifierExtension']) {
            this.modifierExtension = source.modifierExtension.map((x) => new fhir.Extension(x));
        }
        else {
            this.modifierExtension = [];
        }
    }
    /**
     * Function to perform basic model validation (e.g., check if required elements are present).
     */
    doModelValidation(expression = '') {
        let issues = super.doModelValidation(expression);
        if (expression === '') {
            expression = 'DomainResource';
        }
        if (this["text"]) {
            issues.push(...this.text.doModelValidation(expression + '.text'));
        }
        if (this["contained"]) {
            this.contained.forEach((x, i) => { issues.push(...x.doModelValidation(expression + `.contained[${i}]`)); });
        }
        if (this["extension"]) {
            this.extension.forEach((x, i) => { issues.push(...x.doModelValidation(expression + `.extension[${i}]`)); });
        }
        if (this["modifierExtension"]) {
            this.modifierExtension.forEach((x, i) => { issues.push(...x.doModelValidation(expression + `.modifierExtension[${i}]`)); });
        }
        return issues;
    }
    /**
     * Fluent-style function to add extensions
     * @param ext
     * @returns
     */
    addExtension(ext) {
        this.extension.push(new fhir.Extension(ext));
        return this;
    }
    /**
     * Remove ALL instances of extensions with a matching URL, optionally recurse into extension.extension.
     * @param url URL of extensions to remove
     * @param searchNested If the removal should search for nested extensions
     */
    removeExtensions(url, searchNested = false) {
        if (this.extension.length === 0) {
            return this;
        }
        const matchUrl = (typeof url === 'string') ? url : url.value ?? '';
        let clean = this.extension.filter((ext) => (ext?.url?.value ?? '') !== matchUrl) ?? [];
        if (searchNested) {
            for (let i = 0; i < clean.length; i++) {
                clean[i] = clean[i].removeExtensions(matchUrl, searchNested);
            }
        }
        this.extension = clean;
        return this;
    }
    /**
     * Find the first instance of an extension with a matching URL, optionally recurse into extension.extension.
     * @param url URL to search for
     * @param searchNested If the search should nest into extensions
     * @returns The FHIR Extension if found, or undefined.
     */
    findExtension(url, searchNested = false) {
        if (this.extension.length === 0) {
            return undefined;
        }
        const matchUrl = (typeof url === 'string') ? url : url.value ?? '';
        if (searchNested) {
            const flat = DomainResource.recurseForExtension(matchUrl, this.extension);
            if (flat.length === 0) {
                return undefined;
            }
            return flat[0];
        }
        return this.extension.find((ext) => (ext?.url?.value === matchUrl));
    }
    /**
     * Find all instances of an extension with a matching URL, optionally recurse into extension.extension.
     * @param url URL to search for
     * @param searchNested If the search should nest into extensions
     * @returns A new array of FHIR Extensions, with just the desired extensions
     */
    filterExtensions(url, searchNested = false) {
        if (this.extension.length === 0) {
            return [];
        }
        const matchUrl = (typeof url === 'string') ? url : url.value ?? '';
        if (searchNested) {
            return DomainResource.recurseForExtension(matchUrl, this.extension);
        }
        return this.extension.filter((ext) => (ext?.url?.value === matchUrl));
    }
    /**
     * Internal recursive search function
     * @param url
     * @param exts
     * @returns A new array (flat) of matching extensions
     */
    static recurseForExtension(url, exts) {
        if ((!exts) || (exts.length === 0)) {
            return [];
        }
        let val = [];
        exts.forEach((ext) => {
            if (ext && ext.url && (ext.url.value === url)) {
                val.push(ext);
                return;
            }
            if (ext && ext.extension && (ext.extension.length > 0)) {
                val.push(...this.recurseForExtension(url, ext.extension));
                return;
            }
            return;
        }, []);
        return val;
    }
}
/**
 * Mapping of this datatype to a FHIR equivalent
 */
DomainResource._fts_dataType = 'DomainResource';
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRG9tYWluUmVzb3VyY2UuanMiLCJzb3VyY2VSb290IjoiLi9zcmMvIiwic291cmNlcyI6WyJmaGlyL0RvbWFpblJlc291cmNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLG9CQUFvQjtBQUNwQiwrQ0FBK0M7QUFDL0Msa0NBQWtDO0FBQ2xDLGdDQUFnQztBQUVoQyxPQUFPLEtBQUssSUFBSSxNQUFNLFlBQVksQ0FBQztBQXdCbkM7O0dBRUc7QUFDSCxNQUFNLE9BQU8sY0FBZSxTQUFRLElBQUksQ0FBQyxRQUFRO0lBcUIvQzs7T0FFRztJQUNILFlBQVksU0FBcUMsRUFBRSxFQUFFLFVBQXNDLEVBQUU7UUFDM0YsS0FBSyxDQUFDLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQztRQUN2QixJQUFJLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRTtZQUFFLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUFFO1FBQ3BFLElBQUksTUFBTSxDQUFDLFdBQVcsQ0FBQyxFQUFFO1lBQ3ZCLElBQUksQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDO1lBQ3BCLE1BQU0sQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUU7Z0JBQzdCLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ2hDLElBQUksQ0FBQyxFQUFFO29CQUFFLElBQUksQ0FBQyxTQUFVLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO2lCQUFFO1lBQ3JDLENBQUMsQ0FBQyxDQUFDO1NBQ0o7YUFDSTtZQUFFLElBQUksQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDO1NBQUU7UUFDN0IsSUFBSSxNQUFNLENBQUMsV0FBVyxDQUFDLEVBQUU7WUFBRSxJQUFJLENBQUMsU0FBUyxHQUFHLE1BQU0sQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUMs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SSxHQUFHLElBQUksR0FBRyxDQUFDLFNBQVMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxFQUFFO2dCQUN0RCxHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDLG1CQUFtQixDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztnQkFDMUQsT0FBTzthQUNSO1lBQ0QsT0FBTztRQUNULENBQUMsRUFDRCxFQUFFLENBQUMsQ0FBQztRQUNOLE9BQU8sR0FBRyxDQUFDO0lBQ2IsQ0FBQzs7QUFoSkQ7O0dBRUc7QUFDNkIsNEJBQWEsR0FBVSxnQkFBZ0IsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIDxhdXRvLWdlbmVyYXRlZC8+XHJcbi8vIENvbnRlbnRzIG9mOiBobDcuZmhpci5yNC5jb3JlIHZlcnNpb246IDQuMC4xXHJcbi8vIE1pbmltdW0gVHlwZVNjcmlwdCBWZXJzaW9uOiAzLjdcclxuLy8gRkhJUiBSZXNvdXJjZTogRG9tYWluUmVzb3VyY2VcclxuXHJcbmltcG9ydCAqIGFzIGZoaXIgZnJvbSAnLi4vZmhpci5qcyc7XHJcblxyXG4vKipcclxuICogVmFsaWQgYXJndW1lbnRzIGZvciB0aGUgRG9tYWluUmVzb3VyY2UgdHlwZS5cclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgRG9tYWluUmVzb3VyY2VBcmdzIGV4dGVuZHMgZmhpci5SZXNvdXJjZUFyZ3Mge1xyXG4gIC8qKlxyXG4gICAqIENvbnRhaW5lZCByZXNvdXJjZXMgZG8gbm90IGhhdmUgbmFycmF0aXZlLiBSZXNvdXJjZXMgdGhhdCBhcmUgbm90IGNvbnRhaW5lZCBTSE9VTEQgaGF2ZSBhIG5hcnJhdGl2ZS4gSW4gc29tZSBjYXNlcywgYSByZXNvdXJjZSBtYXkgb25seSBoYXZlIHRleHQgd2l0aCBsaXR0bGUgb3Igbm8gYWRkaXRpb25hbCBkaXNjcmV0ZSBkYXRhIChhcyBsb25nIGFzIGFsbCBtaW5PY2N1cnM9MSBlbGVtZW50cyBhcmUgc2F0aXNmaWVkKS4gIFRoaXMgbWF5IGJlIG5lY2Vzc2FyeSBmb3IgZGF0YSBmcm9tIGxlZ2FjeSBzeXN0ZW1zIHdoZXJlIGluZm9ybWF0aW9uIGlzIGNhcHR1cmVkIGFzIGEgXCJ0ZXh0IGJsb2JcIiBvciB3aGVyZSB0ZXh0IGlzIGFkZGl0aW9uYWxseSBlbnRlcmVkIHJhdyBvciBuYXJyYXRlZCBhbmQgZW5jb2RlZCBpbmZvcm1hdGlvbiBpcyBhZGRlZCBsYXRlci5cclxuICAgKi9cclxuICB0ZXh0PzogZmhpci5OYXJyYXRpdmVBcmdzfHVuZGVmaW5lZDtcclxuICAvKipcclxuICAgKiBUaGlzIHNob3VsZCBuZXZlciBiZSBkb25lIHdoZW4gdGhlIGNvbnRlbnQgY2FuIGJlIGlkZW50aWZpZWQgcHJvcGVybHksIGFzIG9uY2UgaWRlbnRpZmljYXRpb24gaXMgbG9zdCwgaXQgaXMgZXh0cmVtZWx5IGRpZmZpY3VsdCAoYW5kIGNvbnRleHQgZGVwZW5kZW50KSB0byByZXN0b3JlIGl0IGFnYWluLiBDb250YWluZWQgcmVzb3VyY2VzIG1heSBoYXZlIHByb2ZpbGVzIGFuZCB0YWdzIEluIHRoZWlyIG1ldGEgZWxlbWVudHMsIGJ1dCBTSEFMTCBOT1QgaGF2ZSBzZWN1cml0eSBsYWJlbHMuXHJcbiAgICovXHJcbiAgY29udGFpbmVkPzogZmhpci5SZXNvdXJjZUFyZ3NbXXxhbnlbXXx1bmRlZmluZWQ7XHJcbiAgLyoqXHJcbiAgICogVGhlcmUgY2FuIGJlIG5vIHN0aWdtYSBhc3NvY2lhdGVkIHdpdGggdGhlIHVzZSBvZiBleHRlbnNpb25zIGJ5IGFueSBhcHBsaWNhdGlvbiwgcHJvamVjdCwgb3Igc3RhbmRhcmQgLSByZWdhcmRsZXNzIG9mIHRoZSBpbnN0aXR1dGlvbiBvciBqdXJpc2RpY3Rpb24gdGhhdCB1c2VzIG9yIGRlZmluZXMgdGhlIGV4dGVuc2lvbnMuICBUaGUgdXNlIG9mIGV4dGVuc2lvbnMgaXMgd2hhdCBhbGxvd3MgdGhlIEZISVIgc3BlY2lmaWNhdGlvbiB0byByZXRhaW4gYSBjb3JlIGxldmVsIG9mIHNpbXBsaWNpdHkgZm9yIGV2ZXJ5b25lLlxyXG4gICAqL1xyXG4gIGV4dGVuc2lvbj86IGZoaXIuRXh0ZW5zaW9uQXJnc1tdfHVuZGVmaW5lZDtcclxuICAvKipcclxuICAgKiBUaGVyZSBjYW4gYmUgbm8gc3RpZ21hIGFzc29jaWF0ZWQgd2l0aCB0aGUgdXNlIG9mIGV4dGVuc2lvbnMgYnkgYW55IGFwcGxpY2F0aW9uLCBwcm9qZWN0LCBvciBzdGFuZGFyZCAtIHJlZ2FyZGxlc3Mgb2YgdGhlIGluc3RpdHV0aW9uIG9yIGp1cmlzZGljdGlvbiB0aGF0IHVzZXMgb3IgZGVmaW5lcyB0aGUgZXh0ZW5zaW9ucy4gIFRoZSB1c2Ugb2YgZXh0ZW5zaW9ucyBpcyB3aGF0IGFsbG93cyB0aGUgRkhJUiBzcGVjaWZpY2F0aW9uIHRvIHJldGFpbiBhIGNvcmUgbGV2ZWwgb2Ygc2ltcGxpY2l0eSBmb3IgZXZlcnlvbmUuXHJcbiAgICovXHJcbiAgbW9kaWZpZXJFeHRlbnNpb24/OiBmaGlyLkV4dGVuc2lvbkFyZ3NbXXx1bmRlZmluZWQ7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBBIHJlc291cmNlIHRoYXQgaW5jbHVkZXMgbmFycmF0aXZlLCBleHRlbnNpb25zLCBhbmQgY29udGFpbmVkIHJlc291cmNlcy5cclxuICovXHJcbmV4cG9ydCBjbGFzcyBEb21haW5SZXNvdXJjZSBleHRlbmRzIGZoaXIuUmVzb3VyY2Uge1xyXG4gIC8qKlxyXG4gICAqIE1hcHBpbmcgb2YgdGhpcyBkYXRhdHlwZSB0byBhIEZISVIgZXF1aXZhbGVudFxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgb3ZlcnJpZGUgcmVhZG9ubHkgX2Z0c19kYXRhVHlwZTpzdHJpbmcgPSAnRG9tYWluUmVzb3VyY2UnO1xyXG4gIC8qKlxyXG4gICAqIENvbnRhaW5lZCByZXNvdXJjZXMgZG8gbm90IGhhdmUgbmFycmF0aXZlLiBSZXNvdXJjZXMgdGhhdCBhcmUgbm90IGNvbnRhaW5lZCBTSE9VTEQgaGF2ZSBhIG5hcnJhdGl2ZS4gSW4gc29tZSBjYXNlcywgYSByZXNvdXJjZSBtYXkgb25seSBoYXZlIHRleHQgd2l0aCBsaXR0bGUgb3Igbm8gYWRkaXRpb25hbCBkaXNjcmV0ZSBkYXRhIChhcyBsb25nIGFzIGFsbCBtaW5PY2N1cnM9MSBlbGVtZW50cyBhcmUgc2F0aXNmaWVkKS4gIFRoaXMgbWF5IGJlIG5lY2Vzc2FyeSBmb3IgZGF0YSBmcm9tIGxlZ2FjeSBzeXN0ZW1zIHdoZXJlIGluZm9ybWF0aW9uIGlzIGNhcHR1cmVkIGFzIGEgXCJ0ZXh0IGJsb2JcIiBvciB3aGVyZSB0ZXh0IGlzIGFkZGl0aW9uYWxseSBlbnRlcmVkIHJhdyBvciBuYXJyYXRlZCBhbmQgZW5jb2RlZCBpbmZvcm1hdGlvbiBpcyBhZGRlZCBsYXRlci5cclxuICAgKi9cclxuICBwdWJsaWMgdGV4dD86IGZoaXIuTmFycmF0aXZlfHVuZGVmaW5lZDtcclxuICAvKipcclxuICAgKiBUaGlzIHNob3VsZCBuZXZlciBiZSBkb25lIHdoZW4gdGhlIGNvbnRlbnQgY2FuIGJlIGlkZW50aWZpZWQgcHJvcGVybHksIGFzIG9uY2UgaWRlbnRpZmljYXRpb24gaXMgbG9zdCwgaXQgaXMgZXh0cmVtZWx5IGRpZmZpY3VsdCAoYW5kIGNvbnRleHQgZGVwZW5kZW50KSB0byByZXN0b3JlIGl0IGFnYWluLiBDb250YWluZWQgcmVzb3VyY2VzIG1heSBoYXZlIHByb2ZpbGVzIGFuZCB0YWdzIEluIHRoZWlyIG1ldGEgZWxlbWVudHMsIGJ1dCBTSEFMTCBOT1QgaGF2ZSBzZWN1cml0eSBsYWJlbHMuXHJcbiAgICovXHJcbiAgcHVibGljIGNvbnRhaW5lZDogZmhpci5GaGlyUmVzb3VyY2VbXTtcclxuICAvKipcclxuICAgKiBUaGVyZSBjYW4gYmUgbm8gc3RpZ21hIGFzc29jaWF0ZWQgd2l0aCB0aGUgdXNlIG9mIGV4dGVuc2lvbnMgYnkgYW55IGFwcGxpY2F0aW9uLCBwcm9qZWN0LCBvciBzdGFuZGFyZCAtIHJlZ2FyZGxlc3Mgb2YgdGhlIGluc3RpdHV0aW9uIG9yIGp1cmlzZGljdGlvbiB0aGF0IHVzZXMgb3IgZGVmaW5lcyB0aGUgZXh0ZW5zaW9ucy4gIFRoZSB1c2Ugb2YgZXh0ZW5zaW9ucyBpcyB3aGF0IGFsbG93cyB0aGUgRkhJUiBzcGVjaWZpY2F0aW9uIHRvIHJldGFpbiBhIGNvcmUgbGV2ZWwgb2Ygc2ltcGxpY2l0eSBmb3IgZXZlcnlvbmUuXHJcbiAgICovXHJcbiAgcHVibGljIGV4dGVuc2lvbjogZmhpci5FeHRlbnNpb25bXTtcclxuICAvKipcclxuICAgKiBUaGVyZSBjYW4gYmUgbm8gc3RpZ21hIGFzc29jaWF0ZWQgd2l0aCB0aGUgdXNlIG9mIGV4dGVuc2lvbnMgYnkgYW55IGFwcGxpY2F0aW9uLCBwcm9qZWN0LCBvciBzdGFuZGFyZCAtIHJlZ2FyZGxlc3Mgb2YgdGhlIGluc3RpdHV0aW9uIG9yIGp1cmlzZGljdGlvbiB0aGF0IHVzZXMgb3IgZGVmaW5lcyB0aGUgZXh0ZW5zaW9ucy4gIFRoZSB1c2Ugb2YgZXh0ZW5zaW9ucyBpcyB3aGF0IGFsbG93cyB0aGUgRkhJUiBzcGVjaWZpY2F0aW9uIHRvIHJldGFpbiBhIGNvcmUgbGV2ZWwgb2Ygc2ltcGxpY2l0eSBmb3IgZXZlcnlvbmUuXHJcbiAgICovXHJcbiAgcHVibGljIG1vZGlmaWVyRXh0ZW5zaW9uOiBmaGlyLkV4dGVuc2lvbltdO1xyXG4gIC8qKlxyXG4gICAqIERlZmF1bHQgY29uc3RydWN0b3IgZm9yIERvbWFpblJlc291cmNlIC0gaW5pdGlhbGl6ZXMgYW55IHJlcXVpcmVkIGVsZW1lbnRzIHRvIG51bGwgaWYgYSB2YWx1ZSBpcyBub3QgcHJvdmlkZWQuXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3Ioc291cmNlOlBhcnRpYWw8RG9tYWluUmVzb3VyY2VBcmdzPiA9IHt9LCBvcHRpb25zOmZoaXIuRmhpckNvbnN0cnVjdG9yT3B0aW9ucyA9IHt9KSB7XHJcbiAgICBzdXBlcihzb3VyY2UsIG9wdGlvbnMpO1xyXG4gICAgaWYgKHNvdXJjZVsndGV4dCddKSB7IHRoaXMudGV4dCA9IG5ldyBmaGlyLk5hcnJhdGl2ZShzb3VyY2UudGV4dCk7IH1cclxuICAgIGlmIChzb3VyY2VbJ2NvbnRhaW5lZCddKSB7XHJcbiAgICAgIHRoaXMuY29udGFpbmVkID0gW107XHJcbiAgICAgIHNvdXJjZS5jb250YWluZWQuZm9yRWFjaCgoeCkgPT4ge1xyXG4gICAgICAgIHZhciByID0gZmhpci5yZXNvdXJjZUZhY3RvcnkoeCk7XHJcbiAgICAgICAgaWYgKHIpIHsgdGhpcy5jb250YWluZWQhLnB1c2gocik7IH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHsgdGhpcy5jb250YWluZWQgPSBbXTsgfVxyXG4gICAgaWYgKHNvdXJjZVsnZXh0ZW5zaW9uJ10pIHsgdGhpcy5leHRlbnNpb24gPSBzb3VyY2UuZXh0ZW5zaW9uLm1hcCgoeCkgPT4gbmV3IGZoaXIuRXh0ZW5zaW9uKHgpKTsgfVxyXG4gICAgZWxzZSB7IHRoaXMuZXh0ZW5zaW9uID0gW107IH1cclxuICAgIGlmIChzb3VyY2VbJ21vZGlmaWVyRXh0ZW5zaW9uJ10pIHsgdGhpcy5tb2RpZmllckV4dGVuc2lvbiA9IHNvdXJjZS5tb2RpZmllckV4dGVuc2lvbi5tYXAoKHgpID0+IG5ldyBmaGlyLkV4dGVuc2lvbih4KSk7IH1cclxuICAgIGVsc2UgeyB0aGlzLm1vZGlmaWVyRXh0ZW5zaW9uID0gW107IH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICogRnVuY3Rpb24gdG8gcGVyZm9ybSBiYXNpYyBtb2RlbCB2YWxpZGF0aW9uIChlLmcuLCBjaGVjayBpZiByZXF1aXJlZCBlbGVtZW50cyBhcmUgcHJlc2VudCkuXHJcbiAgICovXHJcbiAgcHVibGljIG92ZXJyaWRlIGRvTW9kZWxWYWxpZGF0aW9uKGV4cHJlc3Npb246c3RyaW5nID0gJycpOmZoaXIuRnRzSXNzdWVbXSB7XHJcbiAgICBsZXQgaXNzdWVzOmZoaXIuRnRzSXNzdWVbXSA9IHN1cGVyLmRvTW9kZWxWYWxpZGF0aW9uKGV4cHJlc3Npb24pO1xyXG4gICAgaWYgKGV4cHJlc3Npb24gPT09ICcnKSB7IGV4cHJlc3Npb24gPSAnRG9tYWluUmVzb3VyY2UnIH1cclxuICAgIGlmICh0aGlzW1widGV4dFwiXSkgeyBpc3N1ZXMucHVzaCguLi50aGlzLnRleHQuZG9Nb2RlbFZhbGlkYXRpb24oZXhwcmVzc2lvbisnLnRleHQnKSk7IH1cclxuICAgIGlmICh0aGlzW1wiY29udGFpbmVkXCJdKSB7IHRoaXMuY29udGFpbmVkLmZvckVhY2goKHgsaSkgPT4geyBpc3N1ZXMucHVzaCguLi54LmRvTW9kZWxWYWxpZGF0aW9uKGV4cHJlc3Npb24rYC5jb250YWluZWRbJHtpfV1gKSk7IH0pIH1cclxuICAgIGlmICh0aGlzW1wiZXh0ZW5zaW9uXCJdKSB7IHRoaXMuZXh0ZW5zaW9uLmZvckVhY2goKHgsaSkgPT4geyBpc3N1ZXMucHVzaCguLi54LmRvTW9kZWxWYWxpZGF0aW9uKGV4cHJlc3Npb24rYC5leHRlbnNpb25bJHtpfV1gKSk7IH0pIH1cclxuICAgIGlmICh0aGlzW1wibW9kaWZpZXJFeHRlbnNpb25cIl0pIHsgdGhpcy5tb2RpZmllckV4dGVuc2lvbi5mb3JFYWNoKCh4LGkpID0+IHsgaXNzdWVzLnB1c2goLi4ueC5kb01vZGVsVmFsaWRhdGlvbihleHByZXNzaW9uK2AubW9kaWZpZXJFeHRlbnNpb25bJHtpfV1gKSk7IH0pIH1cclxuICAgIHJldHVybiBpc3N1ZXM7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIEZsdWVudC1zdHlsZSBmdW5jdGlvbiB0byBhZGQgZXh0ZW5zaW9uc1xyXG4gICAqIEBwYXJhbSBleHRcclxuICAgKiBAcmV0dXJucyBcclxuICAgKi9cclxuICBwdWJsaWMgYWRkRXh0ZW5zaW9uKGV4dDpmaGlyLkV4dGVuc2lvbkFyZ3MpOkRvbWFpblJlc291cmNlIHtcclxuICAgIHRoaXMuZXh0ZW5zaW9uLnB1c2gobmV3IGZoaXIuRXh0ZW5zaW9uKGV4dCkpO1xyXG4gICAgcmV0dXJuIHRoaXM7XHJcbiAgfVxyXG4gIFxyXG4gIC8qKlxyXG4gICAqIFJlbW92ZSBBTEwgaW5zdGFuY2VzIG9mIGV4dGVuc2lvbnMgd2l0aCBhIG1hdGNoaW5nIFVSTCwgb3B0aW9uYWxseSByZWN1cnNlIGludG8gZXh0ZW5zaW9uLmV4dGVuc2lvbi5cclxuICAgKiBAcGFyYW0gdXJsIFVSTCBvZiBleHRlbnNpb25zIHRvIHJlbW92ZVxyXG4gICAqIEBwYXJhbSBzZWFyY2hOZXN0ZWQgSWYgdGhlIHJlbW92YWwgc2hvdWxkIHNlYXJjaCBmb3IgbmVzdGVkIGV4dGVuc2lvbnNcclxuICAgKi9cclxuICBwdWJsaWMgcmVtb3ZlRXh0ZW5zaW9ucyh1cmw6Zmhpci5GaGlyU3RyaW5nfHN0cmluZywgc2VhcmNoTmVzdGVkOmJvb2xlYW4gPSBmYWxzZSk6RG9tYWluUmVzb3VyY2Uge1xyXG4gICAgaWYgKHRoaXMuZXh0ZW5zaW9uLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuICAgIGNvbnN0IG1hdGNoVXJsOnN0cmluZyA9ICh0eXBlb2YgdXJsID09PSAnc3RyaW5nJykgPyB1cmwgOiAodXJsIGFzIGZoaXIuRmhpclN0cmluZykudmFsdWUgPz8gJyc7XHJcbiAgICBsZXQgY2xlYW46Zmhpci5FeHRlbnNpb25bXSA9IHRoaXMuZXh0ZW5zaW9uLmZpbHRlcigoZXh0KSA9PiAoZXh0Py51cmw/LnZhbHVlID8/ICcnKSAhPT0gbWF0Y2hVcmwpID8/IFtdO1xyXG4gICAgaWYgKHNlYXJjaE5lc3RlZCkge1xyXG4gICAgICBmb3IgKGxldCBpOm51bWJlciA9IDA7IGkgPCBjbGVhbi5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIGNsZWFuW2ldID0gY2xlYW5baV0ucmVtb3ZlRXh0ZW5zaW9ucyhtYXRjaFVybCwgc2VhcmNoTmVzdGVkKSBhcyBmaGlyLkV4dGVuc2lvbjtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgdGhpcy5leHRlbnNpb24gPSBjbGVhbjtcclxuICAgIHJldHVybiB0aGlzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmluZCB0aGUgZmlyc3QgaW5zdGFuY2Ugb2YgYW4gZXh0ZW5zaW9uIHdpdGggYSBtYXRjaGluZyBVUkwsIG9wdGlvbmFsbHkgcmVjdXJzZSBpbnRvIGV4dGVuc2lvbi5leHRlbnNpb24uXHJcbiAgICogQHBhcmFtIHVybCBVUkwgdG8gc2VhcmNoIGZvclxyXG4gICAqIEBwYXJhbSBzZWFyY2hOZXN0ZWQgSWYgdGhlIHNlYXJjaCBzaG91bGQgbmVzdCBpbnRvIGV4dGVuc2lvbnNcclxuICAgKiBAcmV0dXJucyBUaGUgRkhJUiBFeHRlbnNpb24gaWYgZm91bmQsIG9yIHVuZGVmaW5lZC5cclxuICAgKi9cclxuICBwdWJsaWMgZmluZEV4dGVuc2lvbih1cmw6Zmhpci5GaGlyU3RyaW5nfHN0cmluZywgc2VhcmNoTmVzdGVkOmJvb2xlYW4gPSBmYWxzZSk6Zmhpci5FeHRlbnNpb258dW5kZWZpbmVkIHtcclxuICAgIGlmICh0aGlzLmV4dGVuc2lvbi5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgIH1cclxuICAgIGNvbnN0IG1hdGNoVXJsOnN0cmluZyA9ICh0eXBlb2YgdXJsID09PSAnc3RyaW5nJykgPyB1cmwgOiAodXJsIGFzIGZoaXIuRmhpclN0cmluZykudmFsdWUgPz8gJyc7XHJcbiAgICBpZiAoc2VhcmNoTmVzdGVkKSB7XHJcbiAgICAgIGNvbnN0IGZsYXQ6Zmhpci5FeHRlbnNpb25bXSA9IERvbWFpblJlc291cmNlLnJlY3Vyc2VGb3JFeHRlbnNpb24obWF0Y2hVcmwsIHRoaXMuZXh0ZW5zaW9uKTtcclxuICAgICAgaWYgKGZsYXQubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gZmxhdFswXTtcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLmV4dGVuc2lvbi5maW5kKChleHQpID0+IChleHQ/LnVybD8udmFsdWUgPT09IG1hdGNoVXJsKSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGaW5kIGFsbCBpbnN0YW5jZXMgb2YgYW4gZXh0ZW5zaW9uIHdpdGggYSBtYXRjaGluZyBVUkwsIG9wdGlvbmFsbHkgcmVjdXJzZSBpbnRvIGV4dGVuc2lvbi5leHRlbnNpb24uXHJcbiAgICogQHBhcmFtIHVybCBVUkwgdG8gc2VhcmNoIGZvclxyXG4gICAqIEBwYXJhbSBzZWFyY2hOZXN0ZWQgSWYgdGhlIHNlYXJjaCBzaG91bGQgbmVzdCBpbnRvIGV4dGVuc2lvbnNcclxuICAgKiBAcmV0dXJucyBBIG5ldyBhcnJheSBvZiBGSElSIEV4dGVuc2lvbnMsIHdpdGgganVzdCB0aGUgZGVzaXJlZCBleHRlbnNpb25zXHJcbiAgICovXHJcbiAgcHVibGljIGZpbHRlckV4dGVuc2lvbnModXJsOmZoaXIuRmhpclN0cmluZ3xzdHJpbmcsIHNlYXJjaE5lc3RlZDpib29sZWFuID0gZmFsc2UpOmZoaXIuRXh0ZW5zaW9uW10ge1xyXG4gICAgaWYgKHRoaXMuZXh0ZW5zaW9uLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZXR1cm4gW107XHJcbiAgICB9XHJcbiAgICBjb25zdCBtYXRjaFVybDpzdHJpbmcgPSAodHlwZW9mIHVybCA9PT0gJ3N0cmluZycpID8gdXJsIDogKHVybCBhcyBmaGlyLkZoaXJTdHJpbmcpLnZhbHVlID8/ICcnO1xyXG4gICAgaWYgKHNlYXJjaE5lc3RlZCkge1xyXG4gICAgICByZXR1cm4gRG9tYWluUmVzb3VyY2UucmVjdXJzZUZvckV4dGVuc2lvbihtYXRjaFVybCwgdGhpcy5leHRlbnNpb24pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRoaXMuZXh0ZW5zaW9uLmZpbHRlcigoZXh0KSA9PiAoZXh0Py51cmw/LnZhbHVlID09PSBtYXRjaFVybCkpXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBJbnRlcm5hbCByZWN1cnNpdmUgc2VhcmNoIGZ1bmN0aW9uXHJcbiAgICogQHBhcmFtIHVybCBcclxuICAgKiBAcGFyYW0gZXh0cyBcclxuICAgKiBAcmV0dXJucyBBIG5ldyBhcnJheSAoZmxhdCkgb2YgbWF0Y2hpbmcgZXh0ZW5zaW9uc1xyXG4gICAqL1xyXG4gIHByaXZhdGUgc3RhdGljIHJlY3Vyc2VGb3JFeHRlbnNpb24odXJsOnN0cmluZywgZXh0czpmaGlyLkV4dGVuc2lvbltdKTpmaGlyLkV4dGVuc2lvbltdIHtcclxuICAgIGlmICgoIWV4dHMpIHx8IChleHRzLmxlbmd0aCA9PT0gMCkpIHtcclxuICAgICAgcmV0dXJuIFtdO1xyXG4gICAgfVxyXG4gICAgbGV0IHZhbDpmaGlyLkV4dGVuc2lvbltdID0gW107XHJcbiAgICBleHRzLmZvckVhY2goXHJcbiAgICAgIChleHQpID0+IHtcclxuICAgICAgICBpZiAoZXh0ICYmIGV4dC51cmwgJiYgKGV4dC51cmwudmFsdWUgPT09IHVybCkpIHtcclxuICAgICAgICAgIHZhbC5wdXNoKGV4dCk7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChleHQgJiYgZXh0LmV4dGVuc2lvbiAmJiAoZXh0LmV4dGVuc2lvbi5sZW5ndGggPiAwKSkge1xyXG4gICAgICAgICAgdmFsLnB1c2goLi4udGhpcy5yZWN1cnNlRm9yRXh0ZW5zaW9uKHVybCwgZXh0LmV4dGVuc2lvbikpO1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH0sXHJcbiAgICAgIFtdKTtcclxuICAgIHJldHVybiB2YWw7XHJcbiAgfVxyXG5cclxufVxyXG4iXX0=