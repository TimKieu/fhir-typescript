// <auto-generated/>
// Contents of: hl7.fhir.r4.core version: 4.0.1
// Minimum TypeScript Version: 3.7
// FHIR Resource: DetectedIssue
import * as fhir from '../fhir.js';
// @ts-ignore
import { ObservationStatusVsValidation } from '../fhirValueSets/ObservationStatusVsValidation.js';
// @ts-ignore
import { DetectedissueSeverityVsValidation } from '../fhirValueSets/DetectedissueSeverityVsValidation.js';
/**
 * Supporting evidence or manifestations that provide the basis for identifying the detected issue such as a GuidanceResponse or MeasureReport.
 */
export class DetectedIssueEvidence extends fhir.BackboneElement {
    /**
     * Default constructor for DetectedIssueEvidence - initializes any required elements to null if a value is not provided.
     */
    constructor(source = {}, options = {}) {
        super(source, options);
        if (source['code']) {
            this.code = source.code.map((x) => new fhir.CodeableConcept(x, options));
        }
        else {
            this.code = [];
        }
        if (source['detail']) {
            this.detail = source.detail.map((x) => new fhir.Reference(x, options));
        }
        else {
            this.detail = [];
        }
    }
    /**
     * Function to perform basic model validation (e.g., check if required elements are present).
     */
    doModelValidation(exp = '') {
        let iss = super.doModelValidation(exp);
        if (exp === '') {
            exp = 'DetectedIssue.evidence';
        }
        iss.push(...this.vOA('code', exp));
        iss.push(...this.vOA('detail', exp));
        return iss;
    }
}
/**
 * Mapping of this datatype to a FHIR equivalent
 */
DetectedIssueEvidence._fts_dataType = 'DetectedIssueEvidence';
/**
 * Indicates an action that has been taken or is committed to reduce or eliminate the likelihood of the risk identified by the detected issue from manifesting.  Can also reflect an observation of known mitigating factors that may reduce/eliminate the need for any action.
 */
export class DetectedIssueMitigation extends fhir.BackboneElement {
    /**
     * Default constructor for DetectedIssueMitigation - initializes any required elements to null if a value is not provided.
     */
    constructor(source = {}, options = {}) {
        super(source, options);
        if (source['action']) {
            this.action = new fhir.CodeableConcept(source.action, options);
        }
        else {
            this.action = null;
        }
        if (source['date'] !== undefined) {
            this.date = new fhir.FhirDateTime({ value: source.date }, options);
        }
        if (source['_date']) {
            if (this.date) {
                this.date.addExtendedProperties(source._date);
            }
            else {
                this.date = new fhir.FhirDateTime(source._date, options);
            }
        }
        if (source['author']) {
            this.author = new fhir.Reference(source.author, options);
        }
    }
    /**
     * Function to perform basic model validation (e.g., check if required elements are present).
     */
    doModelValidation(exp = '') {
        let iss = super.doModelValidation(exp);
        if (exp === '') {
            exp = 'DetectedIssue.mitigation';
        }
        iss.push(...this.vRS('action', exp));
        iss.push(...this.vOS('date', exp));
        iss.push(...this.vOS('author', exp));
        return iss;
    }
}
/**
 * Mapping of this datatype to a FHIR equivalent
 */
DetectedIssueMitigation._fts_dataType = 'DetectedIssueMitigation';
/**
 * Indicates an actual or potential clinical issue with or between one or more active or proposed clinical actions for a patient; e.g. Drug-drug interaction, Ineffective treatment frequency, Procedure-condition conflict, etc.
 */
export class DetectedIssue extends fhir.DomainResource {
    /**
     * Default constructor for DetectedIssue - initializes any required elements to null if a value is not provided.
     */
    constructor(source = {}, options = {}) {
        super(source, options);
        this.resourceType = 'DetectedIssue';
        if (source['identifier']) {
            this.identifier = source.identifier.map((x) => new fhir.Identifier(x, options));
        }
        else {
            this.identifier = [];
        }
        if (source['status'] !== undefined) {
            this.status = new fhir.FhirCode({ value: source.status }, options);
        }
        else {
            this.status = null;
        }
        if (source['_status']) {
            if (this.status) {
                this.status.addExtendedProperties(source._status);
            }
            else {
                this.status = new fhir.FhirCode(source._status, options);
            }
        }
        if (source['code']) {
            this.code = new fhir.CodeableConcept(source.code, options);
        }
        if (source['severity'] !== undefined) {
            this.severity = new fhir.FhirCode({ value: source.severity }, options);
        }
        if (source['_severity']) {
            if (this.severity) {
                this.severity.addExtendedProperties(source._severity);
            }
            else {
                this.severity = new fhir.FhirCode(source._severity, options);
            }
        }
        if (source['patient']) {
            this.patient = new fhir.Reference(source.patient, options);
        }
        if (source['identified']) {
            this.identified = source.identified;
        }
        else if (source['identifiedDateTime'] !== undefined) {
            this.identified = new fhir.FhirDateTime({ value: source.identifiedDateTime }, options);
        }
        else if (source['identifiedPeriod']) {
            this.identified = new fhir.Period(source.identifiedPeriod, options);
        }
        if (source['author']) {
            this.author = new fhir.Reference(source.author, options);
        }
        if (source['implicated']) {
            this.implicated = source.implicated.map((x) => new fhir.Reference(x, options));
        }
        else {
            this.implicated = [];
        }
        if (source['evidence']) {
            this.evidence = source.evidence.map((x) => new fhir.DetectedIssueEvidence(x, options));
        }
        else {
            this.evidence = [];
        }
        if (source['detail'] !== undefined) {
            this.detail = new fhir.FhirString({ value: source.detail }, options);
        }
        if (source['_detail']) {
            if (this.detail) {
                this.detail.addExtendedProperties(source._detail);
            }
            else {
                this.detail = new fhir.FhirString(source._detail, options);
            }
        }
        if (source['reference'] !== undefined) {
            this.reference = new fhir.FhirUri({ value: source.reference }, options);
        }
        if (source['_reference']) {
            if (this.reference) {
                this.reference.addExtendedProperties(source._reference);
            }
            else {
                this.reference = new fhir.FhirUri(source._reference, options);
            }
        }
        if (source['mitigation']) {
            this.mitigation = source.mitigation.map((x) => new fhir.DetectedIssueMitigation(x, options));
        }
        else {
            this.mitigation = [];
        }
    }
    /**
     * Function to perform basic model validation (e.g., check if required elements are present).
     */
    doModelValidation(exp = '') {
        let iss = super.doModelValidation(exp);
        if (exp === '') {
            exp = 'DetectedIssue';
        }
        iss.push(...this.vOA('identifier', exp));
        iss.push(...this.vRSV('status', exp, 'ObservationStatus', ObservationStatusVsValidation, 'r'));
        iss.push(...this.vOS('code', exp));
        iss.push(...this.vOSV('severity', exp, 'DetectedissueSeverity', DetectedissueSeverityVsValidation, 'r'));
        iss.push(...this.vOS('patient', exp));
        iss.push(...this.vOS('identified', exp));
        iss.push(...this.vOS('author', exp));
        iss.push(...this.vOA('implicated', exp));
        iss.push(...this.vOA('evidence', exp));
        iss.push(...this.vOS('detail', exp));
        iss.push(...this.vOS('reference', exp));
        iss.push(...this.vOA('mitigation', exp));
        return iss;
    }
}
/**
 * Mapping of this datatype to a FHIR equivalent
 */
DetectedIssue._fts_dataType = 'DetectedIssue';
/**
 * Internal flag to properly serialize choice-type element DetectedIssue.identified[x]
 */
DetectedIssue._fts_identifiedIsChoice = true;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRGV0ZWN0ZWRJc3N1ZS5qcyIsInNvdXJjZVJvb3QiOiIuL3NyYy8iLCJzb3VyY2VzIjpbImZoaXIvRGV0ZWN0ZWRJc3N1ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxvQkFBb0I7QUFDcEIsK0NBQStDO0FBQy9DLGtDQUFrQztBQUNsQywrQkFBK0I7QUFFL0IsT0FBTyxLQUFLLElBQUksTUFBTSxZQUFZLENBQUM7QUFZbkMsYUFBYTtBQUNiLE9BQU8sRUFBRSw2QkFBNkIsRUFBRSxNQUFNLG1EQUFtRCxDQUFDO0FBT2xHLGFBQWE7QUFDYixPQUFPLEVBQUUsaUNBQWlDLEVBQUUsTUFBTSx1REFBdUQsQ0FBQztBQWUxRzs7R0FFRztBQUNILE1BQU0sT0FBTyxxQkFBc0IsU0FBUSxJQUFJLENBQUMsZUFBZTtJQWE3RDs7T0FFRztJQUNILFlBQVksU0FBNEMsRUFBRSxFQUFFLFVBQXNDLEVBQUU7UUFDbEcsS0FBSyxDQUFDLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQztRQUN2QixJQUFJLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRTtZQUFFLElBQUksQ0FBQyxJQUFJLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLElBQUksSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQztTQUFFO2FBQzVGO1lBQUUsSUFBSSxDQUFDLElBQUksR0FBRyxFQUFFLENBQUM7U0FBRTtRQUN4QixJQUFJLE1BQU0sQ0FBQyxRQUFRLENBQUMsRUFBRTtZQUFFLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQztTQUFFO2FBQzVGO1lBQUUsSUFBSSxDQUFDLE1BQU0sR0FBRyxFQUFFLENBQUM7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QUMsR0FBRyxDQUFDLFlBQVksRUFBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ3hDLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBQyxHQUFHLEVBQUMsbUJBQW1CLEVBQUMsNkJBQTZCLEVBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUMzRixHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUNsQyxHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUMsR0FBRyxFQUFDLHVCQUF1QixFQUFDLGlDQUFpQyxFQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDckcsR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDckMsR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsWUFBWSxFQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDeEMsR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDcEMsR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsWUFBWSxFQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDeEMsR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDdEMsR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDcEMsR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsV0FBVyxFQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDdkMsR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsWUFBWSxFQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDeEMsT0FBTyxHQUFHLENBQUM7SUFDYixDQUFDOztBQXpIRDs7R0FFRztBQUM2QiwyQkFBYSxHQUFVLGVBQWUsQ0FBQztBQTZCdkU7O0dBRUc7QUFDdUIscUNBQXVCLEdBQVEsSUFBSSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gPGF1dG8tZ2VuZXJhdGVkLz5cclxuLy8gQ29udGVudHMgb2Y6IGhsNy5maGlyLnI0LmNvcmUgdmVyc2lvbjogNC4wLjFcclxuLy8gTWluaW11bSBUeXBlU2NyaXB0IFZlcnNpb246IDMuN1xyXG4vLyBGSElSIFJlc291cmNlOiBEZXRlY3RlZElzc3VlXHJcblxyXG5pbXBvcnQgKiBhcyBmaGlyIGZyb20gJy4uL2ZoaXIuanMnO1xyXG5cclxuLy8gQHRzLWlnbm9yZVxyXG5pbXBvcnQgeyBNYW5pZmVzdGF0aW9uT3JTeW1wdG9tQ29kZXMsICBNYW5pZmVzdGF0aW9uT3JTeW1wdG9tQ29kZVR5cGUgfSBmcm9tICcuLi9maGlyVmFsdWVTZXRzL01hbmlmZXN0YXRpb25PclN5bXB0b21Db2Rlcy5qcyc7XHJcbi8vIEB0cy1pZ25vcmVcclxuaW1wb3J0IHsgTWFuaWZlc3RhdGlvbk9yU3ltcHRvbVZzVmFsaWRhdGlvbiB9IGZyb20gJy4uL2ZoaXJWYWx1ZVNldHMvTWFuaWZlc3RhdGlvbk9yU3ltcHRvbVZzVmFsaWRhdGlvbi5qcyc7XHJcbi8vIEB0cy1pZ25vcmVcclxuaW1wb3J0IHsgRGV0ZWN0ZWRpc3N1ZU1pdGlnYXRpb25BY3Rpb25Db2RlcywgIERldGVjdGVkaXNzdWVNaXRpZ2F0aW9uQWN0aW9uQ29kZVR5cGUgfSBmcm9tICcuLi9maGlyVmFsdWVTZXRzL0RldGVjdGVkaXNzdWVNaXRpZ2F0aW9uQWN0aW9uQ29kZXMuanMnO1xyXG4vLyBAdHMtaWdub3JlXHJcbmltcG9ydCB7IERldGVjdGVkaXNzdWVNaXRpZ2F0aW9uQWN0aW9uVnNWYWxpZGF0aW9uIH0gZnJvbSAnLi4vZmhpclZhbHVlU2V0cy9EZXRlY3RlZGlzc3VlTWl0aWdhdGlvbkFjdGlvblZzVmFsaWRhdGlvbi5qcyc7XHJcbi8vIEB0cy1pZ25vcmVcclxuaW1wb3J0IHsgT2JzZXJ2YXRpb25TdGF0dXNDb2RlcywgIE9ic2VydmF0aW9uU3RhdHVzQ29kZVR5cGUgfSBmcm9tICcuLi9maGlyVmFsdWVTZXRzL09ic2VydmF0aW9uU3RhdHVzQ29kZXMuanMnO1xyXG4vLyBAdHMtaWdub3JlXHJcbmltcG9ydCB7IE9ic2VydmF0aW9uU3RhdHVzVnNWYWxpZGF0aW9uIH0gZnJvbSAnLi4vZmhpclZhbHVlU2V0cy9PYnNlcnZhdGlvblN0YXR1c1ZzVmFsaWRhdGlvbi5qcyc7XHJcbi8vIEB0cy1pZ25vcmVcclxuaW1wb3J0IHsgRGV0ZWN0ZWRpc3N1ZUNhdGVnb3J5Q29kZXMsICBEZXRlY3RlZGlzc3VlQ2F0ZWdvcnlDb2RlVHlwZSB9IGZyb20gJy4uL2ZoaXJWYWx1ZVNldHMvRGV0ZWN0ZWRpc3N1ZUNhdGVnb3J5Q29kZXMuanMnO1xyXG4vLyBAdHMtaWdub3JlXHJcbmltcG9ydCB7IERldGVjdGVkaXNzdWVDYXRlZ29yeVZzVmFsaWRhdGlvbiB9IGZyb20gJy4uL2ZoaXJWYWx1ZVNldHMvRGV0ZWN0ZWRpc3N1ZUNhdGVnb3J5VnNWYWxpZGF0aW9uLmpzJztcclxuLy8gQHRzLWlnbm9yZVxyXG5pbXBvcnQgeyBEZXRlY3RlZGlzc3VlU2V2ZXJpdHlDb2RlcywgIERldGVjdGVkaXNzdWVTZXZlcml0eUNvZGVUeXBlIH0gZnJvbSAnLi4vZmhpclZhbHVlU2V0cy9EZXRlY3RlZGlzc3VlU2V2ZXJpdHlDb2Rlcy5qcyc7XHJcbi8vIEB0cy1pZ25vcmVcclxuaW1wb3J0IHsgRGV0ZWN0ZWRpc3N1ZVNldmVyaXR5VnNWYWxpZGF0aW9uIH0gZnJvbSAnLi4vZmhpclZhbHVlU2V0cy9EZXRlY3RlZGlzc3VlU2V2ZXJpdHlWc1ZhbGlkYXRpb24uanMnO1xyXG4vKipcclxuICogVmFsaWQgYXJndW1lbnRzIGZvciB0aGUgRGV0ZWN0ZWRJc3N1ZUV2aWRlbmNlIHR5cGUuXHJcbiAqL1xyXG5leHBvcnQgaW50ZXJmYWNlIERldGVjdGVkSXNzdWVFdmlkZW5jZUFyZ3MgZXh0ZW5kcyBmaGlyLkJhY2tib25lRWxlbWVudEFyZ3Mge1xyXG4gIC8qKlxyXG4gICAqIEEgbWFuaWZlc3RhdGlvbiB0aGF0IGxlZCB0byB0aGUgcmVjb3JkaW5nIG9mIHRoaXMgZGV0ZWN0ZWQgaXNzdWUuXHJcbiAgICovXHJcbiAgY29kZT86IGZoaXIuQ29kZWFibGVDb25jZXB0QXJnc1tdfHVuZGVmaW5lZDtcclxuICAvKipcclxuICAgKiBMaW5rcyB0byByZXNvdXJjZXMgdGhhdCBjb25zdGl0dXRlIGV2aWRlbmNlIGZvciB0aGUgZGV0ZWN0ZWQgaXNzdWUgc3VjaCBhcyBhIEd1aWRhbmNlUmVzcG9uc2Ugb3IgTWVhc3VyZVJlcG9ydC5cclxuICAgKi9cclxuICBkZXRhaWw/OiBmaGlyLlJlZmVyZW5jZUFyZ3NbXXx1bmRlZmluZWQ7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTdXBwb3J0aW5nIGV2aWRlbmNlIG9yIG1hbmlmZXN0YXRpb25zIHRoYXQgcHJvdmlkZSB0aGUgYmFzaXMgZm9yIGlkZW50aWZ5aW5nIHRoZSBkZXRlY3RlZCBpc3N1ZSBzdWNoIGFzIGEgR3VpZGFuY2VSZXNwb25zZSBvciBNZWFzdXJlUmVwb3J0LlxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIERldGVjdGVkSXNzdWVFdmlkZW5jZSBleHRlbmRzIGZoaXIuQmFja2JvbmVFbGVtZW50IHtcclxuICAvKipcclxuICAgKiBNYXBwaW5nIG9mIHRoaXMgZGF0YXR5cGUgdG8gYSBGSElSIGVxdWl2YWxlbnRcclxuICAgKi9cclxuICBwdWJsaWMgc3RhdGljIG92ZXJyaWRlIHJlYWRvbmx5IF9mdHNfZGF0YVR5cGU6c3RyaW5nID0gJ0RldGVjdGVkSXNzdWVFdmlkZW5jZSc7XHJcbiAgLyoqXHJcbiAgICogQSBtYW5pZmVzdGF0aW9uIHRoYXQgbGVkIHRvIHRoZSByZWNvcmRpbmcgb2YgdGhpcyBkZXRlY3RlZCBpc3N1ZS5cclxuICAgKi9cclxuICBwdWJsaWMgY29kZTogZmhpci5Db2RlYWJsZUNvbmNlcHRbXTtcclxuICAvKipcclxuICAgKiBMaW5rcyB0byByZXNvdXJjZXMgdGhhdCBjb25zdGl0dXRlIGV2aWRlbmNlIGZvciB0aGUgZGV0ZWN0ZWQgaXNzdWUgc3VjaCBhcyBhIEd1aWRhbmNlUmVzcG9uc2Ugb3IgTWVhc3VyZVJlcG9ydC5cclxuICAgKi9cclxuICBwdWJsaWMgZGV0YWlsOiBmaGlyLlJlZmVyZW5jZVtdO1xyXG4gIC8qKlxyXG4gICAqIERlZmF1bHQgY29uc3RydWN0b3IgZm9yIERldGVjdGVkSXNzdWVFdmlkZW5jZSAtIGluaXRpYWxpemVzIGFueSByZXF1aXJlZCBlbGVtZW50cyB0byBudWxsIGlmIGEgdmFsdWUgaXMgbm90IHByb3ZpZGVkLlxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKHNvdXJjZTpQYXJ0aWFsPERldGVjdGVkSXNzdWVFdmlkZW5jZUFyZ3M+ID0ge30sIG9wdGlvbnM6Zmhpci5GaGlyQ29uc3RydWN0b3JPcHRpb25zID0ge30pIHtcclxuICAgIHN1cGVyKHNvdXJjZSwgb3B0aW9ucyk7XHJcbiAgICBpZiAoc291cmNlWydjb2RlJ10pIHsgdGhpcy5jb2RlID0gc291cmNlLmNvZGUubWFwKCh4KSA9PiBuZXcgZmhpci5Db2RlYWJsZUNvbmNlcHQoeCwgb3B0aW9ucykpOyB9XHJcbiAgICBlbHNlIHsgdGhpcy5jb2RlID0gW107IH1cclxuICAgIGlmIChzb3VyY2VbJ2RldGFpbCddKSB7IHRoaXMuZGV0YWlsID0gc291cmNlLmRldGFpbC5tYXAoKHgpID0+IG5ldyBmaGlyLlJlZmVyZW5jZSh4LCBvcHRpb25zKSk7IH1cclxuICAgIGVsc2UgeyB0aGlzLmRldGFpbCA9IFtdOyB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIEZ1bmN0aW9uIHRvIHBlcmZvcm0gYmFzaWMgbW9kZWwgdmFsaWRhdGlvbiAoZS5nLiwgY2hlY2sgaWYgcmVxdWlyZWQgZWxlbWVudHMgYXJlIHByZXNlbnQpLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBvdmVycmlkZSBkb01vZGVsVmFsaWRhdGlvbihleHA6c3RyaW5nID0gJycpOmZoaXIuRnRzSXNzdWVbXSB7XHJcbiAgICBsZXQgaXNzOmZoaXIuRnRzSXNzdWVbXSA9IHN1cGVyLmRvTW9kZWxWYWxpZGF0aW9uKGV4cCk7XHJcbiAgICBpZiAoZXhwID09PSAnJykgeyBleHAgPSAnRGV0ZWN0ZWRJc3N1ZS5ldmlkZW5jZScgfVxyXG4gICAgaXNzLnB1c2goLi4udGhpcy52T0EoJ2NvZGUnLGV4cCkpO1xyXG4gICAgaXNzLnB1c2goLi4udGhpcy52T0EoJ2RldGFpbCcsZXhwKSk7XHJcbiAgICByZXR1cm4gaXNzO1xyXG4gIH1cclxufVxyXG4vKipcclxuICogVmFsaWQgYXJndW1lbnRzIGZvciB0aGUgRGV0ZWN0ZWRJc3N1ZU1pdGlnYXRpb24gdHlwZS5cclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgRGV0ZWN0ZWRJc3N1ZU1pdGlnYXRpb25BcmdzIGV4dGVuZHMgZmhpci5CYWNrYm9uZUVsZW1lbnRBcmdzIHtcclxuICAvKipcclxuICAgKiBUaGUgXCJ0ZXh0XCIgY29tcG9uZW50IGNhbiBiZSB1c2VkIGZvciBkZXRhaWwgb3Igd2hlbiBubyBhcHByb3ByaWF0ZSBjb2RlIGV4aXN0cy5cclxuICAgKi9cclxuICBhY3Rpb246IGZoaXIuQ29kZWFibGVDb25jZXB0QXJnc3xudWxsO1xyXG4gIC8qKlxyXG4gICAqIFRoaXMgbWlnaHQgbm90IGJlIHRoZSBzYW1lIGFzIHdoZW4gdGhlIG1pdGlnYXRpbmcgc3RlcCB3YXMgYWN0dWFsbHkgdGFrZW4uXHJcbiAgICovXHJcbiAgZGF0ZT86IGZoaXIuRmhpckRhdGVUaW1lfHN0cmluZ3x1bmRlZmluZWQ7XHJcbiAgLyoqXHJcbiAgICogRXh0ZW5kZWQgcHJvcGVydGllcyBmb3IgcHJpbWl0aXZlIGVsZW1lbnQ6IERldGVjdGVkSXNzdWUubWl0aWdhdGlvbi5kYXRlXHJcbiAgICovXHJcbiAgX2RhdGU/OmZoaXIuRmhpckVsZW1lbnRBcmdzO1xyXG4gIC8qKlxyXG4gICAqIElkZW50aWZpZXMgdGhlIHByYWN0aXRpb25lciB3aG8gZGV0ZXJtaW5lZCB0aGUgbWl0aWdhdGlvbiBhbmQgdGFrZXMgcmVzcG9uc2liaWxpdHkgZm9yIHRoZSBtaXRpZ2F0aW9uIHN0ZXAgb2NjdXJyaW5nLlxyXG4gICAqL1xyXG4gIGF1dGhvcj86IGZoaXIuUmVmZXJlbmNlQXJnc3x1bmRlZmluZWQ7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBJbmRpY2F0ZXMgYW4gYWN0aW9uIHRoYXQgaGFzIGJlZW4gdGFrZW4gb3IgaXMgY29tbWl0dGVkIHRvIHJlZHVjZSBvciBlbGltaW5hdGUgdGhlIGxpa2VsaWhvb2Qgb2YgdGhlIHJpc2sgaWRlbnRpZmllZCBieSB0aGUgZGV0ZWN0ZWQgaXNzdWUgZnJvbSBtYW5pZmVzdGluZy4gIENhbiBhbHNvIHJlZmxlY3QgYW4gb2JzZXJ2YXRpb24gb2Yga25vd24gbWl0aWdhdGluZyBmYWN0b3JzIHRoYXQgbWF5IHJlZHVjZS9lbGltaW5hdGUgdGhlIG5lZWQgZm9yIGFueSBhY3Rpb24uXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgRGV0ZWN0ZWRJc3N1ZU1pdGlnYXRpb24gZXh0ZW5kcyBmaGlyLkJhY2tib25lRWxlbWVudCB7XHJcbiAgLyoqXHJcbiAgICogTWFwcGluZyBvZiB0aGlzIGRhdGF0eXBlIHRvIGEgRkhJUiBlcXVpdmFsZW50XHJcbiAgICovXHJcbiAgcHVibGljIHN0YXRpYyBvdmVycmlkZSByZWFkb25seSBfZnRzX2RhdGFUeXBlOnN0cmluZyA9ICdEZXRlY3RlZElzc3VlTWl0aWdhdGlvbic7XHJcbiAgLyoqXHJcbiAgICogVGhlIFwidGV4dFwiIGNvbXBvbmVudCBjYW4gYmUgdXNlZCBmb3IgZGV0YWlsIG9yIHdoZW4gbm8gYXBwcm9wcmlhdGUgY29kZSBleGlzdHMuXHJcbiAgICovXHJcbiAgcHVibGljIGFjdGlvbjogZmhpci5Db2RlYWJsZUNvbmNlcHR8bnVsbDtcclxuICAvKipcclxuICAgKiBUaGlzIG1pZ2h0IG5vdCBiZSB0aGUgc2FtZSBhcyB3aGVuIHRoZSBtaXRpZ2F0aW5nIHN0ZXAgd2FzIGFjdHVhbGx5IHRha2VuLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBkYXRlPzogZmhpci5GaGlyRGF0ZVRpbWV8dW5kZWZpbmVkO1xyXG4gIC8qKlxyXG4gICAqIElkZW50aWZpZXMgdGhlIHByYWN0aXRpb25lciB3aG8gZGV0ZXJtaW5lZCB0aGUgbWl0aWdhdGlvbiBhbmQgdGFrZXMgcmVzcG9uc2liaWxpdHkgZm9yIHRoZSBtaXRpZ2F0aW9uIHN0ZXAgb2NjdXJyaW5nLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBhdXRob3I/OiBmaGlyLlJlZmVyZW5jZXx1bmRlZmluZWQ7XHJcbiAgLyoqXHJcbiAgICogRGVmYXVsdCBjb25zdHJ1Y3RvciBmb3IgRGV0ZWN0ZWRJc3N1ZU1pdGlnYXRpb24gLSBpbml0aWFsaXplcyBhbnkgcmVxdWlyZWQgZWxlbWVudHMgdG8gbnVsbCBpZiBhIHZhbHVlIGlzIG5vdCBwcm92aWRlZC5cclxuICAgKi9cclxuICBjb25zdHJ1Y3Rvcihzb3VyY2U6UGFydGlhbDxEZXRlY3RlZElzc3VlTWl0aWdhdGlvbkFyZ3M+ID0ge30sIG9wdGlvbnM6Zmhpci5GaGlyQ29uc3RydWN0b3JPcHRpb25zID0ge30pIHtcclxuICAgIHN1cGVyKHNvdXJjZSwgb3B0aW9ucyk7XHJcbiAgICBpZiAoc291cmNlWydhY3Rpb24nXSkgeyB0aGlzLmFjdGlvbiA9IG5ldyBmaGlyLkNvZGVhYmxlQ29uY2VwdChzb3VyY2UuYWN0aW9uLCBvcHRpb25zKTsgfVxyXG4gICAgZWxzZSB7IHRoaXMuYWN0aW9uID0gbnVsbDsgfVxyXG4gICAgaWYgKHNvdXJjZVsnZGF0ZSddICE9PSB1bmRlZmluZWQpIHsgdGhpcy5kYXRlID0gbmV3IGZoaXIuRmhpckRhdGVUaW1lKHt2YWx1ZTogc291cmNlLmRhdGV9LCBvcHRpb25zKTsgfVxyXG4gICAgaWYgKHNvdXJjZVsnX2RhdGUnXSkge1xyXG4gICAgICBpZiAodGhpcy5kYXRlKSB7IHRoaXMuZGF0ZS5hZGRFeHRlbmRlZFByb3BlcnRpZXMoc291cmNlLl9kYXRlISk7IH1cclxuICAgICAgZWxzZSB7IHRoaXMuZGF0ZSA9IG5ldyBmaGlyLkZoaXJEYXRlVGltZShzb3VyY2UuX2RhdGUgYXMgUGFydGlhbDxmaGlyLkZoaXJEYXRlVGltZUFyZ3M+LCBvcHRpb25zKTsgfVxyXG4gICAgfVxyXG4gICAgaWYgKHNvdXJjZVsnYXV0aG9yJ10pIHsgdGhpcy5hdXRob3IgPSBuZXcgZmhpci5SZWZlcmVuY2Uoc291cmNlLmF1dGhvciwgb3B0aW9ucyk7IH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICogRnVuY3Rpb24gdG8gcGVyZm9ybSBiYXNpYyBtb2RlbCB2YWxpZGF0aW9uIChlLmcuLCBjaGVjayBpZiByZXF1aXJlZCBlbGVtZW50cyBhcmUgcHJlc2VudCkuXHJcbiAgICovXHJcbiAgcHVibGljIG92ZXJyaWRlIGRvTW9kZWxWYWxpZGF0aW9uKGV4cDpzdHJpbmcgPSAnJyk6Zmhpci5GdHNJc3N1ZVtdIHtcclxuICAgIGxldCBpc3M6Zmhpci5GdHNJc3N1ZVtdID0gc3VwZXIuZG9Nb2RlbFZhbGlkYXRpb24oZXhwKTtcclxuICAgIGlmIChleHAgPT09ICcnKSB7IGV4cCA9ICdEZXRlY3RlZElzc3VlLm1pdGlnYXRpb24nIH1cclxuICAgIGlzcy5wdXNoKC4uLnRoaXMudlJTKCdhY3Rpb24nLGV4cCkpO1xyXG4gICAgaXNzLnB1c2goLi4udGhpcy52T1MoJ2RhdGUnLGV4cCkpO1xyXG4gICAgaXNzLnB1c2goLi4udGhpcy52T1MoJ2F1dGhvcicsZXhwKSk7XHJcbiAgICByZXR1cm4gaXNzO1xyXG4gIH1cclxufVxyXG4vKipcclxuICogVmFsaWQgYXJndW1lbnRzIGZvciB0aGUgRGV0ZWN0ZWRJc3N1ZSB0eXBlLlxyXG4gKi9cclxuZXhwb3J0IGludGVyZmFjZSBEZXRlY3RlZElzc3VlQXJncyBleHRlbmRzIGZoaXIuRG9tYWluUmVzb3VyY2VBcmdzIHtcclxuICAvKipcclxuICAgKiBSZXNvdXJjZSBUeXBlIE5hbWVcclxuICAgKi9cclxuICByZXNvdXJjZVR5cGU6IFwiRGV0ZWN0ZWRJc3N1ZVwifHVuZGVmaW5lZDtcclxuICAvKipcclxuICAgKiBCdXNpbmVzcyBpZGVudGlmaWVyIGFzc29jaWF0ZWQgd2l0aCB0aGUgZGV0ZWN0ZWQgaXNzdWUgcmVjb3JkLlxyXG4gICAqL1xyXG4gIGlkZW50aWZpZXI/OiBmaGlyLklkZW50aWZpZXJBcmdzW118dW5kZWZpbmVkO1xyXG4gIC8qKlxyXG4gICAqIFRoaXMgZWxlbWVudCBpcyBsYWJlbGVkIGFzIGEgbW9kaWZpZXIgYmVjYXVzZSB0aGUgc3RhdHVzIGNvbnRhaW5zIHRoZSBjb2RlcyBjYW5jZWxsZWQgYW5kIGVudGVyZWQtaW4tZXJyb3IgdGhhdCBtYXJrIHRoZSBpc3N1ZSBhcyBub3QgY3VycmVudGx5IHZhbGlkLlxyXG4gICAqL1xyXG4gIHN0YXR1czogZmhpci5GaGlyQ29kZTxPYnNlcnZhdGlvblN0YXR1c0NvZGVUeXBlPnxzdHJpbmd8dW5kZWZpbmVkO1xyXG4gIC8qKlxyXG4gICAqIEV4dGVuZGVkIHByb3BlcnRpZXMgZm9yIHByaW1pdGl2ZSBlbGVtZW50OiBEZXRlY3RlZElzc3VlLnN0YXR1c1xyXG4gICAqL1xyXG4gIF9zdGF0dXM/OmZoaXIuRmhpckVsZW1lbnRBcmdzO1xyXG4gIC8qKlxyXG4gICAqIElkZW50aWZpZXMgdGhlIGdlbmVyYWwgdHlwZSBvZiBpc3N1ZSBpZGVudGlmaWVkLlxyXG4gICAqL1xyXG4gIGNvZGU/OiBmaGlyLkNvZGVhYmxlQ29uY2VwdEFyZ3N8dW5kZWZpbmVkO1xyXG4gIC8qKlxyXG4gICAqIEluZGljYXRlcyB0aGUgZGVncmVlIG9mIGltcG9ydGFuY2UgYXNzb2NpYXRlZCB3aXRoIHRoZSBpZGVudGlmaWVkIGlzc3VlIGJhc2VkIG9uIHRoZSBwb3RlbnRpYWwgaW1wYWN0IG9uIHRoZSBwYXRpZW50LlxyXG4gICAqL1xyXG4gIHNldmVyaXR5PzogZmhpci5GaGlyQ29kZTxEZXRlY3RlZGlzc3VlU2V2ZXJpdHlDb2RlVHlwZT58c3RyaW5nfHVuZGVmaW5lZDtcclxuICAvKipcclxuICAgKiBFeHRlbmRlZCBwcm9wZXJ0aWVzIGZvciBwcmltaXRpdmUgZWxlbWVudDogRGV0ZWN0ZWRJc3N1ZS5zZXZlcml0eVxyXG4gICAqL1xyXG4gIF9zZXZlcml0eT86Zmhpci5GaGlyRWxlbWVudEFyZ3M7XHJcbiAgLyoqXHJcbiAgICogSW5kaWNhdGVzIHRoZSBwYXRpZW50IHdob3NlIHJlY29yZCB0aGUgZGV0ZWN0ZWQgaXNzdWUgaXMgYXNzb2NpYXRlZCB3aXRoLlxyXG4gICAqL1xyXG4gIHBhdGllbnQ/OiBmaGlyLlJlZmVyZW5jZUFyZ3N8dW5kZWZpbmVkO1xyXG4gIC8qKlxyXG4gICAqIFRoZSBkYXRlIG9yIHBlcmlvZCB3aGVuIHRoZSBkZXRlY3RlZCBpc3N1ZSB3YXMgaW5pdGlhbGx5IGlkZW50aWZpZWQuXHJcbiAgICovXHJcbiAgaWRlbnRpZmllZD86IGZoaXIuRmhpckRhdGVUaW1lfGZoaXIuUGVyaW9kfHVuZGVmaW5lZDtcclxuICAvKipcclxuICAgKiBUaGUgZGF0ZSBvciBwZXJpb2Qgd2hlbiB0aGUgZGV0ZWN0ZWQgaXNzdWUgd2FzIGluaXRpYWxseSBpZGVudGlmaWVkLlxyXG4gICAqL1xyXG4gIGlkZW50aWZpZWREYXRlVGltZT86IGZoaXIuRmhpckRhdGVUaW1lfHN0cmluZ3x1bmRlZmluZWQ7XHJcbiAgLyoqXHJcbiAgICogVGhlIGRhdGUgb3IgcGVyaW9kIHdoZW4gdGhlIGRldGVjdGVkIGlzc3VlIHdhcyBpbml0aWFsbHkgaWRlbnRpZmllZC5cclxuICAgKi9cclxuICBpZGVudGlmaWVkUGVyaW9kPzogZmhpci5QZXJpb2RBcmdzfHVuZGVmaW5lZDtcclxuICAvKipcclxuICAgKiBJbmRpdmlkdWFsIG9yIGRldmljZSByZXNwb25zaWJsZSBmb3IgdGhlIGlzc3VlIGJlaW5nIHJhaXNlZC4gIEZvciBleGFtcGxlLCBhIGRlY2lzaW9uIHN1cHBvcnQgYXBwbGljYXRpb24gb3IgYSBwaGFybWFjaXN0IGNvbmR1Y3RpbmcgYSBtZWRpY2F0aW9uIHJldmlldy5cclxuICAgKi9cclxuICBhdXRob3I/OiBmaGlyLlJlZmVyZW5jZUFyZ3N8dW5kZWZpbmVkO1xyXG4gIC8qKlxyXG4gICAqIFRoZXJlJ3MgYW4gaW1wbGljaXQgY29uc3RyYWludCBvbiB0aGUgbnVtYmVyIG9mIGltcGxpY2F0ZWQgcmVzb3VyY2VzIGJhc2VkIG9uIERldGVjdGVkSXNzdWUudHlwZTsgZS5nLiBGb3IgZHJ1Zy1kcnVnLCB0aGVyZSB3b3VsZCBiZSBtb3JlIHRoYW4gb25lLiAgRm9yIHRpbWluZywgdGhlcmUgd291bGQgdHlwaWNhbGx5IG9ubHkgYmUgb25lLlxyXG4gICAqL1xyXG4gIGltcGxpY2F0ZWQ/OiBmaGlyLlJlZmVyZW5jZUFyZ3NbXXx1bmRlZmluZWQ7XHJcbiAgLyoqXHJcbiAgICogU3VwcG9ydGluZyBldmlkZW5jZSBvciBtYW5pZmVzdGF0aW9ucyB0aGF0IHByb3ZpZGUgdGhlIGJhc2lzIGZvciBpZGVudGlmeWluZyB0aGUgZGV0ZWN0ZWQgaXNzdWUgc3VjaCBhcyBhIEd1aWRhbmNlUmVzcG9uc2Ugb3IgTWVhc3VyZVJlcG9ydC5cclxuICAgKi9cclxuICBldmlkZW5jZT86IGZoaXIuRGV0ZWN0ZWRJc3N1ZUV2aWRlbmNlQXJnc1tdfHVuZGVmaW5lZDtcclxuICAvKipcclxuICAgKiBTaG91bGQgZm9jdXMgb24gaW5mb3JtYXRpb24gbm90IGNvdmVyZWQgZWxzZXdoZXJlIGFzIGRpc2NyZXRlIGRhdGEgLSBubyBuZWVkIHRvIGR1cGxpY2F0ZSB0aGUgbmFycmF0aXZlLlxyXG4gICAqL1xyXG4gIGRldGFpbD86IGZoaXIuRmhpclN0cmluZ3xzdHJpbmd8dW5kZWZpbmVkO1xyXG4gIC8qKlxyXG4gICAqIEV4dGVuZGVkIHByb3BlcnRpZXMgZm9yIHByaW1pdGl2ZSBlbGVtZW50OiBEZXRlY3RlZElzc3VlLmRldGFpbFxyXG4gICAqL1xyXG4gIF9kZXRhaWw/OmZoaXIuRmhpckVsZW1lbnRBcmdzO1xyXG4gIC8qKlxyXG4gICAqIFRoZSBsaXRlcmF0dXJlLCBrbm93bGVkZ2UtYmFzZSBvciBzaW1pbGFyIHJlZmVyZW5jZSB0aGF0IGRlc2NyaWJlcyB0aGUgcHJvcGVuc2l0eSBmb3IgdGhlIGRldGVjdGVkIGlzc3VlIGlkZW50aWZpZWQuXHJcbiAgICovXHJcbiAgcmVmZXJlbmNlPzogZmhpci5GaGlyVXJpfHN0cmluZ3x1bmRlZmluZWQ7XHJcbiAgLyoqXHJcbiAgICogRXh0ZW5kZWQgcHJvcGVydGllcyBmb3IgcHJpbWl0aXZlIGVsZW1lbnQ6IERldGVjdGVkSXNzdWUucmVmZXJlbmNlXHJcbiAgICovXHJcbiAgX3JlZmVyZW5jZT86Zmhpci5GaGlyRWxlbWVudEFyZ3M7XHJcbiAgLyoqXHJcbiAgICogSW5kaWNhdGVzIGFuIGFjdGlvbiB0aGF0IGhhcyBiZWVuIHRha2VuIG9yIGlzIGNvbW1pdHRlZCB0byByZWR1Y2Ugb3IgZWxpbWluYXRlIHRoZSBsaWtlbGlob29kIG9mIHRoZSByaXNrIGlkZW50aWZpZWQgYnkgdGhlIGRldGVjdGVkIGlzc3VlIGZyb20gbWFuaWZlc3RpbmcuICBDYW4gYWxzbyByZWZsZWN0IGFuIG9ic2VydmF0aW9uIG9mIGtub3duIG1pdGlnYXRpbmcgZmFjdG9ycyB0aGF0IG1heSByZWR1Y2UvZWxpbWluYXRlIHRoZSBuZWVkIGZvciBhbnkgYWN0aW9uLlxyXG4gICAqL1xyXG4gIG1pdGlnYXRpb24/OiBmaGlyLkRldGVjdGVkSXNzdWVNaXRpZ2F0aW9uQXJnc1tdfHVuZGVmaW5lZDtcclxufVxyXG5cclxuLyoqXHJcbiAqIEluZGljYXRlcyBhbiBhY3R1YWwgb3IgcG90ZW50aWFsIGNsaW5pY2FsIGlzc3VlIHdpdGggb3IgYmV0d2VlbiBvbmUgb3IgbW9yZSBhY3RpdmUgb3IgcHJvcG9zZWQgY2xpbmljYWwgYWN0aW9ucyBmb3IgYSBwYXRpZW50OyBlLmcuIERydWctZHJ1ZyBpbnRlcmFjdGlvbiwgSW5lZmZlY3RpdmUgdHJlYXRtZW50IGZyZXF1ZW5jeSwgUHJvY2VkdXJlLWNvbmRpdGlvbiBjb25mbGljdCwgZXRjLlxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIERldGVjdGVkSXNzdWUgZXh0ZW5kcyBmaGlyLkRvbWFpblJlc291cmNlIHtcclxuICAvKipcclxuICAgKiBNYXBwaW5nIG9mIHRoaXMgZGF0YXR5cGUgdG8gYSBGSElSIGVxdWl2YWxlbnRcclxuICAgKi9cclxuICBwdWJsaWMgc3RhdGljIG92ZXJyaWRlIHJlYWRvbmx5IF9mdHNfZGF0YVR5cGU6c3RyaW5nID0gJ0RldGVjdGVkSXNzdWUnO1xyXG4gIC8qKlxyXG4gICAqIFJlc291cmNlIFR5cGUgTmFtZVxyXG4gICAqL1xyXG4gIHB1YmxpYyBvdmVycmlkZSByZXNvdXJjZVR5cGU6IFwiRGV0ZWN0ZWRJc3N1ZVwiO1xyXG4gIC8qKlxyXG4gICAqIEJ1c2luZXNzIGlkZW50aWZpZXIgYXNzb2NpYXRlZCB3aXRoIHRoZSBkZXRlY3RlZCBpc3N1ZSByZWNvcmQuXHJcbiAgICovXHJcbiAgcHVibGljIGlkZW50aWZpZXI6IGZoaXIuSWRlbnRpZmllcltdO1xyXG4gIC8qKlxyXG4gICAqIFRoaXMgZWxlbWVudCBpcyBsYWJlbGVkIGFzIGEgbW9kaWZpZXIgYmVjYXVzZSB0aGUgc3RhdHVzIGNvbnRhaW5zIHRoZSBjb2RlcyBjYW5jZWxsZWQgYW5kIGVudGVyZWQtaW4tZXJyb3IgdGhhdCBtYXJrIHRoZSBpc3N1ZSBhcyBub3QgY3VycmVudGx5IHZhbGlkLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0dXM6IGZoaXIuRmhpckNvZGU8T2JzZXJ2YXRpb25TdGF0dXNDb2RlVHlwZT58bnVsbDtcclxuICAvKipcclxuICAgKiBJZGVudGlmaWVzIHRoZSBnZW5lcmFsIHR5cGUgb2YgaXNzdWUgaWRlbnRpZmllZC5cclxuICAgKi9cclxuICBwdWJsaWMgY29kZT86IGZoaXIuQ29kZWFibGVDb25jZXB0fHVuZGVmaW5lZDtcclxuICAvKipcclxuICAgKiBJbmRpY2F0ZXMgdGhlIGRlZ3JlZSBvZiBpbXBvcnRhbmNlIGFzc29jaWF0ZWQgd2l0aCB0aGUgaWRlbnRpZmllZCBpc3N1ZSBiYXNlZCBvbiB0aGUgcG90ZW50aWFsIGltcGFjdCBvbiB0aGUgcGF0aWVudC5cclxuICAgKi9cclxuICBwdWJsaWMgc2V2ZXJpdHk/OiBmaGlyLkZoaXJDb2RlPERldGVjdGVkaXNzdWVTZXZlcml0eUNvZGVUeXBlPnx1bmRlZmluZWQ7XHJcbiAgLyoqXHJcbiAgICogSW5kaWNhdGVzIHRoZSBwYXRpZW50IHdob3NlIHJlY29yZCB0aGUgZGV0ZWN0ZWQgaXNzdWUgaXMgYXNzb2NpYXRlZCB3aXRoLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBwYXRpZW50PzogZmhpci5SZWZlcmVuY2V8dW5kZWZpbmVkO1xyXG4gIC8qKlxyXG4gICAqIFRoZSBkYXRlIG9yIHBlcmlvZCB3aGVuIHRoZSBkZXRlY3RlZCBpc3N1ZSB3YXMgaW5pdGlhbGx5IGlkZW50aWZpZWQuXHJcbiAgICovXHJcbiAgcHVibGljIGlkZW50aWZpZWQ/OiAoZmhpci5GaGlyRGF0ZVRpbWV8Zmhpci5QZXJpb2QpfHVuZGVmaW5lZDtcclxuICAvKipcclxuICAgKiBJbnRlcm5hbCBmbGFnIHRvIHByb3Blcmx5IHNlcmlhbGl6ZSBjaG9pY2UtdHlwZSBlbGVtZW50IERldGVjdGVkSXNzdWUuaWRlbnRpZmllZFt4XVxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBzdGF0aWMgcmVhZG9ubHkgX2Z0c19pZGVudGlmaWVkSXNDaG9pY2U6dHJ1ZSA9IHRydWU7XHJcbiAgLyoqXHJcbiAgICogSW5kaXZpZHVhbCBvciBkZXZpY2UgcmVzcG9uc2libGUgZm9yIHRoZSBpc3N1ZSBiZWluZyByYWlzZWQuICBGb3IgZXhhbXBsZSwgYSBkZWNpc2lvbiBzdXBwb3J0IGFwcGxpY2F0aW9uIG9yIGEgcGhhcm1hY2lzdCBjb25kdWN0aW5nIGEgbWVkaWNhdGlvbiByZXZpZXcuXHJcbiAgICovXHJcbiAgcHVibGljIGF1dGhvcj86IGZoaXIuUmVmZXJlbmNlfHVuZGVmaW5lZDtcclxuICAvKipcclxuICAgKiBUaGVyZSdzIGFuIGltcGxpY2l0IGNvbnN0cmFpbnQgb24gdGhlIG51bWJlciBvZiBpbXBsaWNhdGVkIHJlc291cmNlcyBiYXNlZCBvbiBEZXRlY3RlZElzc3VlLnR5cGU7IGUuZy4gRm9yIGRydWctZHJ1ZywgdGhlcmUgd291bGQgYmUgbW9yZSB0aGFuIG9uZS4gIEZvciB0aW1pbmcsIHRoZXJlIHdvdWxkIHR5cGljYWxseSBvbmx5IGJlIG9uZS5cclxuICAgKi9cclxuICBwdWJsaWMgaW1wbGljYXRlZDogZmhpci5SZWZlcmVuY2VbXTtcclxuICAvKipcclxuICAgKiBTdXBwb3J0aW5nIGV2aWRlbmNlIG9yIG1hbmlmZXN0YXRpb25zIHRoYXQgcHJvdmlkZSB0aGUgYmFzaXMgZm9yIGlkZW50aWZ5aW5nIHRoZSBkZXRlY3RlZCBpc3N1ZSBzdWNoIGFzIGEgR3VpZGFuY2VSZXNwb25zZSBvciBNZWFzdXJlUmVwb3J0LlxyXG4gICAqL1xyXG4gIHB1YmxpYyBldmlkZW5jZTogZmhpci5EZXRlY3RlZElzc3VlRXZpZGVuY2VbXTtcclxuICAvKipcclxuICAgKiBTaG91bGQgZm9jdXMgb24gaW5mb3JtYXRpb24gbm90IGNvdmVyZWQgZWxzZXdoZXJlIGFzIGRpc2NyZXRlIGRhdGEgLSBubyBuZWVkIHRvIGR1cGxpY2F0ZSB0aGUgbmFycmF0aXZlLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBkZXRhaWw/OiBmaGlyLkZoaXJTdHJpbmd8dW5kZWZpbmVkO1xyXG4gIC8qKlxyXG4gICAqIFRoZSBsaXRlcmF0dXJlLCBrbm93bGVkZ2UtYmFzZSBvciBzaW1pbGFyIHJlZmVyZW5jZSB0aGF0IGRlc2NyaWJlcyB0aGUgcHJvcGVuc2l0eSBmb3IgdGhlIGRldGVjdGVkIGlzc3VlIGlkZW50aWZpZWQuXHJcbiAgICovXHJcbiAgcHVibGljIHJlZmVyZW5jZT86IGZoaXIuRmhpclVyaXx1bmRlZmluZWQ7XHJcbiAgLyoqXHJcbiAgICogSW5kaWNhdGVzIGFuIGFjdGlvbiB0aGF0IGhhcyBiZWVuIHRha2VuIG9yIGlzIGNvbW1pdHRlZCB0byByZWR1Y2Ugb3IgZWxpbWluYXRlIHRoZSBsaWtlbGlob29kIG9mIHRoZSByaXNrIGlkZW50aWZpZWQgYnkgdGhlIGRldGVjdGVkIGlzc3VlIGZyb20gbWFuaWZlc3RpbmcuICBDYW4gYWxzbyByZWZsZWN0IGFuIG9ic2VydmF0aW9uIG9mIGtub3duIG1pdGlnYXRpbmcgZmFjdG9ycyB0aGF0IG1heSByZWR1Y2UvZWxpbWluYXRlIHRoZSBuZWVkIGZvciBhbnkgYWN0aW9uLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBtaXRpZ2F0aW9uOiBmaGlyLkRldGVjdGVkSXNzdWVNaXRpZ2F0aW9uW107XHJcbiAgLyoqXHJcbiAgICogRGVmYXVsdCBjb25zdHJ1Y3RvciBmb3IgRGV0ZWN0ZWRJc3N1ZSAtIGluaXRpYWxpemVzIGFueSByZXF1aXJlZCBlbGVtZW50cyB0byBudWxsIGlmIGEgdmFsdWUgaXMgbm90IHByb3ZpZGVkLlxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKHNvdXJjZTpQYXJ0aWFsPERldGVjdGVkSXNzdWVBcmdzPiA9IHt9LCBvcHRpb25zOmZoaXIuRmhpckNvbnN0cnVjdG9yT3B0aW9ucyA9IHt9KSB7XHJcbiAgICBzdXBlcihzb3VyY2UsIG9wdGlvbnMpO1xyXG4gICAgdGhpcy5yZXNvdXJjZVR5cGUgPSAnRGV0ZWN0ZWRJc3N1ZSc7XHJcbiAgICBpZiAoc291cmNlWydpZGVudGlmaWVyJ10pIHsgdGhpcy5pZGVudGlmaWVyID0gc291cmNlLmlkZW50aWZpZXIubWFwKCh4KSA9PiBuZXcgZmhpci5JZGVudGlmaWVyKHgsIG9wdGlvbnMpKTsgfVxyXG4gICAgZWxzZSB7IHRoaXMuaWRlbnRpZmllciA9IFtdOyB9XHJcbiAgICBpZiAoc291cmNlWydzdGF0dXMnXSAhPT0gdW5kZWZpbmVkKSB7IHRoaXMuc3RhdHVzID0gbmV3IGZoaXIuRmhpckNvZGU8T2JzZXJ2YXRpb25TdGF0dXNDb2RlVHlwZT4oe3ZhbHVlOiBzb3VyY2Uuc3RhdHVzfSwgb3B0aW9ucyk7IH1cclxuICAgIGVsc2UgeyB0aGlzLnN0YXR1cyA9IG51bGw7IH1cclxuICAgIGlmIChzb3VyY2VbJ19zdGF0dXMnXSkge1xyXG4gICAgICBpZiAodGhpcy5zdGF0dXMpIHsgdGhpcy5zdGF0dXMuYWRkRXh0ZW5kZWRQcm9wZXJ0aWVzKHNvdXJjZS5fc3RhdHVzISk7IH1cclxuICAgICAgZWxzZSB7IHRoaXMuc3RhdHVzID0gbmV3IGZoaXIuRmhpckNvZGU8T2JzZXJ2YXRpb25TdGF0dXNDb2RlVHlwZT4oc291cmNlLl9zdGF0dXMgYXMgUGFydGlhbDxmaGlyLkZoaXJDb2RlPiwgb3B0aW9ucyk7IH1cclxuICAgIH1cclxuICAgIGlmIChzb3VyY2VbJ2NvZGUnXSkgeyB0aGlzLmNvZGUgPSBuZXcgZmhpci5Db2RlYWJsZUNvbmNlcHQoc291cmNlLmNvZGUsIG9wdGlvbnMpOyB9XHJcbiAgICBpZiAoc291cmNlWydzZXZlcml0eSddICE9PSB1bmRlZmluZWQpIHsgdGhpcy5zZXZlcml0eSA9IG5ldyBmaGlyLkZoaXJDb2RlPERldGVjdGVkaXNzdWVTZXZlcml0eUNvZGVUeXBlPih7dmFsdWU6IHNvdXJjZS5zZXZlcml0eX0sIG9wdGlvbnMpOyB9XHJcbiAgICBpZiAoc291cmNlWydfc2V2ZXJpdHknXSkge1xyXG4gICAgICBpZiAodGhpcy5zZXZlcml0eSkgeyB0aGlzLnNldmVyaXR5LmFkZEV4dGVuZGVkUHJvcGVydGllcyhzb3VyY2UuX3NldmVyaXR5ISk7IH1cclxuICAgICAgZWxzZSB7IHRoaXMuc2V2ZXJpdHkgPSBuZXcgZmhpci5GaGlyQ29kZTxEZXRlY3RlZGlzc3VlU2V2ZXJpdHlDb2RlVHlwZT4oc291cmNlLl9zZXZlcml0eSBhcyBQYXJ0aWFsPGZoaXIuRmhpckNvZGU+LCBvcHRpb25zKTsgfVxyXG4gICAgfVxyXG4gICAgaWYgKHNvdXJjZVsncGF0aWVudCddKSB7IHRoaXMucGF0aWVudCA9IG5ldyBmaGlyLlJlZmVyZW5jZShzb3VyY2UucGF0aWVudCwgb3B0aW9ucyk7IH1cclxuICAgIGlmIChzb3VyY2VbJ2lkZW50aWZpZWQnXSkgeyB0aGlzLmlkZW50aWZpZWQgPSBzb3VyY2UuaWRlbnRpZmllZDsgfVxyXG4gICAgZWxzZSBpZiAoc291cmNlWydpZGVudGlmaWVkRGF0ZVRpbWUnXSAhPT0gdW5kZWZpbmVkKSB7IHRoaXMuaWRlbnRpZmllZCA9IG5ldyBmaGlyLkZoaXJEYXRlVGltZSh7dmFsdWU6IHNvdXJjZS5pZGVudGlmaWVkRGF0ZVRpbWV9LCBvcHRpb25zKTsgfVxyXG4gICAgZWxzZSBpZiAoc291cmNlWydpZGVudGlmaWVkUGVyaW9kJ10pIHsgdGhpcy5pZGVudGlmaWVkID0gbmV3IGZoaXIuUGVyaW9kKHNvdXJjZS5pZGVudGlmaWVkUGVyaW9kLCBvcHRpb25zKTsgfVxyXG4gICAgaWYgKHNvdXJjZVsnYXV0aG9yJ10pIHsgdGhpcy5hdXRob3IgPSBuZXcgZmhpci5SZWZlcmVuY2Uoc291cmNlLmF1dGhvciwgb3B0aW9ucyk7IH1cclxuICAgIGlmIChzb3VyY2VbJ2ltcGxpY2F0ZWQnXSkgeyB0aGlzLmltcGxpY2F0ZWQgPSBzb3VyY2UuaW1wbGljYXRlZC5tYXAoKHgpID0+IG5ldyBmaGlyLlJlZmVyZW5jZSh4LCBvcHRpb25zKSk7IH1cclxuICAgIGVsc2UgeyB0aGlzLmltcGxpY2F0ZWQgPSBbXTsgfVxyXG4gICAgaWYgKHNvdXJjZVsnZXZpZGVuY2UnXSkgeyB0aGlzLmV2aWRlbmNlID0gc291cmNlLmV2aWRlbmNlLm1hcCgoeCkgPT4gbmV3IGZoaXIuRGV0ZWN0ZWRJc3N1ZUV2aWRlbmNlKHgsIG9wdGlvbnMpKTsgfVxyXG4gICAgZWxzZSB7IHRoaXMuZXZpZGVuY2UgPSBbXTsgfVxyXG4gICAgaWYgKHNvdXJjZVsnZGV0YWlsJ10gIT09IHVuZGVmaW5lZCkgeyB0aGlzLmRldGFpbCA9IG5ldyBmaGlyLkZoaXJTdHJpbmcoe3ZhbHVlOiBzb3VyY2UuZGV0YWlsfSwgb3B0aW9ucyk7IH1cclxuICAgIGlmIChzb3VyY2VbJ19kZXRhaWwnXSkge1xyXG4gICAgICBpZiAodGhpcy5kZXRhaWwpIHsgdGhpcy5kZXRhaWwuYWRkRXh0ZW5kZWRQcm9wZXJ0aWVzKHNvdXJjZS5fZGV0YWlsISk7IH1cclxuICAgICAgZWxzZSB7IHRoaXMuZGV0YWlsID0gbmV3IGZoaXIuRmhpclN0cmluZyhzb3VyY2UuX2RldGFpbCBhcyBQYXJ0aWFsPGZoaXIuRmhpclN0cmluZ0FyZ3M+LCBvcHRpb25zKTsgfVxyXG4gICAgfVxyXG4gICAgaWYgKHNvdXJjZVsncmVmZXJlbmNlJ10gIT09IHVuZGVmaW5lZCkgeyB0aGlzLnJlZmVyZW5jZSA9IG5ldyBmaGlyLkZoaXJVcmkoe3ZhbHVlOiBzb3VyY2UucmVmZXJlbmNlfSwgb3B0aW9ucyk7IH1cclxuICAgIGlmIChzb3VyY2VbJ19yZWZlcmVuY2UnXSkge1xyXG4gICAgICBpZiAodGhpcy5yZWZlcmVuY2UpIHsgdGhpcy5yZWZlcmVuY2UuYWRkRXh0ZW5kZWRQcm9wZXJ0aWVzKHNvdXJjZS5fcmVmZXJlbmNlISk7IH1cclxuICAgICAgZWxzZSB7IHRoaXMucmVmZXJlbmNlID0gbmV3IGZoaXIuRmhpclVyaShzb3VyY2UuX3JlZmVyZW5jZSBhcyBQYXJ0aWFsPGZoaXIuRmhpclVyaUFyZ3M+LCBvcHRpb25zKTsgfVxyXG4gICAgfVxyXG4gICAgaWYgKHNvdXJjZVsnbWl0aWdhdGlvbiddKSB7IHRoaXMubWl0aWdhdGlvbiA9IHNvdXJjZS5taXRpZ2F0aW9uLm1hcCgoeCkgPT4gbmV3IGZoaXIuRGV0ZWN0ZWRJc3N1ZU1pdGlnYXRpb24oeCwgb3B0aW9ucykpOyB9XHJcbiAgICBlbHNlIHsgdGhpcy5taXRpZ2F0aW9uID0gW107IH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICogRnVuY3Rpb24gdG8gcGVyZm9ybSBiYXNpYyBtb2RlbCB2YWxpZGF0aW9uIChlLmcuLCBjaGVjayBpZiByZXF1aXJlZCBlbGVtZW50cyBhcmUgcHJlc2VudCkuXHJcbiAgICovXHJcbiAgcHVibGljIG92ZXJyaWRlIGRvTW9kZWxWYWxpZGF0aW9uKGV4cDpzdHJpbmcgPSAnJyk6Zmhpci5GdHNJc3N1ZVtdIHtcclxuICAgIGxldCBpc3M6Zmhpci5GdHNJc3N1ZVtdID0gc3VwZXIuZG9Nb2RlbFZhbGlkYXRpb24oZXhwKTtcclxuICAgIGlmIChleHAgPT09ICcnKSB7IGV4cCA9ICdEZXRlY3RlZElzc3VlJyB9XHJcbiAgICBpc3MucHVzaCguLi50aGlzLnZPQSgnaWRlbnRpZmllcicsZXhwKSk7XHJcbiAgICBpc3MucHVzaCguLi50aGlzLnZSU1YoJ3N0YXR1cycsZXhwLCdPYnNlcnZhdGlvblN0YXR1cycsT2JzZXJ2YXRpb25TdGF0dXNWc1ZhbGlkYXRpb24sJ3InKSk7XHJcbiAgICBpc3MucHVzaCguLi50aGlzLnZPUygnY29kZScsZXhwKSk7XHJcbiAgICBpc3MucHVzaCguLi50aGlzLnZPU1YoJ3NldmVyaXR5JyxleHAsJ0RldGVjdGVkaXNzdWVTZXZlcml0eScsRGV0ZWN0ZWRpc3N1ZVNldmVyaXR5VnNWYWxpZGF0aW9uLCdyJykpO1xyXG4gICAgaXNzLnB1c2goLi4udGhpcy52T1MoJ3BhdGllbnQnLGV4cCkpO1xyXG4gICAgaXNzLnB1c2goLi4udGhpcy52T1MoJ2lkZW50aWZpZWQnLGV4cCkpO1xyXG4gICAgaXNzLnB1c2goLi4udGhpcy52T1MoJ2F1dGhvcicsZXhwKSk7XHJcbiAgICBpc3MucHVzaCguLi50aGlzLnZPQSgnaW1wbGljYXRlZCcsZXhwKSk7XHJcbiAgICBpc3MucHVzaCguLi50aGlzLnZPQSgnZXZpZGVuY2UnLGV4cCkpO1xyXG4gICAgaXNzLnB1c2goLi4udGhpcy52T1MoJ2RldGFpbCcsZXhwKSk7XHJcbiAgICBpc3MucHVzaCguLi50aGlzLnZPUygncmVmZXJlbmNlJyxleHApKTtcclxuICAgIGlzcy5wdXNoKC4uLnRoaXMudk9BKCdtaXRpZ2F0aW9uJyxleHApKTtcclxuICAgIHJldHVybiBpc3M7XHJcbiAgfVxyXG59XHJcbiJdfQ==